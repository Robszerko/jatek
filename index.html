<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Sz√≥Nyomoz√≥</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Roboto+Mono:wght@500;700&display=swap" rel="stylesheet">
    
    <style>
            :root {
            --bg-gradient-start: #3d405b; --bg-gradient-end: #2c2f48; --container-bg: rgba(244, 241, 222, 0.95);
            --text-color: #3d405b; --title-color: #e07a5f; --border-color-idle: #bcaaa4;
            --border-color-active: #8d6e63; --correct-color: #81b29a; --present-color: #f2cc8f;
            --absent-color: #9e9e9e; --key-bg: #dcd3b8; --key-text: #3d405b;
            --key-shadow: 0 3px 0 #bcaaa4; --font-title: 'Fredoka One', cursive; --font-main: 'Roboto Mono', monospace;
            --difficulty-easy: #388e3c; --difficulty-hard: #f57c00; --difficulty-extra: #d32f2f;
            --fail-color: #e53935; --insurance-color: #4CAF50; --surprise-color: #9c27b0;
        }

        .theme-forest { --bg-gradient-start: #2d6a4f; --bg-gradient-end: #1b4332; --container-bg: rgba(247, 246, 242, 0.95); --text-color: #081c15; --title-color: #74c69d; --border-color-idle: #b7e4c7; --border-color-active: #95d5b2; --correct-color: #52b788; --present-color: #ffd60a; --absent-color: #9e9e9e; --key-bg: #d8f3dc; --key-text: #1b4332; --key-shadow: 0 3px 0 #b7e4c7; }
        .theme-ocean { --bg-gradient-start: #0077b6; --bg-gradient-end: #023e8a; --container-bg: rgba(237, 246, 249, 0.95); --text-color: #03045e; --title-color: #00b4d8; --border-color-idle: #ade8f4; --border-color-active: #90e0ef; --correct-color: #48cae4; --present-color: #ffc300; --absent-color: #adb5bd; --key-bg: #caf0f8; --key-text: #023e8a; --key-shadow: 0 3px 0 #ade8f4; }
        .theme-sunset { --bg-gradient-start: #f77f00; --bg-gradient-end: #d62828; --container-bg: rgba(255, 250, 240, 0.95); --text-color: #800f2f; --title-color: #fcbf49; --border-color-idle: #eae2b7; --border-color-active: #f77f00; --correct-color: #70e000; --present-color: #fcbf49; --absent-color: #bc6c25; --key-bg: #fff1e6; --key-text: #d62828; --key-shadow: 0 3px 0 #eae2b7; }
        .theme-night { --bg-gradient-start: #232526; --bg-gradient-end: #000000; --container-bg: rgba(42, 42, 42, 0.95); --text-color: #e0e0e0; --title-color: #7f5af0; --border-color-idle: #6c757d; --border-color-active: #9a9a9a; --correct-color: #2cb67d; --present-color: #ffc107; --absent-color: #495057; --key-bg: #343a40; --key-text: #f8f9fa; --key-shadow: 0 3px 0 #495057; }
        .theme-rose { --bg-gradient-start: #c9184a; --bg-gradient-end: #8c0f32; --container-bg: rgba(255, 240, 243, 0.95); --text-color: #590d22; --title-color: #ff758f; --border-color-idle: #ffb3c1; --border-color-active: #ff8fa3; --correct-color: #a9def9; --present-color: #fcf6bd; --absent-color: #c9ada7; --key-bg: #ffe5ec; --key-text: #8c0f32; --key-shadow: 0 3px 0 #ffb3c1; }
        .theme-vintage { --bg-gradient-start: #a27b5c; --bg-gradient-end: #3f2f25; --container-bg: rgba(243, 235, 226, 0.95); --text-color: #3f2f25; --title-color: #7b553c; --border-color-idle: #dcd0c0; --border-color-active: #c0b2a4; --correct-color: #8c7a6b; --present-color: #e6b8a2; --absent-color: #9c8978; --key-bg: #efebe5; --key-text: #3f2f25; --key-shadow: 0 3px 0 #dcd0c0; }
        .theme-meadow { --bg-gradient-start: #7cb518; --bg-gradient-end: #5c8001; --container-bg: rgba(248, 255, 242, 0.95); --text-color: #436129; --title-color: #aacc00; --border-color-idle: #d4e09b; --border-color-active: #b5c77e; --correct-color: #9ef01a; --present-color: #f7d622; --absent-color: #90a955; --key-bg: #f2f7e5; --key-text: #436129; --key-shadow: 0 3px 0 #d4e09b; }
        .theme-royal { --bg-gradient-start: #5a189a; --bg-gradient-end: #3c096c; --container-bg: rgba(243, 237, 247, 0.95); --text-color: #3c096c; --title-color: #9d4edd; --border-color-idle: #d8b4fe; --border-color-active: #c792fe; --correct-color: #7b2cbf; --present-color: #fca311; --absent-color: #b1a7a6; --key-bg: #e9d8fd; --key-text: #3c096c; --key-shadow: 0 3px 0 #d8b4fe; }
        .theme-hacker { --bg-gradient-start: #0c0c0c; --bg-gradient-end: #000000; --container-bg: rgba(10, 25, 10, 0.9); --text-color: #00ff00; --title-color: #00ff00; --border-color-idle: #008000; --border-color-active: #32cd32; --correct-color: #32cd32; --present-color: #adff2f; --absent-color: #556b2f; --key-bg: #111; --key-text: #00ff00; --key-shadow: 0 3px 0 #008000; font-family: 'Roboto Mono', monospace; }

        body {
            background-color: var(--bg-gradient-end);
            background-image: radial-gradient(circle at top left, rgba(255, 255, 255, 0.1) 0%, transparent 40%), url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.08'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
            color: var(--text-color);
            font-family: var(--font-main);
            display: flex; justify-content: center; align-items: flex-start; padding: 15px; box-sizing: border-box;
            -webkit-user-select: none; user-select: none; touch-action: manipulation;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        #game-container {
            background-color: var(--container-bg);
            border-radius: 20px; border: 2px solid rgba(255,255,255,0.2); box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            display: flex; flex-direction: column; align-items: center; width: 100%; max-width: 600px;
            padding: clamp(15px, 4vw, 30px); box-sizing: border-box; margin-top: 1vh; position: relative;
            transition: background-color 0.3s ease;
        }

        #top-right-hud {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 1010; 
        }

        #insurance-display, #warehouse-display {
            display: flex; align-items: center; gap: 8px; font-family: var(--font-main);
            font-size: 1.1rem; font-weight: 700; color: var(--insurance-color);
            background: rgba(76, 175, 80, 0.1); padding: 5px 15px;
            border-radius: 20px; border: 2px solid var(--insurance-color);
            cursor: pointer;
            transition: all 0.2s ease;
        }
        #warehouse-display {
            color: var(--present-color);
            background: rgba(242, 204, 143, 0.15);
            border-color: var(--present-color);
        }
        #insurance-display:hover, #warehouse-display:hover {
            transform: scale(1.05);
            box-shadow: 0 0 8px currentColor;
        }
        #insurance-display svg, #warehouse-display svg { width: 20px; height: 20px; fill: currentColor; }

        #new-hour-notification {
            display: none; justify-content: space-around; align-items: center;
            position: sticky; top: -15px; left: -15px; right: -15px;
            width: calc(100% + 30px);
            background-color: var(--present-color); color: var(--text-color);
            padding: 10px; font-weight: bold; z-index: 50;
            border-bottom: 2px solid rgba(0,0,0,0.2);
            border-radius: 20px 20px 0 0; margin: -15px -15px 15px -15px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }
        #new-hour-notification button {
            background-color: var(--text-color); color: var(--container-bg);
            border: none; border-radius: 5px; padding: 5px 10px;
            font-weight: bold; cursor: pointer;
        }

        header { 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center; 
            gap: 0; 
            margin-bottom: 20px; 
            position: relative; 
            width: 100%; 
            padding-top: 40px; 
        }
        #header-main { 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            position: relative; 
        }
        
        #logo-container { 
            display: flex; 
            align-items: center; 
            position: relative; 
        }
        #logo-svg { 
            width: clamp(80px, 20vw, 100px); 
            height: auto; 
            z-index: 1; 
        }
        #logo-svg .logo-circle { 
            stroke: url(#grad1); 
            fill: var(--container-bg); 
            transition: fill 0.3s ease; 
        }
        #logo-svg .logo-handle { 
            stroke: url(#grad1); 
        }
        #logo-svg .logo-text { 
            fill: var(--text-color); 
            transition: fill 0.3s ease; 
        }
        #logo-svg stop { 
            transition: stop-color 0.3s ease; 
        }
        
        header h1 {
            font-family: var(--font-title); 
            color: var(--title-color); 
            font-size: clamp(2rem, 9vw, 3rem); 
            margin: 0;
            letter-spacing: 0.05em; 
            margin-left: -2px; 
            z-index: 0; 
            transition: color 0.3s ease;
        }
        #title-container { 
            position: relative; 
            display: flex; 
            align-items: center; 
        }
        #copyright-notice { 
            font-size: 0.7rem; 
            color: var(--text-color); 
            opacity: 0.7; 
            margin-top: 2px; 
            transition: color 0.3s ease, opacity 0.3s ease; 
        }

        #theme-toggle-button { 
            width: 28px; 
            height: 28px; 
            cursor: pointer; 
            z-index: 10; 
            transition: transform 0.2s ease; 
            margin-left: 10px; 
        }
        #theme-toggle-button:hover { 
            transform: scale(1.2) rotate(15deg); 
        }
        #theme-toggle-button svg { 
            fill: var(--title-color); 
            transition: fill 0.3s ease; 
            width: 100%; 
            height: 100%; 
        }
        #theme-picker {
            position: absolute; 
            top: 100%; 
            right: 0; 
            margin-top: 10px; 
            background-color: var(--container-bg);
            border: 2px solid var(--border-color-idle); 
            border-radius: 10px; 
            padding: 10px; 
            display: flex;
            flex-wrap: wrap; 
            gap: 8px; 
            width: 150px; 
            z-index: 20; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        .theme-swatch { 
            width: 30px; 
            height: 30px; 
            border-radius: 50%; 
            cursor: pointer; 
            border: 2px solid var(--border-color-idle); 
            transition: transform 0.2s ease, box-shadow 0.2s ease; 
        }
        .theme-swatch:hover { 
            transform: scale(1.1); 
            box-shadow: 0 0 5px var(--title-color); 
        }
        .theme-swatch.active { 
            border: 3px solid var(--title-color); 
            box-shadow: 0 0 8px var(--title-color); 
        }

        #weekly-score-display { 
            font-family: var(--font-main); 
            font-size: 1.1rem; 
            font-weight: 700; 
            color: var(--title-color); 
            background: rgba(0,0,0,0.05); 
            padding: 5px 15px; 
            border-radius: 20px; 
            border: 2px solid var(--border-color-idle); 
            margin-top: 10px; 
            transition: color 0.3s ease, border-color 0.3s ease; 
        }
        
        #keyboard-toggle-container { 
            margin-top: 10px; 
            font-size: 0.8rem; 
            font-weight: bold; 
            display: flex; 
            align-items: center; 
            gap: 5px; 
            color: var(--text-color); 
        }
        #keyboard-toggle-checkbox { 
            cursor: pointer; 
        }

        #word-tracker { 
            display: flex; 
            justify-content: center; 
            gap: 10px; 
            margin-bottom: 10px; 
            flex-wrap: wrap; 
        }
        .tracker-item { 
            flex: 1; 
            min-width: 60px; 
            padding: 10px 5px; 
            text-align: center; 
            border-radius: 8px; 
            border: 2px solid var(--border-color-idle); 
            font-weight: 500; 
            cursor: pointer; 
            transition: all 0.3s ease; 
            position: relative; 
        }
        .tracker-item.active { 
            border-color: var(--title-color); 
            box-shadow: 0 0 8px var(--title-color); 
        }
        .tracker-item.solved { 
            background-color: var(--correct-color); 
            border-color: var(--correct-color); 
            color: white; 
            cursor: not-allowed;
        }
        .tracker-item.failed { 
            background-color: var(--fail-color); 
            border-color: var(--fail-color); 
            color: white; 
        }
        .tracker-item.failed-revealed { 
            background-color: var(--fail-color); 
            border-color: var(--fail-color); 
            color: white; 
            cursor: not-allowed; 
            opacity: 0.6; 
        }
        .tracker-item .cooldown-timer { 
            font-size: 0.8em; 
            font-weight: bold; 
            margin-top: 4px; 
        }

        #info-bar { 
            width: 100%; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            padding: 12px 0; 
            min-height: 50px; 
            margin-bottom: 5px; 
        }
        #info-bar.feedback-message { 
            justify-content: center; 
            font-size: 1.2rem; 
            font-weight: bold; 
        }
        #info-bar.feedback-message strong { 
            color: var(--title-color); 
        }
        
        #reveal-solution-container { 
            margin-left: auto; 
        }
        #reveal-solution-button { 
            background-color: var(--fail-color); 
            color: white; 
            border: none; 
            padding: 8px 12px; 
            border-radius: 8px; 
            font-weight: 700; 
            cursor: pointer; 
        }

        .mode-choice-button { 
            background-color: var(--key-bg); 
            color: var(--key-text); 
            border: 2px solid var(--border-color-idle); 
            padding: 8px 12px; 
            border-radius: 8px; 
            font-weight: 700; 
            cursor: pointer; 
            margin: 0 5px; 
        }
        #game-mode-display { 
            display: flex; 
            align-items: center; 
            background-color: rgba(0,0,0,0.05); 
            padding: 5px 10px; 
            border-radius: 20px; 
        }
        #game-mode-display span { 
            font-weight: 700; 
            font-size: 0.9rem; 
        }
        #timer-display { 
            font-weight: 700; 
            font-size: 1.1em; 
            color: var(--title-color); 
            margin-left: 8px; 
        }
        
        #word-info-container { 
            display: flex; 
            flex-direction: column; 
            align-items: flex-start; 
            text-align: left; 
        }
        #difficulty-display { 
            font-weight: 700; 
            margin-top: 4px; 
            border-radius: 10px; 
            padding: 3px 10px; 
            color: white; 
            font-size: 0.9em; 
            text-transform: uppercase; 
            letter-spacing: 0.5px; 
            text-shadow: 1px 1px 2px rgba(0,0,0,0.25); 
            border: 1px solid rgba(255,255,255,0.3); 
        }
        .difficulty-k√∂nny≈± { background-color: var(--difficulty-easy); } 
        .difficulty-neh√©z { background-color: var(--difficulty-hard); } 
        .difficulty-extra-neh√©z { background-color: var(--difficulty-extra); }
        
        #hint-display-area { 
            display: none; 
            width: 100%; 
            padding: 15px; 
            margin-bottom: 15px; 
            background-color: rgba(0,0,0,0.05); 
            border: 2px solid var(--border-color-idle); 
            border-radius: 10px; 
            text-align: center; 
            line-height: 1.6; 
            opacity: 0; 
            transition: opacity 0.5s ease; 
        }
        #hint-display-area.active { 
            display: block; 
            opacity: 1; 
        }
        #hint-display-area strong { 
            color: var(--title-color); 
            font-style: normal; 
        }
        
        #grid-container { 
            display: grid; 
            grid-template-rows: repeat(6, 1fr); 
            gap: 5px; 
            width: 100%; 
            max-width: 500px; 
            margin: 0 auto 20px auto; 
            aspect-ratio: 5 / 6; 
        }
        .grid-row { 
            display: grid; 
            gap: 5px; 
        }
        .grid-cell { 
            perspective: 1000px; 
        }
        .cell-inner { 
            position: relative; 
            width: 100%; 
            height: 100%; 
            transition: transform 0.6s; 
            transform-style: preserve-3d; 
        }
        .grid-cell.flip .cell-inner { 
            transform: rotateX(180deg); 
        }
        .cell-face { 
            position: absolute; 
            width: 100%; 
            height: 100%; 
            backface-visibility: hidden; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            font-size: clamp(1.5rem, 5vw, 2.2rem); 
            font-weight: bold; 
            text-transform: uppercase; 
            box-sizing: border-box; 
            border-radius: 8px; 
        }
        .cell-front { 
            border: 3px solid var(--border-color-idle); 
            transition: border-color 0.2s ease; 
        }
        .grid-cell.filled .cell-front:not(.cell-revealed) { 
            border-color: var(--border-color-active); 
            animation: pop 0.2s; 
        }
        @keyframes pop { 
            50% { transform: scale(1.1); } 
        }
        .cell-revealed { 
            border-color: var(--correct-color); 
            background-color: rgba(129, 178, 154, 0.2); 
        }
        .cell-back { 
            color: white; 
            transform: rotateX(180deg); 
            border: 3px solid transparent; 
        }
        .cell-back.correct { 
            background-color: var(--correct-color); 
            border-color: var(--correct-color);
        }
        .cell-back.present { 
            background-color: var(--present-color); 
            border-color: var(--present-color);
        }
        .cell-back.absent  { 
            background-color: var(--absent-color); 
            border-color: var(--absent-color);
        }
        
        #hint-controls { 
            display: flex; 
            justify-content: center; 
            gap: 10px; 
            margin-bottom: 25px; 
            width: 100%; 
        }
        .hint-button { 
            color: white; 
            border: none; 
            padding: 10px 15px; 
            border-radius: 8px; 
            cursor: pointer; 
            font-weight: 700; 
            transition: all 0.2s; 
            font-size: 0.9rem; 
            flex-grow: 1; 
            max-width: 250px; 
        }
        .hint-button#request-text-hint-button { 
            background-color: var(--present-color); 
            box-shadow: 0 3px 0 #d0a457; 
        }
        .hint-button#request-letter-hint-button { 
            background-color: var(--correct-color); 
            box-shadow: 0 3px 0 #6a9982; 
        }
        .hint-button:hover:not(:disabled) { 
            transform: translateY(-2px); 
        }
        .hint-button:disabled { 
            background-color: var(--absent-color); 
            cursor: not-allowed; 
            box-shadow: none; 
            opacity: 0.7; 
        }
        
        #keyboard-container { 
            display: flex; 
            flex-direction: column; 
            gap: clamp(6px, 1.5vw, 10px); 
            width: 100%; 
            max-width: 900px; 
            margin: 0 auto; 
        }
        .keyboard-row { 
            display: flex; 
            justify-content: center; 
            gap: clamp(3px, 1vw, 6px); 
        }
        .key { 
            font-family: var(--font-main); 
            font-weight: 500; 
            border: none; 
            border-radius: 6px; 
            height: clamp(45px, 12vw, 60px); 
            flex-grow: 1; 
            cursor: pointer; 
            text-transform: uppercase; 
            font-size: clamp(0.8rem, 3vw, 1.4rem); 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            padding: 0; 
            background-color: var(--key-bg); 
            color: var(--key-text); 
            box-shadow: var(--key-shadow); 
            transition: all 0.1s ease-in-out, background-color 0.3s ease, color 0.3s ease; 
        }
        .key:active, .key.active-press { 
            transform: translateY(2px); 
            box-shadow: none; 
        }
        .key.large { 
            flex-grow: 1.5; 
            font-size: clamp(0.7rem, 2.5vw, 1rem); 
        }
        .key.correct, .key.correct:hover { 
            background-color: var(--correct-color); 
            color: white; 
        } 
        .key.present, .key.present:hover { 
            background-color: var(--present-color); 
            color: white; 
        } 
        .key.absent, .key.absent:hover { 
            background-color: var(--absent-color); 
            color: white; 
            opacity: 0.7; 
        }
        #keyboard-container.disabled .key { 
            cursor: not-allowed; 
            opacity: 0.6; 
        }

        #idle-message-container { 
            text-align: center; 
            padding: 40px 20px; 
            line-height: 1.8; 
            border: 2px dashed var(--border-color-idle); 
            border-radius: 15px; 
            margin: 20px 0; 
        }
        #idle-message-container h3 { 
            font-family: var(--font-title); 
            color: var(--title-color); 
            font-size: 1.6rem; 
            margin: 0 0 15px 0; 
        }
        #idle-message-container p { 
            margin: 10px 0; 
            font-size: 1.1rem; 
        }
        #countdown-timer { 
            font-weight: bold; 
            color: var(--title-color); 
            font-size: 1.2rem; 
            display: block; 
            margin-top: 15px; 
        }

        #rules-container { 
            margin-top: 30px; 
            padding-top: 20px; 
            border-top: 2px solid var(--border-color-idle); 
            line-height: 1.7; 
            width: 100%; 
            color: var(--text-color); 
            transition: color 0.3s ease, border-color 0.3s ease; 
        }
        #rules-container h3 { 
            font-family: var(--font-title); 
            color: var(--title-color); 
            text-align: center; 
            font-size: 1.5rem; 
            margin: 0 0 15px 0; 
        }
        #rules-container ul { 
            list-style-type: 'üïµÔ∏è '; 
            padding-left: 20px; 
            text-align: left; 
            margin: 0; 
        }
        #rules-container li { 
            margin-bottom: 12px; 
            padding-left: 8px; 
        }
        
        #bonus-unlock-container {
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            gap: 15px; 
            margin: 20px 0;
            padding: 20px; 
            border: 2px dashed var(--border-color-idle); 
            border-radius: 15px; 
            width: 100%;
        }
        #bonus-unlock-header { 
            display: flex; 
            align-items: center; 
            gap: 15px; 
        }
        #wheel-logo-svg { 
            width: 60px; 
            height: 60px; 
        }
        #bonus-unlock-header h2 { 
            font-family: var(--font-title); 
            color: var(--title-color); 
            font-size: 1.8rem; 
            margin: 0; 
        }
        #code-input-container { 
            display: flex; 
            gap: 10px; 
        }
        .code-input {
            width: 45px; 
            height: 60px; 
            border-radius: 8px; 
            border: 3px solid var(--border-color-idle);
            text-align: center; 
            font-family: var(--font-main); 
            font-size: 2rem; 
            font-weight: bold; 
            color: var(--text-color);
            background-color: var(--container-bg); 
            -moz-appearance: textfield; 
            transition: all 0.2s ease;
        }
        .code-input.flashing-code {
            background-color: var(--title-color); 
            color: white;
            border-color: var(--title-color);
            animation: code-flash-pulse 0.5s infinite alternate;
        }
        @keyframes code-flash-pulse { 
            from { transform: scale(1); } 
            to { transform: scale(1.05); } 
        }
        .code-input::-webkit-outer-spin-button, 
        .code-input::-webkit-inner-spin-button { 
            -webkit-appearance: none; 
            margin: 0; 
        }
        .code-input:focus { 
            border-color: var(--title-color); 
            outline: none; 
        }
        #code-input-container.shake { 
            animation: shake 0.5s; 
        }
        @keyframes shake { 
            10%, 90% { transform: translate3d(-1px, 0, 0); } 
            20%, 80% { transform: translate3d(2px, 0, 0); } 
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); } 
            40%, 60% { transform: translate3d(4px, 0, 0); } 
        }
        #check-code-button {
            background-color: var(--correct-color); 
            color: white; 
            border: none; 
            padding: 10px 20px;
            border-radius: 8px; 
            font-weight: 700; 
            cursor: pointer; 
            transition: transform 0.2s;
        }
        #check-code-button:hover { 
            transform: scale(1.05); 
        }

        #play-wheel-button {
            display: none; 
            background-color: var(--difficulty-extra); 
            color: white; 
            border: 2px solid white;
            border-radius: 10px; 
            padding: 15px 30px; 
            font-family: var(--font-title); 
            font-size: 1.2rem;
            letter-spacing: 1px; 
            margin: 20px 0; 
            text-shadow: 1px 1px 3px rgba(0,0,0,0.4); 
            cursor: pointer;
            animation: pulse-red 2s infinite;
        }

        @keyframes pulse-red {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(211, 47, 47, 0.7); }
            70% { transform: scale(1); box-shadow: 0 0 0 10px rgba(211, 47, 47, 0); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(211, 47, 47, 0); }
        }

        #lotto-container, #weekly-lotto-container {
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            gap: 15px; 
            margin: 20px 0;
            padding: 20px; 
            border: 2px solid var(--border-color-active); 
            border-radius: 15px; 
            width: 100%;
            background: linear-gradient(145deg, rgba(255,255,255,0.05), rgba(255,255,255,0));
            cursor: pointer;
        }
        #weekly-lotto-container {
             border: 2px solid var(--surprise-color);
        }
        #lotto-header, #weekly-lotto-header { 
            display: flex; 
            align-items: center; 
            gap: 15px; 
        }
        #lotto-logo-svg, #weekly-lotto-logo-svg { 
            width: 60px; 
            height: 60px; 
            filter: drop-shadow(0 2px 3px rgba(0,0,0,0.2)); 
        }
        #lotto-header h2, #weekly-lotto-header h2 { 
            font-family: var(--font-title); 
            color: var(--title-color); 
            font-size: 1.8rem; 
            margin: 0; 
        }
        #weekly-lotto-header h2 { 
            color: var(--surprise-color); 
        }

        #lotto-container p, #weekly-lotto-container p { 
            font-size: 0.9rem; 
            text-align: center; 
            line-height: 1.5; 
            max-width: 90%; 
        }

        .lotto-ticket-stub {
            background-color: rgba(255, 255, 255, 0.4);
            border: 2px dashed var(--border-color-active);
            border-radius: 12px;
            padding: 15px;
            margin-top: 10px;
            width: 95%;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            text-align: center;
        }
        #daily-winning-numbers-display, #weekly-winning-numbers-display {
            background-color: rgba(0,0,0,0.02);
            border: 1px solid var(--border-color-idle);
            padding: 10px 15px;
            box-shadow: none;
            width:100%;
            margin-bottom: 15px;
        }
        #weekly-winning-numbers-display {
            border-color: var(--surprise-color);
        }

        #daily-winning-numbers-display .winning-header, #weekly-winning-numbers-display .winning-header {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 10px;
        }
        .lotto-logo-svg {
            width: 35px;
            height: 35px;
        }
        #daily-winning-numbers-display h4, #weekly-winning-numbers-display h4 {
            margin: 0;
            font-family: var(--font-main);
            color: var(--text-color);
            font-size: 1rem;
            font-weight: 700;
        }
        .lotto-ticket-stub h4 { 
            margin: 0 0 10px 0; 
            font-family: var(--font-title); 
            color: var(--text-color); 
        }
        .number-display { 
            display: flex; 
            gap: 8px; 
            justify-content: center; 
            flex-wrap: wrap; 
        }
        .lotto-ball {
            width: 35px; 
            height: 35px; 
            border-radius: 50%; 
            background-color: var(--key-bg);
            color: var(--key-text); 
            border: 2px solid var(--border-color-idle);
            display: flex; 
            justify-content: center; 
            align-items: center; 
            font-weight: bold;
            box-shadow: inset 1px 1px 3px rgba(0,0,0,0.1), 1px 1px 2px rgba(0,0,0,0.1);
        }
        .lotto-ball.match { 
            background-color: var(--correct-color); 
            color: white; 
            border-color: #6a9982; 
            animation: pop 0.5s; 
        }
        
        .overlay { 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background-color: rgba(0, 0, 0, 0.85); 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            z-index: 1000; 
            opacity: 0; 
            visibility: hidden; 
            transition: opacity 0.3s ease, visibility 0s 0.3s; 
        }
        .overlay.visible { 
            opacity: 1; 
            visibility: visible; 
            transition-delay: 0s; 
        }
        .overlay-content { 
            background-color: var(--container-bg); 
            color: var(--text-color); 
            transition: background-color 0.3s ease, color 0.3s ease; 
            padding: clamp(20px, 4vw, 30px); 
            border-radius: 20px; 
            text-align: center; 
            box-shadow: 0 5px 25px rgba(0,0,0,0.3); 
            max-width: 95vw; 
            width: auto; 
            max-height: 95vh; 
            overflow-y: auto; 
            display: flex; 
            flex-direction: column; 
            gap: 15px; 
        }
        .overlay-content h2 { 
            font-family: var(--font-title); 
            color: var(--title-color); 
            margin: 0 0 10px 0; 
            font-size: clamp(1.5rem, 6vw, 2.2rem); 
        }
        .overlay-button { 
            background-color: var(--title-color); 
            color: white; 
            border: none; 
            padding: 12px 25px; 
            border-radius: 8px; 
            font-family: var(--font-main); 
            font-weight: 700; 
            font-size: 1rem; 
            cursor: pointer; 
            margin-top: 15px; 
            transition: transform 0.2s ease, background-color 0.3s ease; 
        }
        
        #lotto-game-container, #prize-choice-container { 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
        }
        #lotto-grid-overlay { 
            display: grid; 
            grid-template-columns: repeat(7, 1fr); 
            gap: 8px; 
            max-width: 360px; 
            width: 100%; 
            margin: 15px 0; 
        }
        .lotto-number { 
            width: 40px; 
            height: 40px; 
            border-radius: 50%; 
            background-color: var(--key-bg); 
            color: var(--key-text); 
            border: 2px solid var(--border-color-idle); 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            font-weight: bold; 
            cursor: pointer; 
            transition: all 0.2s ease; 
        }
        .lotto-number:hover { 
            transform: scale(1.1); 
            background-color: var(--present-color); 
        }
        .lotto-number.selected { 
            background-color: var(--title-color); 
            color: white; 
            border-color: var(--title-color); 
            transform: scale(1.1); 
            box-shadow: 0 0 8px var(--title-color); 
        }
        #lotto-selection-counter { 
            font-weight: bold; 
            color: var(--text-color); 
        }
        #lotto-overlay-buttons { 
            display: flex; 
            gap: 10px; 
            justify-content: center; 
            width: 100%;
        }
        #submit-lotto-button-overlay { 
            background-color: var(--correct-color); 
            box-shadow: 0 3px 0 #388e3c; 
            flex-grow: 2; 
        }
        #close-lotto-overlay-button { 
            background-color: var(--fail-color); 
            box-shadow: 0 3px 0 #b71c1c; 
            flex-grow: 1; 
        }
        #lotto-overlay-message { 
            min-height: 2em; 
            transition: opacity 0.5s ease; 
            font-weight: bold; 
            font-size: 1.1em;
        }
        #lotto-insufficient-points-message { 
            color: var(--fail-color); 
            font-weight: bold; 
            margin-top: 10px;
        }
        #lotto-prizes-list { 
            list-style-type: '‚òÖ'; 
            padding-left: 20px; 
            text-align: left; 
            margin: 15px 0; 
        }
        #lotto-prizes-list li { 
            margin-bottom: 8px; 
        }
        
        #wheel-game-container { 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            gap: 15px; 
        }
        #wheel-wrapper { 
            position: relative; 
            width: 360px; 
            height: 360px; 
            margin: 10px auto; 
        }
        #wheel-pointer { 
            width: 0; 
            height: 0; 
            border-left: 20px solid transparent; 
            border-right: 20px solid transparent; 
            border-top: 40px solid var(--fail-color); 
            position: absolute; 
            top: -15px; 
            left: 50%; 
            transform: translateX(-50%); 
            z-index: 10; 
            transition: border-top-color 0.3s ease; 
        }
        #wheel { 
            width: 100%; 
            height: 100%; 
            transition: transform 4s cubic-bezier(0.25, 0.1, 0.25, 1); 
        }
        #wheel-game-ui { 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            gap: 15px; 
            width: 100%; 
        }
        #wheel-round-display { 
            font-size: 1.2rem; 
            font-weight: bold; 
            color: var(--title-color); 
        }
        #wheel-stats-container { 
            font-size: 1.1rem; 
            font-weight: bold; 
            background: rgba(0,0,0,0.05); 
            padding: 8px 15px; 
            border-radius: 10px; 
            border: 2px solid var(--border-color-idle); 
        }
        #wheel-winnings-display { 
            color: var(--difficulty-easy); 
        }
        #puzzle-category { 
            font-size: 1rem; 
            font-weight: bold; 
            background: var(--title-color); 
            color: white; 
            padding: 5px 15px; 
            border-radius: 10px; 
        }
        #puzzle-board { 
            display: flex; 
            flex-wrap: wrap; 
            justify-content: center; 
            gap: 4px; 
            max-width: 100%; 
            padding: 10px; 
            align-items: center; 
        }
        .puzzle-tile { 
            width: 32px; 
            height: 42px; 
            border-radius: 5px; 
            perspective: 1000px; 
            flex-shrink: 0; 
        }
        .puzzle-tile:not(.space) { 
            border: 2px solid #fff; 
        }
        .puzzle-tile.space { 
            background-color: transparent; 
            border: none; 
            width: 15px; 
        }
        .tile-inner { 
            position: relative; 
            width: 100%; 
            height: 100%; 
            transition: transform 0.6s; 
            transform-style: preserve-3d; 
        }
        .puzzle-tile:not(.space) .tile-inner { 
            background-color: var(--correct-color); 
        }
        .puzzle-tile.revealed .tile-inner { 
            transform: rotateY(180deg); 
        }
        .tile-face { 
            position: absolute; 
            width: 100%; 
            height: 100%; 
            backface-visibility: hidden; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
        }
        .tile-front { 
            background-color: var(--correct-color); 
        }
        .tile-back { 
            background-color: #fff; 
            color: var(--text-color); 
            font-weight: bold; 
            font-size: 1.5rem; 
            transform: rotateY(180deg); 
        }
        #wheel-message-display { 
            min-height: 2.5em; 
            font-size: 1.1rem; 
            font-weight: bold; 
            color: var(--title-color); 
            text-align: center; 
            transition: opacity 0.3s ease; 
        }
        #wheel-alphabet-panel { 
            display: flex; 
            flex-wrap: wrap; 
            justify-content: center; 
            gap: 5px; 
            max-width: 95%; 
            margin: 10px 0; 
        }
        .alphabet-key { 
            width: 30px; 
            height: 30px; 
            border: 2px solid var(--border-color-idle); 
            border-radius: 5px; 
            background-color: var(--key-bg); 
            color: var(--key-text); 
            font-weight: bold; 
            cursor: pointer; 
            transition: all 0.2s; 
        }
        .alphabet-key:disabled { 
            background-color: var(--absent-color); 
            color: white; 
            opacity: 0.6; 
            cursor: not-allowed; 
        }
        .alphabet-key.vowel { 
            border-color: var(--present-color); 
        }
        #wheel-controls, #wheel-decision-controls { 
            display: flex; 
            flex-wrap: wrap; 
            justify-content: center; 
            gap: 10px; 
        }
        #wheel-controls button, #wheel-decision-controls button { 
            padding: 10px 15px; 
            font-size: 1rem; 
            flex-basis: 120px; 
        }
        #spin-button { 
            background-color: var(--difficulty-easy); 
            box-shadow: 0 3px 0 #2e7d32; 
        }
        #buy-vowel-button { 
            background-color: var(--present-color); 
            box-shadow: 0 3px 0 #d0a457; 
        }
        #solve-button { 
            background-color: var(--difficulty-hard); 
            box-shadow: 0 3px 0 #c46400; 
        }
        #cash-out-button { 
            background-color: var(--difficulty-easy); 
            box-shadow: 0 3px 0 #2e7d32; 
        }
        #next-round-button { 
            background-color: var(--difficulty-hard); 
            box-shadow: 0 3px 0 #c46400; 
        }
        #power-meter-container { 
            width: 80%; 
            max-width: 400px; 
            height: 20px; 
            background-color: #ccc; 
            border-radius: 10px; 
            overflow: hidden; 
            margin-top: 10px; 
            cursor: pointer; 
            border: 2px solid var(--text-color); 
        }
        #power-meter-bar { 
            width: 0%; 
            height: 100%; 
            background: linear-gradient(90deg, #f2cc8f, #e07a5f, var(--fail-color)); 
        }
        .power-up { 
            animation: power-up 1.5s linear infinite; 
        }
        @keyframes power-up { 
            0% { width: 0%; } 
            50% { width: 100%; } 
            100% { width: 0%; } 
        }

        #card-game-container { 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            gap: 20px; 
        }
        #card-board { 
            display: grid; 
            grid-template-columns: repeat(5, 1fr); 
            gap: 15px; 
            width: 100%; 
            max-width: 520px; 
            perspective: 1000px; 
        }
        .game-card { 
            width: 90px; 
            height: 130px; 
            cursor: pointer; 
            position: relative; 
        }
        .game-card.disabled { 
            cursor: not-allowed; 
        }
        .card-inner { 
            position: absolute; 
            width: 100%; 
            height: 100%; 
            transition: transform 0.6s; 
            transform-style: preserve-3d; 
        }
        .game-card.flipped .card-inner { 
            transform: rotateY(180deg); 
        }
        .card-face { 
            position: absolute; 
            width: 100%; 
            height: 100%; 
            backface-visibility: hidden; 
            border-radius: 10px; 
            box-shadow: 0 4px 8px rgba(0,0,0,0.2); 
        }
        .card-face-front { 
            background-color: var(--key-bg); 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            padding: 5px; 
            box-sizing: border-box; 
            border: 2px solid var(--border-color-active); 
        }
        .card-logo-svg { 
            width: 90%; 
            height: auto; 
        }
        .card-logo-svg .logo-circle { 
            stroke: url(#grad1); 
            fill: var(--container-bg); 
        }
        .card-logo-svg .logo-handle { 
            stroke: url(#grad1); 
        }
        .card-logo-svg .logo-text { 
            fill: var(--text-color); 
        }
        .card-face-back { 
            background-color: #fff; 
            color: var(--text-color); 
            transform: rotateY(180deg); 
            display: flex; 
            flex-direction: column; 
            justify-content: center; 
            align-items: center; 
            text-align: center; 
            padding: 10px; 
            font-weight: bold; 
            border: 2px solid var(--border-color-active); 
        }
        .card-face-back.total-bankrupt, 
        .card-face-back.cursed { 
            background-color: var(--fail-color); 
            color: white; 
            border-color: var(--fail-color); 
        }
        .card-face-back.joker { 
            background: linear-gradient(45deg, var(--present-color), var(--correct-color)); 
            color: white; 
        }
        .card-face-back.special-prize { 
            background: radial-gradient(circle, var(--surprise-color), var(--title-color)); 
            color: white; 
            border-color: var(--surprise-color); 
        }
        .card-face-back .card-title { 
            font-size: 1.1rem; 
            margin-bottom: 5px; 
        }
        .card-face-back .card-desc { 
            font-size: 0.8rem; 
        }
        #card-prizes-list { 
            list-style-type: 'üÉè'; 
            text-align: left; 
            padding-left: 20px; 
            font-size: 0.9rem; 
            line-height: 1.6; 
        }

        #warehouse-items-container { 
            display: flex; 
            flex-direction: column; 
            gap: 15px; 
            width: 100%; 
            max-width: 500px; 
        }
        .warehouse-item { 
            background-color: rgba(0,0,0,0.05); 
            padding: 15px; 
            border-radius: 10px; 
            border: 1px solid var(--border-color-idle); 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            gap: 10px; 
        }
        .warehouse-item-info { 
            text-align: left; 
            flex-grow: 1; 
        }
        .warehouse-item-desc { 
            font-weight: bold; 
        }
        .warehouse-item-expiry { 
            font-size: 0.8rem; 
            opacity: 0.8; 
            margin-top: 5px; 
        }
        .activate-prize-button { 
            background-color: var(--correct-color); 
            color: white; 
            border: none; 
            padding: 8px 12px; 
            border-radius: 8px; 
            font-weight: 700; 
            cursor: pointer; 
            white-space: nowrap; 
        }
        .activate-prize-button:disabled { 
            background-color: var(--absent-color); 
        }
    </style>
</head>
<body class="theme-classic">
    <div id="game-container">
        <div id="top-right-hud">
             <div id="insurance-display" title="Biztos√≠t√°sok">
                <svg viewBox="0 0 24 24"><path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4z"></path></svg>
                <span id="insurance-display-count">0</span>
            </div>
            <div id="warehouse-display" title="Szerencse Rakt√°r">
                <svg viewBox="0 0 24 24"><path d="M20 6h-4V4c0-1.11-.89-2-2-2h-4c-1.11 0-2 .89-2 2v2H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-6 0h-4V4h4v2z"></path></svg>
                <span id="warehouse-display-count">0</span>
            </div>
        </div>

        <div id="new-hour-notification">
            <span>√öj feladv√°nyok el√©rhet≈ëk!</span>
            <button id="new-hour-refresh-button">Friss√≠t√©s</button>
        </div>
        <input type="text" id="hidden-input" style="position: absolute; left: -9999px; opacity: 0; width: 1px; height: 1px;" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
        <header>
            <div id="header-main">
                <div id="logo-container">
                    <svg id="logo-svg" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                        <defs>
                            <linearGradient id="grad1" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop class="grad-stop1" offset="0%" style="stop-color: var(--title-color);stop-opacity:1" />
                                <stop class="grad-stop2" offset="100%" style="stop-color: var(--text-color);stop-opacity:1" />
                            </linearGradient>
                        </defs>
                        <circle class="logo-circle" cx="50" cy="50" r="40" stroke-width="12"/>
                        <line class="logo-handle" x1="32" y1="72" x2="5" y2="95" stroke-width="16" stroke-linecap="round"/>
                        <text class="logo-text" x="50" y="62" font-family="Fredoka One, cursive" font-size="38" text-anchor="middle">Sz√≥</text>
                    </svg>
                </div>
                <div style="text-align: center; position: relative;">
                    <div id="title-container">
                        <h1>Nyomoz√≥</h1>
                        <div id="theme-toggle-button" title="Sz√≠nt√©ma v√°laszt√°sa">
                            <svg viewBox="0 0 24 24"><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"></path></svg>
                        </div>
                    </div>
                    <div id="copyright-notice">¬© by Robi</div>
                    <div id="theme-picker" style="display: none;"></div>
                </div>
            </div>
            <div id="weekly-score-display">Heti pontsz√°m: <span>0</span></div>
             <div id="keyboard-toggle-container">
                <label for="keyboard-toggle-checkbox">Eszk√∂z billenty≈±zet haszn√°lata: </label>
                <input type="checkbox" id="keyboard-toggle-checkbox" title="Ha bepip√°lod, a j√°t√©k billenty≈±zete elt≈±nik, √©s a saj√°todat haszn√°lhatod.">
            </div>
        </header>
        
        <div id="daily-winning-numbers-display" class="lotto-ticket-stub" style="display: none;"></div>
        <div id="weekly-winning-numbers-display" class="lotto-ticket-stub" style="display: none;"></div>
        
        <div id="word-tracker"></div>

        <div id="bonus-unlock-container" style="display: none;">
            <div id="bonus-unlock-header">
                 <svg id="wheel-logo-svg" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                    <circle cx="50" cy="50" r="45" fill="var(--key-bg)" stroke="var(--title-color)" stroke-width="8"/>
                    <path d="M50 5 L50 95 M5 50 L95 50 M20 20 L80 80 M20 80 L80 20" stroke="rgba(0,0,0,0.1)" stroke-width="6"/>
                    <circle cx="50" cy="50" r="15" fill="var(--title-color)"/>
                    <text x="50" y="58" text-anchor="middle" font-size="20" fill="white" font-weight="bold">‚òÖ</text>
                </svg>
                <h2>Szerencseker√©k</h2>
            </div>
            <p>Gy≈±jtsd √∂ssze a j√°t√©k k√∂zben felvillan√≥ 4 jegy≈± k√≥dot a felold√°shoz!</p>
            <div id="code-input-container">
                <input type="number" class="code-input" maxlength="1" data-index="0">
                <input type="number" class="code-input" maxlength="1" data-index="1">
                <input type="number" class="code-input" maxlength="1" data-index="2">
                <input type="number" class="code-input" maxlength="1" data-index="3">
            </div>
            <button id="check-code-button">K√≥d bev√°lt√°sa</button>
        </div>
        <button id="play-wheel-button">üèÜ Szerencseker√©k J√°t√©k üèÜ</button>
        
        <div id="info-bar">
        </div>

        <main id="grid-container"></main>
        
        <div id="hint-display-area"></div>
        
        <div id="hint-controls">
            <button id="request-text-hint-button" class="hint-button">Sz√∂veges seg√≠ts√©g</button>
            <button id="request-letter-hint-button" class="hint-button">Bet≈± felfed√©se</button>
        </div>
        
        <div id="keyboard-container"></div>

        <div id="idle-message-container" style="display: none;"></div>
        
        <div id="lotto-container">
            <div id="lotto-header">
                <svg id="lotto-logo-svg" class="lotto-logo-svg" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                   <path d="M50 2 L61.8 38.2 L98 38.2 L68.1 61.8 L79.9 98 L50 75 L20.1 98 L31.9 61.8 L2 38.2 L38.2 38.2 Z" fill="var(--present-color)" stroke="var(--title-color)" stroke-width="3"/>
                </svg>
                <h2>Napi Lott√≥</h2>
            </div>
            <p>Kattints a j√°t√©khoz!</p>
        </div>

        <div id="weekly-lotto-container">
            <div id="weekly-lotto-header">
                 <svg id="weekly-lotto-logo-svg" class="lotto-logo-svg" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                    <defs>
                        <filter id="glow" x="-50%" y="-50%" width="200%" height="200%">
                            <feGaussianBlur stdDeviation="3.5" result="coloredBlur"></feGaussianBlur>
                            <feMerge>
                                <feMergeNode in="coloredBlur"></feMergeNode>
                                <feMergeNode in="SourceGraphic"></feMergeNode>
                            </feMerge>
                        </filter>
                    </defs>
                    <path d="M50 12 L60 42 L92 42 L66 62 L76 92 L50 75 L24 92 L34 62 L8 42 L40 42 Z" fill="rgba(255, 255, 255, 0.5)" transform="rotate(5 50 50)"/>
                    <path d="M50 2 L61.8 38.2 L98 38.2 L68.1 61.8 L79.9 98 L50 75 L20.1 98 L31.9 61.8 L2 38.2 L38.2 38.2 Z" fill="var(--surprise-color)" stroke="var(--title-color)" stroke-width="4" style="filter: url(#glow);" />
                </svg>
                <h2>Heti Extra Lott√≥</h2>
            </div>
            <p>Kattints a j√°t√©khoz!</p>
        </div>

        <div id="rules-container">
             <h3>J√°t√©kszab√°lyok</h3>
            <ul>
                <li><strong>Alapj√°t√©k:</strong> √ìr√°nk√©nt 5 √∫j, mindenki sz√°m√°ra azonos sz√≥t kapsz. A 7 bet≈±n√©l hosszabb szavak 2 aj√°nd√©k bet≈±vel indulnak, melyek mindenkin√©l azonosak!</li>
                <li><strong>Heti Pontoz√°s:</strong> A pontjaidat h√©tf≈ë 0:00-t√≥l vas√°rnap 23:59-ig gy≈±jtheted. A h√©t v√©g√©n a pontsz√°m null√°z√≥dik.</li>
                <li><strong>Titkos K√≥d:</strong> Figyeld a k√≥d beviteli mez≈ëit, mert ott villannak fel a titkos sz√°mjegyek! A k√≥dot egy √≥r√°n bel√ºl t√∂bbsz√∂r is bev√°lthatod, ha megjegyzed.</li>
                <li><strong>Szerencseker√©k:</strong> Ha az √∂sszes sz√≥t megfejted VAGY be√≠rod a helyes k√≥dot, feloldod a b√≥nusz j√°t√©kot. A j√°t√©k ut√°n a gomb elt≈±nik, de a k√≥d √∫jra be√≠r√°s√°val ism√©t j√°tszhatsz.</li>
                <li><strong>Ker√©k K√ºl√∂nlegess√©gek:</strong> A ker√©ken a pontokon √©s a CS≈êD-√∂n k√≠v√ºl tal√°lkozhatsz FELEZ≈ê, DUPL√ÅZ√ì, TRIPL√ÅZ√ì, BIZTOS√çT√ÅS, JACKPOT, √©s m√°s k√ºl√∂nleges mez≈ëkkel is!</li>
                <li><strong>Cs≈ëd & Biztos√≠t√°s:</strong> Ha CS≈êD-√∂t p√∂rgetsz, a j√°t√©k automatikusan felhaszn√°l egy biztos√≠t√°st (ha van). Ha nincs, els≈ë alkalommal csak a k√∂r√∂s pontjaidat vesz√≠ted el. A m√°sodik CS≈êD ugyanabban a k√∂rben a t√©ted elveszt√©s√©vel j√°r √©s v√©get vet a j√°t√©knak.</li>
                <li><strong>Biztos√≠t√°s Limit:</strong> √ìr√°nk√©nt maximum 6 √∫j biztos√≠t√°st szerezhetsz a Szerencseker√©ken. A megl√©v≈ëk megmaradnak.</li>
                <li><strong style="color:var(--fail-color)">√öjrapr√≥b√°l√°s:</strong> Ha nem siker√ºl egy sz√≥, 15 perc m√∫lva √∫jra pr√≥b√°lkozhatsz, vagy felfedheted a megold√°st. A 20 K√°rtya j√°t√©kban nyerhetsz "Amneszti√°t", ami azonnal t√∂rli ezt a v√°rakoz√°si id≈ët.</li>
            </ul>
        </div>
    </div>

    <div id="lotto-game-overlay" class="overlay">
        <div class="overlay-content">
            <div id="lotto-game-container">
                 <div id="lotto-header-overlay">
                 </div>
                 <h4>Nyerem√©nyek:</h4>
                 <ul id="lotto-prizes-list"></ul>
                <div id="lotto-insufficient-points-message"></div>
                <div id="lotto-game-active-area">
                    <p id="lotto-prompt-text">V√°lassz 5 sz√°mot az al√°bbi r√°csb√≥l.</p>
                    <div id="lotto-grid-overlay"></div>
                    <p id="lotto-selection-counter">0 / 5 kiv√°lasztva</p>
                </div>
                <div id="lotto-overlay-buttons">
                    <button id="close-lotto-overlay-button" class="hint-button">Bez√°r√°s</button>
                    <button id="submit-lotto-button-overlay" class="hint-button">Szelv√©ny felad√°sa</button>
                </div>
                <div id="lotto-overlay-message"></div>
            </div>
        </div>
    </div>

    <div id="prize-choice-overlay" class="overlay">
        <div class="overlay-content">
            <div id="prize-choice-container">
                <h2>Gratul√°lunk, t√∂bb nyerem√©nyt is el√©rt√©l!</h2>
                <p>V√°lassz egyet az al√°bbiak k√∂z√ºl. A nyerem√©nyed a Rakt√°rba ker√ºl.</p>
                <div id="prize-choice-options">
                </div>
            </div>
        </div>
    </div>
    
    <div id="wheel-game-overlay" class="overlay">
        <div class="overlay-content">
            <div id="wheel-game-container">
                <h2>Szerencseker√©k</h2>
                <div id="wheel-round-display"></div>
                <div id="wheel-game-ui">
                    <div id="wheel-stats-container">
                        <div id="wheel-stake-display">T√©t: <span id="stake-amount">0</span></div>
                        <div id="wheel-winnings-display">K√∂r√∂s Nyerem√©ny: <span id="player-score">0</span></div>
                    </div>
                    <div id="puzzle-category"></div>
                    <div id="puzzle-board"></div>
                    <div id="wheel-alphabet-panel"></div>
                    <div id="wheel-message-display"></div>
                    <div id="wheel-wrapper">
                        <div id="wheel-pointer"></div>
                        <svg id="wheel" viewBox="0 0 100 100"></svg>
                    </div>
                    <div id="power-meter-container" title="Kattints a p√∂rget√©shez, majd a megfelel≈ë er≈ëss√©gn√©l √∫jra a meg√°ll√≠t√°shoz!">
                        <div id="power-meter-bar"></div>
                    </div>
                    <div id="wheel-controls">
                        <button id="buy-vowel-button" class="hint-button">Mag√°nhangz√≥</button>
                        <button id="spin-button" class="hint-button">P√∂rget√©s</button>
                        <button id="solve-button" class="hint-button">Megfejtem</button>
                    </div>
                     <div id="wheel-decision-controls" style="display: none;">
                        <button id="cash-out-button" class="hint-button">Nyerem√©ny felv√©tele</button>
                        <button id="next-round-button" class="hint-button">K√∂vetkez≈ë k√∂r</button>
                    </div>
                </div>
                <button id="close-wheel-button" class="overlay-button" style="display: none;">Bez√°r√°s</button>
            </div>
        </div>
    </div>

    <div id="card-game-overlay" class="overlay">
        <div class="overlay-content">
            <div id="card-game-container">
                <h2>B√≥nusz J√°t√©k: 20 K√°rtya</h2>
                <p>Gratul√°lunk a 3. k√∂rh√∂z! V√°lassz egy k√°rty√°t a v√©gs≈ë nyerem√©ny√©rt!</p>
                <div id="card-board"></div>
                <div id="card-game-message" style="font-weight: bold; min-height: 1.5em;"></div>
                <div>
                    <h4>Lehets√©ges lapok:</h4>
                    <ul id="card-prizes-list"></ul>
                </div>
                <button id="collect-winnings-button" class="overlay-button" style="display: none;">Nyerem√©ny begy≈±jt√©se</button>
            </div>
        </div>
    </div>

    <div id="warehouse-overlay" class="overlay">
        <div class="overlay-content">
            <h2>Szerencse Rakt√°r</h2>
            <p>Itt t√°rolod a lott√≥n nyert, m√©g fel nem haszn√°lt nyerem√©nyeidet. Aktiv√°ld ≈ëket, miel≈ëtt lej√°rnak!</p>
            <div id="warehouse-items-container">
            </div>
            <button id="close-warehouse-button" class="overlay-button">Bez√°r√°s</button>
        </div>
    </div>


    <script>
            document.addEventListener('DOMContentLoaded', () => {
        const wordData = [
            {word:"L√ÅMPA", category:"T√°rgy", difficulty:"K√∂nny≈±", hints:["F√©nyt ad a s√∂t√©tben.", "Lehet asztali vagy √°ll√≥.", "Villanyk√∂rte van benne.", "Kapcsol√≥val m≈±k√∂dik."]},
            {word:"KULACS", category:"T√°rgy", difficulty:"K√∂nny≈±", hints:["Italt t√°rolnak benne.", "T√∫r√°z√≥k gyakran viszik magukkal.", "Lehet f√©mb≈ël vagy m≈±anyagb√≥l.", "Kupakkal z√°r√≥dik."]},
            {word:"RAD√çR", category:"Iskolaszer", difficulty:"K√∂nny≈±", hints:["Ceruza nyom√°t t√ºnteti el.", "Iskolat√°sk√°ban lakik.", "Lehet illatos is.", "Haszn√°lat k√∂zben morzs√°l√≥dik."]},
            {word:"KANAP√â", category:"B√∫tor", difficulty:"K√∂nny≈±", hints:["A nappaliban tal√°lhat√≥.", "T√∂bb ember is le√ºlhet r√°.", "P√°rn√°k teszik k√©nyelmess√©.", "Lehet √°ggy√° alak√≠tani."]},
            {word:"V√ñD√ñR", category:"Eszk√∂z", difficulty:"K√∂nny≈±", hints:["Folyad√©kot vagy szil√°rd anyagot hordanak benne.", "Van egy f√ºle.", "Homokoz√≥ban is haszn√°lj√°k.", "Felmos√°shoz elengedhetetlen."]},
            {word:"PITE", category:"√âtel", difficulty:"K√∂nny≈±", hints:["√âdes s√ºtem√©ny.", "Gyakran gy√ºm√∂lcs a t√∂ltel√©ke.", "Lehet r√°csos a teteje.", "Az alm√°s a legn√©pszer≈±bb."]},
            {word:"TORONY", category:"√âp√ºlet", difficulty:"K√∂nny≈±", hints:["Magasabb, mint a k√∂rnyezete.", "Lehet templom vagy v√°r r√©sze.", "Gyakran √≥ra van rajta.", "Rapunzel ebben raboskodott."]},
            {word:"CSAVAR", category:"T√°rgy", difficulty:"K√∂nny≈±", hints:["Dolgok r√∂gz√≠t√©s√©re szolg√°l.", "Menetes a sz√°ra.", "Csavarh√∫z√≥val lehet behajtani.", "Az anya a p√°rja."]},
            {word:"SZ√âK", category:"B√∫tor", difficulty:"K√∂nny≈±", hints:["√úl√©sre haszn√°lj√°k.", "N√©gy l√°ba van √°ltal√°ban.", "Az asztal mellett a helye.", "Van h√°tt√°ml√°ja."]},
            {word:"KAL√ÅCS", category:"√âtel", difficulty:"K√∂nny≈±", hints:["√âdes kelt t√©szta.", "H√∫sv√©tkor n√©pszer≈±.", "Gyakran fonott alak√∫.", "Lehet kaka√≥s vagy mazsol√°s."]},
            {word:"SAJT", category:"√âtel", difficulty:"K√∂nny≈±", hints:["Tejb≈ël k√©sz√ºl.", "Lehet lyukas.", "Egerek kedvence a mes√©kben.", "Pizz√°ra is teszik."]},
            {word:"F√âS≈∞", category:"T√°rgy", difficulty:"K√∂nny≈±", hints:["Haj√°pol√°si eszk√∂z.", "Rendet tesz a gubancos tincsek k√∂z√∂tt.", "Sok foga van.", "Lehet lapos vagy k√∂r alak√∫."]},
            {word:"P√ÅLMA", category:"N√∂v√©ny", difficulty:"K√∂nny≈±", hints:["Tr√≥pusi fa.", "A tengerpartok jellegzetess√©ge.", "Nagy, legyez≈ëszer≈± levelei vannak.", "Term√©se a k√≥kuszdi√≥."]},
            {word:"GY≈∞R≈∞", category:"√âkszer", difficulty:"K√∂nny≈±", hints:["Ujjra h√∫zva viselik.", "Lehet aranyb√≥l vagy ez√ºstb≈ël.", "A h√°zass√°g jelk√©pe.", "A hatalomnak is szimb√≥luma lehet."]},
            {word:"BICIKLI", category:"J√°rm≈±", difficulty:"K√∂nny≈±", hints:["K√©t kereke van.", "Ped√°llal kell hajtani.", "A korm√°ny√°val ir√°ny√≠tj√°k.", "Cseng≈ë van rajta."]},
            {word:"ZONGORA", category:"Hangszer", difficulty:"Neh√©z", hints:["Billenty≈±kkel sz√≥laltatj√°k meg.", "Fekete √©s feh√©r billenty≈±i vannak.", "Koncerttermek gyakori szerepl≈ëje.", "A kalap√°csok h√∫rokat √ºtnek benne."]},
            {word:"TELESZK√ìP", category:"Eszk√∂z", difficulty:"Neh√©z", hints:["√âgitestek megfigyel√©s√©re haszn√°lj√°k.", "Lencs√©k vagy t√ºkr√∂k seg√≠ts√©g√©vel nagy√≠t.", "Csillagvizsg√°l√≥kban tal√°lhat√≥.", "Galilei is haszn√°lta."]},
            {word:"K√ñNYVT√ÅR", category:"Hely", difficulty:"Neh√©z", hints:["Nagyon sok k√∂nyv tal√°lhat√≥ itt.", "Csendben kell lenni benne.", "K√∂lcs√∂n√∂zni lehet bel≈ële.", "Egyik fajt√°ja a digit√°lis."]},
            {word:"REKL√ÅM", category:"M√©dia", difficulty:"Neh√©z", hints:["Term√©kek vagy szolg√°ltat√°sok n√©pszer≈±s√≠t√©s√©re szolg√°l.", "Megszak√≠thatja a filmet.", "Lehet √≥ri√°splak√°ton is.", "A c√©lja a v√°s√°rl√°sra √∂szt√∂nz√©s."]},
            {word:"RENDEZ≈ê", category:"Foglalkoz√°s", difficulty:"Neh√©z", hints:["Filmek vagy sz√≠ndarabok alkot√≥ja.", "≈ê ir√°ny√≠tja a sz√≠n√©szeket.", "Instrukci√≥kat ad a st√°bnak.", "A neve a st√°blista elej√©n szerepel."]},
            {word:"SZIMF√ìNIA", category:"Zene", difficulty:"Neh√©z", hints:["Nagyzenekarra √≠rt, t√∂bb t√©telb≈ël √°ll√≥ m≈±.", "Beethoven h√≠reseket kompon√°lt.", "A koncertteremben hallhat√≥.", "A karmester vez√©nyli."]},
            {word:"V√çZES√âS", category:"Term√©szet", difficulty:"Neh√©z", hints:["A foly√≥v√≠z hirtelen es√©se a m√©lybe.", "Nagy robajjal j√°rhat.", "A Niagara a legh√≠resebb.", "L√°tv√°nyos term√©szeti k√©pz≈ëdm√©ny."]},
            {word:"PIRAMIS", category:"√âp√≠tm√©ny", difficulty:"Neh√©z", hints:["G√∫la alak√∫ √©p√≠tm√©ny.", "Az √≥kori Egyiptomban √©p√≠tett√©k.", "A f√°ra√≥k temetkez√©si helye volt.", "A g√≠zai a legnagyobb."]},
            {word:"GY√âM√ÅNT", category:"√Åsv√°ny", difficulty:"Neh√©z", hints:["A legkem√©nyebb term√©szetes anyag.", "√âkszereket k√©sz√≠tenek bel≈ële.", "Nagy nyom√°son keletkezik a sz√©nb≈ël.", "Az eljegyz√©si gy≈±r≈±k k√∂ve."]},
            {word:"BAJNOKS√ÅG", category:"Sport", difficulty:"Neh√©z", hints:["Sportcsapatok vagy egy√©nek versenysorozata.", "A gy≈ëztes kup√°t kap.", "Lehet orsz√°gos vagy vil√°g-.", "A v√©g√©n tabell√°t hirdetnek."]},
            {word:"GALAXIS", category:"Csillag√°szat", difficulty:"Neh√©z", hints:["Csillagok, g√°z √©s por hatalmas rendszere.", "A Tej√∫trendszer a mi√©nk.", "Lehet spir√°l vagy elliptikus alak√∫.", "Az Androm√©da a szomsz√©dunk."]},
            {word:"ROBOT", category:"Technol√≥gia", difficulty:"Neh√©z", hints:["Programozott feladatokat hajt v√©gre.", "Lehet emberi alakja.", "Az iparban gyakran haszn√°lj√°k.", "A mesters√©ges intelligencia m≈±k√∂dteti."]},
            {word:"F≈êV√ÅROS", category:"F√∂ldrajz", difficulty:"Neh√©z", hints:["Egy orsz√°g k√∂zponti, legfontosabb v√°rosa.", "Itt tal√°lhat√≥ a korm√°ny.", "Budapest Magyarorsz√°g√©.", "√Åltal√°ban a legnagyobb telep√ºl√©s."]},
            {word:"SIVATAG", category:"Term√©szet", difficulty:"Neh√©z", hints:["Sz√°raz, csapad√©kszeg√©ny ter√ºlet.", "A Szahara a legnagyobb a F√∂ld√∂n.", "A tev√©k j√≥l b√≠rj√°k.", "Nappal forr√≥s√°g, √©jjel fagy jellemzi."]},
            {word:"UNIVERZUM", category:"Tudom√°ny", difficulty:"Neh√©z", hints:["Minden l√©tez≈ë √∂sszess√©ge.", "Csillag√°szok kutatj√°k a m√©ret√©t.", "Az ≈ësrobban√°ssal keletkezett elm√©letileg.", "T√°gul√≥ban van."]},
            {word:"LEGENDA", category:"Irodalom", difficulty:"Neh√©z", hints:["T√∂rt√©nelmi alappal rendelkez≈ë, de csod√°s elemekkel √°tsz≈ëtt t√∂rt√©net.", "H≈ës√∂kr≈ël vagy szentekr≈ël sz√≥lhat.", "Sz√°jhagyom√°ny √∫tj√°n terjed.", "Art√∫r kir√°ly t√∂rt√©nete egy h√≠res p√©lda."]},
            {word:"HORIZONT", category:"Fogalom", difficulty:"Neh√©z", hints:["A l√°that√≥ √©g √©s a f√∂ld tal√°lkoz√°si vonala.", "A tengeren egyenes vonalnak l√°tszik.", "Min√©l magasabban vagy, ann√°l t√°volabbi.", "Soha nem lehet el√©rni."]},
            {word:"KRONOL√ìGIA", category:"Tudom√°ny", difficulty:"Extra Neh√©z", hints:["Id≈ërendi sorrend.", "T√∂rt√©nelmi esem√©nyekn√©l fontos.", "Seg√≠t meg√©rteni az ok-okozati viszonyokat.", "Az esem√©nyek id≈ëbeli egym√°sut√°nis√°ga."]},
            {word:"DEMOKR√ÅCIA", category:"T√°rsadalom", difficulty:"Extra Neh√©z", hints:["N√©puralom.", "Az √≥kori G√∂r√∂gorsz√°gb√≥l sz√°rmazik.", "A polg√°rok v√°laszt√°sokon d√∂ntenek.", "Ellent√©te a diktat√∫ra."]},
            {word:"ABSZTRAKT", category:"M≈±v√©szet", difficulty:"Extra Neh√©z", hints:["Nem √°br√°zol konkr√©t t√°rgyakat vagy alakokat.", "A form√°k √©s sz√≠nek j√°t√©ka a l√©nyeg.", "Piet Mondrian √©s Vaszilij Kandinszkij h√≠res k√©pvisel≈ëje.", "Nonfigurat√≠v m≈±v√©szet."]},
            {word:"ALGORITMUS", category:"Informatika", difficulty:"Extra Neh√©z", hints:["V√©ges sz√°m√∫ l√©p√©sb≈ël √°ll√≥, egy√©rtelm≈± utas√≠t√°ssorozat.", "Egy probl√©ma megold√°s√°ra szolg√°l.", "A sz√°m√≠t√≥g√©pes programok alapja.", "A receptek is hasonl√≠tanak r√°."]},
            {word:"JURISPRUDENCIA", category:"Tudom√°ny", difficulty:"Extra Neh√©z", hints:["Jogtudom√°ny.", "A t√∂rv√©nyekkel √©s a jogrendszerrel foglalkozik.", "Az egyetemeken oktatj√°k.", "A jogszab√°lyok √©rtelmez√©s√©nek √©s alkalmaz√°s√°nak elm√©lete."]},
            {word:"METAMORF√ìZIS", category:"Biol√≥gia", difficulty:"Extra Neh√©z", hints:["√Åtalakul√°s.", "A herny√≥ b√°bb√°, majd pillang√≥v√° v√°lik.", "Az ebihal b√©k√°v√° fejl≈ëdik.", "Jelent≈ës formai √©s szerkezeti v√°ltoz√°s az egyedfejl≈ëd√©s sor√°n."]},
            {word:"INFL√ÅCI√ì", category:"Gazdas√°g", difficulty:"Extra Neh√©z", hints:["A p√©nz v√°s√°rl√≥erej√©nek roml√°sa.", "Az √°rak √°ltal√°nos √©s tart√≥s emelked√©se.", "Sz√°zal√©kban m√©rik.", "A jegybank kamatemel√©ssel k√ºzdhet ellene."]},
            {word:"SZIMBI√ìZIS", category:"Biol√≥gia", difficulty:"Extra Neh√©z", hints:["K√©t k√ºl√∂nb√∂z≈ë faj√∫ √©l≈ël√©ny k√∂lcs√∂n√∂sen el≈ëny√∂s egy√ºtt√©l√©se.", "A boh√≥chal √©s a tengeri r√≥zsa esete.", "A zuzm√≥k gomb√°kb√≥l √©s alg√°kb√≥l √°llnak.", "Az 'egy√ºtt√©l√©s' g√∂r√∂g sz√≥b√≥l sz√°rmazik."]},
            {word:"EUFEMIZMUS", category:"Irodalom", difficulty:"Extra Neh√©z", hints:["Sz√©p√≠t≈ë, enyh√≠t≈ë kifejez√©s.", "Durva vagy kellemetlen dolgok k√∂r√ºl√≠r√°s√°ra haszn√°lj√°k.", "P√©ld√°ul 'elhunyt' a 'meghalt' helyett.", "'Megb√≠zat√°sa megsz≈±nt' a 'kir√∫gt√°k' helyett."]},
            {word:"PARADIGMA", category:"Tudom√°ny", difficulty:"Extra Neh√©z", hints:["Egy adott korban uralkod√≥ tudom√°nyos n√©zetrendszer.", "Kuhn vezette be a tudom√°nyfiloz√≥fi√°ba.", "Egy...-v√°lt√°s forradalmas√≠thatja a tudom√°nyt.", "A newtoni fizika egy p√©lda erre."]},
            {word:"AMBIVALENS", category:"Pszichol√≥gia", difficulty:"Extra Neh√©z", hints:["Ellent√©tes √©rz√©seket, gondolatokat tartalmaz√≥.", "Kett≈ës, ellentmond√°sos.", "Szeret is valakit, meg nem is.", "Vonzza is valami, √©s tasz√≠tja is."]},
            {word:"KVARC", category:"√Åsv√°ny", difficulty:"Extra Neh√©z", hints:["A f√∂ldk√©reg egyik leggyakoribb √°sv√°nya.", "Az √≥r√°kban is haszn√°lj√°k a pontoss√°ga miatt.", "Szil√≠cium-dioxidb√≥l √°ll.", "Hegyi... a legismertebb √°tl√°tsz√≥ v√°ltozata."]},
            {word:"FILANTR√ìP", category:"T√°rsadalom", difficulty:"Extra Neh√©z", hints:["Emberbar√°t, j√≥t√©konykod√≥ szem√©ly.", "Vagyon√°t vagy idej√©t a k√∂zj√≥ szolg√°lat√°ba √°ll√≠tja.", "Adom√°nyoz, alap√≠tv√°nyokat t√°mogat.", "Ellent√©te a mizantr√≥p."]},
            {word:"GENEAL√ìGIA", category:"Tudom√°ny", difficulty:"Extra Neh√©z", hints:["Csal√°dfakutat√°s.", "A sz√°rmaz√°ssal, az ≈ës√∂kkel foglalkozik.", "Seg√≠ts√©g√©vel felder√≠thet≈ë a csal√°di h√°tt√©r.", "A nemesi csal√°dokn√°l k√ºl√∂n√∂sen fontos volt."]},
            {word:"AKROPOLISZ", category:"T√∂rt√©nelem", difficulty:"Extra Neh√©z", hints:["√ìkori g√∂r√∂g v√°rosok fellegv√°ra.", "Magaslatra √©p√ºlt, fallal k√∂r√ºlvett r√©sz.", "Az ath√©ni a legh√≠resebb.", "A Parthen√≥n is itt tal√°lhat√≥."]}
        ];

        const wheelPuzzles = [
            { category: "K√∂zmond√°s", puzzle: "JOBB K√âS≈êN MINT SOHA" },
            { category: "Film & Rendez≈ë", puzzle: "JAMES CAMERON TITANIC" },
            { category: "√âl≈ël√©ny", puzzle: "P√ÅVAKAKAS" },
            { category: "T√°rgy", puzzle: "ELEKTROMOS FOGKEFE" },
            { category: "Fogalom", puzzle: "A TUD√ÅS HATALOM" },
            { category: "√âtel & Ital", puzzle: "R√ÅNTOTT CSIRKECOMB HAS√ÅBBURGONY√ÅVAL" },
            { category: "Zene", puzzle: "THE BEATLES HEY JUDE" },
            { category: "H√≠res Ember", puzzle: "SZ√âCHENYI ISTV√ÅN" },
            { category: "F√∂ldrajz", puzzle: "AZ AMAZONAS ES≈êERD≈ê" },
            { category: "T√∂rt√©nelem", puzzle: "A K√ñNYVNYOMTAT√ÅS FELTAL√ÅL√ÅSA" },
            { category: "Irodalom", puzzle: "G√ÅRDONYI G√âZA EGRI CSILLAGOK" },
            { category: "Sport", puzzle: "FORMA EGY VIL√ÅGBAJNOKS√ÅG" },
            { category: "Tudom√°ny", puzzle: "CHARLES DARWIN EVOL√öCI√ìELM√âLETE" },
            { category: "M√°rkan√©v", puzzle: "LEGO" },
            { category: "Mindennapi √©let", puzzle: "LEK√âSTEM A REGGELI BUSZT" },
            { category: "N√∂v√©ny", puzzle: "NAPRAFORG√ì" },
            { category: "Dalsz√∂veg", puzzle: "NEM VAGYOK IDEGES CSAK AZ IDEGEIMRE MEGY" },
            { category: "T√°rgy", puzzle: "T√ÅVIR√ÅNY√çT√ì" },
            { category: "Fogalom", puzzle: "V√âLETLEN EGYBEES√âS" },
            { category: "√âl≈ël√©ny", puzzle: "SZIB√âRIAI TIGRIS" },
            { category: "K√∂zmond√°s", puzzle: "A P√âNZ NEM BOLDOG√çT" },
            { category: "K√∂zmond√°s", puzzle: "SOK KICSI SOKRA MEGY" },
            { category: "K√∂zmond√°s", puzzle: "A T√úRELEM R√ìZS√ÅT TEREM" },
            { category: "K√∂zmond√°s", puzzle: "REND A LELKE MINDENNEK" },
            { category: "K√∂zmond√°s", puzzle: "KIV√âTEL ER≈êS√çTI A SZAB√ÅLYT" },
            { category: "Film & Rendez≈ë", puzzle: "PETER JACKSON A GY≈∞R≈∞K URA" },
            { category: "Irodalom", puzzle: "MIKSZ√ÅTH K√ÅLM√ÅN A FEKETE V√ÅROS" },
            { category: "Zene", puzzle: "TANKCSAPDA MENNYORSZ√ÅG TOURIST" },
            { category: "H√≠res Ember", puzzle: "M√ÅTY√ÅS KIR√ÅLY" },
            { category: "F√∂ldrajz", puzzle: "A K√çNAI NAGY FAL" },
            { category: "T√∂rt√©nelem", puzzle: "A R√ìMAI BIRODALOM BUK√ÅSA" },
            { category: "Tudom√°ny", puzzle: "A V√çZ FORR√ÅSPONTJA" },
            { category: "√âtel & Ital", puzzle: "CSOKOL√ÅD√â FELF√öJT" },
            { category: "√âl≈ël√©ny", puzzle: "KOLIBRI" },
            { category: "N√∂v√©ny", puzzle: "LEVENDULA" },
            { category: "T√°rgy", puzzle: "VEZET√âK N√âLK√úLI F√úLHALLGAT√ì" },
            { category: "Sport", puzzle: "BAJNOKOK LIG√ÅJA D√ñNT≈ê" },
            { category: "M√°rkan√©v", puzzle: "SAMSUNG" },
            { category: "Mindennapi √©let", puzzle: "NEM TAL√ÅLOM A KULCSOMAT" },
            { category: "Foglalkoz√°s", puzzle: "≈∞RHAJ√ìS" },
            { category: "Csillag√°szat", puzzle: "A NAPRENDSZER BOLYG√ìI" },
            { category: "Irodalom", puzzle: "SHAKESPEARE R√ìME√ì √âS J√öLIA" },
            { category: "K√∂zmond√°s", puzzle: "A REM√âNY HAL MEG UTOLJ√ÅRA" },
            { category: "T√∂rt√©nelem", puzzle: "AZ AMERIKAI F√úGGETLENS√âGI H√ÅBOR√ö" },
            { category: "Tudom√°ny", puzzle: "A FOTOSZINT√âZIS FOLYAMATA" },
            { category: "√âtel & Ital", puzzle: "CS√úLK√ñS BABGULY√ÅS" },
            { category: "Film", puzzle: "VISSZA A J√ñV≈êBE" },
            { category: "Zene", puzzle: "MICHAEL JACKSON THRILLER" },
            { category: "Tudom√°ny", puzzle: "PERIODUSOS RENDSZER" },
            { category: "T√∂rt√©nelem", puzzle: "A TITANIC ELS√úLLYED√âSE" },
            { category: "K√∂zmond√°s", puzzle: "A SZOK√ÅS RABJA" },
            { category: "√âl≈ël√©ny", puzzle: "OROSZL√ÅNKIR√ÅLY" },
            { category: "H√≠res Hely", puzzle: "AZ EIFFEL TORONY P√ÅRIZSBAN" }
        ];

        const MAX_GUESSES = 6;
        let gameData = {};
        let timerInterval;
        let cooldownIntervals = {};
        let wheelMessageTimeout = null;
        let randomMessageInterval = null;
        let idleCountdownInterval = null;
        let secretCodeFlasherInterval = null;
        let activeHints = { text: [], letterIndices: [], usedCount: 0 };
        const RETRY_COOLDOWN_MS = 15 * 60 * 1000;
        
                const body = document.body;
        const hiddenInput = document.getElementById('hidden-input');
        const gridContainer = document.getElementById('grid-container');
        const keyboardContainer = document.getElementById('keyboard-container');
        const requestTextHintButton = document.getElementById('request-text-hint-button');
        const requestLetterHintButton = document.getElementById('request-letter-hint-button');
        const wordTrackerContainer = document.getElementById('word-tracker');
        const weeklyScoreDisplaySpan = document.querySelector('#weekly-score-display span');
        const insuranceDisplay = document.getElementById('insurance-display');
        const insuranceDisplayCount = document.getElementById('insurance-display-count');
        const warehouseDisplay = document.getElementById('warehouse-display');
        const warehouseDisplayCount = document.getElementById('warehouse-display-count');
        const newHourNotification = document.getElementById('new-hour-notification');
        const bonusUnlockContainer = document.getElementById('bonus-unlock-container');
        const codeInputContainer = document.getElementById('code-input-container');
        const codeInputs = document.querySelectorAll('.code-input');
        const checkCodeButton = document.getElementById('check-code-button');
        const playWheelButton = document.getElementById('play-wheel-button');
        const keyboardToggleCheckbox = document.getElementById('keyboard-toggle-checkbox');
        const wheelGameOverlay = document.getElementById('wheel-game-overlay');
        const closeWheelButton = document.getElementById('close-wheel-button');
        const wheel = document.getElementById('wheel');
        const spinButton = document.getElementById('spin-button');
        const buyVowelButton = document.getElementById('buy-vowel-button');
        const powerMeterBar = document.getElementById('power-meter-bar');
        const powerMeterContainer = document.getElementById('power-meter-container');
        const playerScoreEl = document.getElementById('player-score');
        const stakeAmountEl = document.getElementById('stake-amount');
        const puzzleBoardEl = document.getElementById('puzzle-board');
        const puzzleCategoryEl = document.getElementById('puzzle-category');
        const solveButton = document.getElementById('solve-button');
        const wheelMessageDisplay = document.getElementById('wheel-message-display');
        const wheelRoundDisplay = document.getElementById('wheel-round-display');
        const wheelDecisionControls = document.getElementById('wheel-decision-controls');
        const cashOutButton = document.getElementById('cash-out-button');
        const nextRoundButton = document.getElementById('next-round-button');
        const themeToggleButton = document.getElementById('theme-toggle-button');
        const themePicker = document.getElementById('theme-picker');
        const infoBar = document.getElementById('info-bar');
        const hintDisplayArea = document.getElementById('hint-display-area');
        const idleMessageContainer = document.getElementById('idle-message-container');
        const hintControls = document.getElementById('hint-controls');
        const wheelAlphabetPanel = document.getElementById('wheel-alphabet-panel');
        const cardGameOverlay = document.getElementById('card-game-overlay');
        const cardBoard = document.getElementById('card-board');
        const cardGameMessage = document.getElementById('card-game-message');
        const collectWinningsButton = document.getElementById('collect-winnings-button');
        const cardPrizesList = document.getElementById('card-prizes-list');
        const lottoGameOverlay = document.getElementById('lotto-game-overlay');
        const prizeChoiceOverlay = document.getElementById('prize-choice-overlay');
        const lottoContainer = document.getElementById('lotto-container');
        const weeklyLottoContainer = document.getElementById('weekly-lotto-container');
        const lottoGridOverlay = document.getElementById('lotto-grid-overlay');
        const lottoSelectionCounter = document.getElementById('lotto-selection-counter');
        const submitLottoButtonOverlay = document.getElementById('submit-lotto-button-overlay');
        const lottoOverlayMessage = document.getElementById('lotto-overlay-message');
        const lottoInsufficientPointsMessage = document.getElementById('lotto-insufficient-points-message');
        const lottoPrizesList = document.getElementById('lotto-prizes-list');
        const lottoGameActiveArea = document.getElementById('lotto-game-active-area');
        const closeLottoOverlayButton = document.getElementById('close-lotto-overlay-button');
        const winningLottoNumbersContainer = document.querySelector('#daily-winning-numbers-display');
        const winningWeeklyLottoNumbersContainer = document.querySelector('#weekly-winning-numbers-display');
        const warehouseOverlay = document.getElementById('warehouse-overlay');
        const closeWarehouseButton = document.getElementById('close-warehouse-button');
        const warehouseItemsContainer = document.getElementById('warehouse-items-container');

                let selectedLottoNumbers = [];
        let currentLottoType = 'daily';
        
        const themes = [ { name: "Klasszikus", className: "theme-classic", color: "#3d405b" }, { name: "Erdei", className: "theme-forest", color: "#2d6a4f" }, { name: "√ìce√°n", className: "theme-ocean", color: "#0077b6" }, { name: "Naplemente", className: "theme-sunset", color: "#f77f00" }, { name: "√âjszakai", className: "theme-night", color: "#232526" }, { name: "R√≥zsa", className: "theme-rose", color: "#c9184a" }, { name: "Vintage", className: "theme-vintage", color: "#a27b5c" }, { name: "R√©t", className: "theme-meadow", color: "#7cb518" }, { name: "Kir√°lyi", className: "theme-royal", color: "#5a189a" }, { name: "Hacker", className: "theme-hacker", color: "#00ff00" } ];
        const KEY_LAYOUT = [ ['Q', 'W', 'E', 'R', 'T', 'Z', 'U', 'I', 'O', 'P', '≈ê', '√ñ', '√ú', '√ì'], ['A', 'S', 'D', 'F', 'G', 'H', 'J', 'K', 'L', '√â', '√Å', '≈∞'], ['Enter', 'Y', 'X', 'C', 'V', 'B', 'N', 'M', '√ç', 'Backspace'] ];
        
        const wheelSegmentsR1 = [ { label: '250', value: 250, color: '#a5d6a7' }, { label: 'CS≈êD', value: 'bankrupt', color: 'var(--fail-color)' }, { label: '500', value: 500, color: '#b39ddb' }, { label: '√öJRA!', value: 'spin_again', color: '#ffeb3b' }, { label: 'FELEZ≈ê', value: 'halver', color: '#ff7043' }, { label: '750', value: 750, color: '#f2cc8f' }, { label: 'BIZTOS√çT√ÅS', value: 'insurance', color: 'var(--insurance-color)' }, { label: '1000', value: 1000, color: '#81b29a' }, { label: '+1 BET≈∞', value: 'reveal_letter', color: '#4dd0e1' }, { label: 'TIPP +', value: 'free_hint', color: '#00bcd4' }, { label: '250', value: 250, color: '#a5d6a7' }, { label: '1500', value: 1500, color: '#e07a5f' }];
        const wheelSegmentsR2 = [ { label: '1000', value: 1000, color: '#a5d6a7' }, { label: 'CS≈êD', value: 'bankrupt', color: 'var(--fail-color)' }, { label: '1500', value: 1500, color: '#b39ddb' }, { label: 'FELEZ≈ê', value: 'halver', color: '#ff7043' }, { label: '2500', value: 2500, color: '#f2cc8f' }, { label: 'BIZTOS√çT√ÅS', value: 'insurance', color: 'var(--insurance-color)' }, { label: '3000', value: 3000, color: '#81b29a' }, { label: 'TRIPL√ÅZ√ì', value: 'tripler', color: '#ffb300' }, { label: 'REJT√âLY', value: 'mystery', color: '#ba68c8' }, { label: '1000', value: 1000, color: '#a5d6a7' }, { label: 'DUPL√ÅZ√ì', value: 'double', color: '#ff9800' }, { label: '5000', value: 5000, color: '#e07a5f' }];
        const wheelSegmentsR3 = [ { label: '5000', value: 5000, color: '#a5d6a7' }, { label: 'CS≈êD', value: 'bankrupt', color: 'var(--fail-color)' }, { label: '7500', value: 7500, color: '#b39ddb' }, { label: 'FELEZ≈ê', value: 'halver', color: '#ff7043' }, { label: '10000', value: 10000, color: '#f2cc8f' }, { label: 'BIZTOS√çT√ÅS', value: 'insurance', color: 'var(--insurance-color)' }, { label: '15000', value: 15000, color: '#81b29a' }, { label: 'JACKPOT', value: 'jackpot', color: '#fbc02d' }, { label: 'K√ÅRTYAH√öZ√ÅS', value: 'card_draw', color: '#673ab7' }, { label: 'DUPL√ÅZ√ì', value: 'double', color: '#ff9800' }, { label: 'MEGLEPET√âS', value: 'surprise', color: 'var(--surprise-color)' }, { label: '25000', value: 25000, color: '#e07a5f' }];
        const wheelSegmentSets = [null, wheelSegmentsR1, wheelSegmentsR2, wheelSegmentsR3];
        let wheelState = {};
        const FULL_ALPHABET = "A√ÅBCDE√âFGHI√çJKLMNO√ì√ñ≈êPQRSTU√ö√ú≈∞VXYZ";
        const VOWELS = "A√ÅE√âI√çO√ì√ñ≈êU√ö√ú≈∞";
        
                const LOTTO_PRIZES_META = {
            1: { prizeId: 'D1', title: "1 Tal√°lat", desc: "+1 ingyen sz√∂veges seg√≠ts√©g" },
            2: { prizeId: 'D2', title: "2 Tal√°lat", desc: "+3 ingyen mag√°nhangz√≥ a Szerencseker√©kben" },
            3: { prizeId: 'D3', title: "3 Tal√°lat", desc: "Korl√°tlan biztos√≠t√°s (1 napig)" },
            4: { prizeId: 'D4', title: "4 Tal√°lat", desc: "Cs≈ëdmentess√©g (1 napig)" },
            5: { prizeId: 'D5', title: "5 Tal√°lat", desc: "Ingyenes Szerencseker√©k (1 napig)" }
        };
        
        const WEEKLY_LOTTO_PRIZES_META = {
            1: { prizeId: 'W1', title: "1 Tal√°lat: Napi Ingyen Tipp", desc: "A k√∂vetkez≈ë 7 napban naponta +1 ingyen sz√∂veges tipp." },
            2: { prizeId: 'W2', title: "2 Tal√°lat: Napi Dupla Pont", desc: "A k√∂vetkez≈ë 7 napban minden megfejt√©s√©rt dupla pont j√°r." },
            3: { prizeId: 'W3', title: "3 Tal√°lat: Korl√°tlan Szerencseker√©k", desc: "A k√∂vetkez≈ë 7 napban a Szerencseker√©k ingyenes." },
            4: { prizeId: 'W4', title: "4 Tal√°lat: Heti Szuper Joker", desc: "A k√∂vetkez≈ë 7 napban minden seg√≠ts√©g ingyenes." },
            5: { prizeId: 'W5', title: "5 Tal√°lat: F≈êNYEREM√âNY", desc: "Azonnali 5,000,000 pont!" }
        };

        const FUNNY_IDLE_MESSAGES = [ { title: "T√ºrelmi id≈ë", text: "Az inform√°torunk a k√∂vetkez≈ë √≥r√°ban jelentkezik √∫jabb nyomokkal. Addig is..." }, { title: "K√°v√©sz√ºnet a rend≈ërs√∂n", text: "M√©g a legjobb nyomoz√≥knak is j√°r egy f√°nk. Am√≠g eszel, a laborosok elemzik a bizony√≠t√©kokat. A k√∂vetkez≈ë adag..." }, { title: "V√°rakoz√°s a s√∂t√©t sik√°torban", text: "√Årny√©kba h√∫z√≥dt√°l, √©s a kapcsolatodra v√°rsz. Azt s√∫gta, a k√∂vetkez≈ë f√ºles..." }, { title: "Akt√°k rendez√©se", text: "Annyi √ºgyet megoldott√°l, hogy a f≈ën√∂k megk√©rt, rakj rendet az irod√°dban. A pap√≠rmunka a legkem√©nyebb di√≥. √öj √ºgyek..." }, ];
        const RANDOM_GAME_MESSAGES = [
            "Ez az √ºgy kem√©nyebb, mint a k√©tnapos zsemle.", "Minden bet≈± egy √∫jabb nyom.", "A meg√©rz√©sem azt s√∫gja, j√≥ √∫ton j√°rsz.",
            "Lassan √∂ssze√°ll a k√©p, mint egy puzzle.", "Csak egy hajsz√°l v√°laszt el a megold√°st√≥l.", "Figyelj a r√©szletekre, a tettes hib√°zni fog!",
            "Ezt a rejt√©lyt m√©g Columbo is megirigyeln√©.", "M√°r majdnem forr√≥ a nyom...", "A logika a legjobb fegyvered.",
            "Minden tipp egy l√©p√©s a megold√°s fel√©.", "N√©ha a legk√©zenfekv≈ëbb megold√°s a helyes.", "Van egy gyan√∫s√≠tottam: az 'X' bet≈±.",
            "A helysz√≠nel≈ëk mindj√°rt itt vannak a seg√≠ts√©ggel.", "B√≠zz a meg√©rz√©√©seidben, nyomoz√≥!", "Ennek a sz√≥nak alibije van?",
            "N√©zz√ºk √°t √∫jra a bizony√≠t√©kokat (bet≈±ket)!"
        ];
        const WHEEL_MESSAGES = {
            start_round: [ "Kezd≈ëdj√∂n a k√∂r!", "√öj feladv√°ny, √∫j es√©ly!", "L√°ssuk, mit tudsz!"],
            power_up_prompt: [ "√Åll√≠tsd be az er≈ëss√©get, majd kattints √∫jra!" ],
            spin_prompt: [ "P√∂rgess egy nagyot!", "J√∂het a p√∂rget√©s!", "Sorsford√≠t√≥ p√∂rget√©s k√∂vetkezik!"],
            spin_result: [ "A ker√©k {value} ponton √°llt meg!", "A szerencse {value} pontot hozott!", "{value} a jutalmad!"],
            guess_consonant: [ "V√°lassz egy m√°ssalhangz√≥t!", "Melyik m√°ssalhangz√≥ra tippelsz?", "J√∂het egy m√°ssalhangz√≥!"],
            buy_vowel_prompt: ["V√°lassz egy mag√°nhangz√≥t!", "Melyik mag√°nhangz√≥t szeretn√©d megvenni?"],
            correct_guess: [ "Ez telital√°lat!", "T√∂k√©letes tipp!", "Benne van!", "Eltal√°ltad!"],
            wrong_guess: [ "Sajnos ez nincs benne.", "Ez a bet≈± most nem seg√≠tett.", "Rossz tipp, de ne add fel!"],
            bankrupt_round_lost: [ "CS≈êD! Elvesztetted a k√∂rben szerzett pontjaidat, de a t√©ted biztons√°gban!", "A CS≈êD elvitte a k√∂r√∂s nyerem√©nyt! Folytathatod." ],
            bankrupt_stake_lost: [ "√öjra cs≈ëd! A j√°t√©kodnak sajnos v√©ge. Elvesztetted a t√©tet is.", "A m√°sodik cs≈ëd v√©gzetes volt. A t√©t el√∫szott." ],
            bankrupt_immune: ["CS≈êD! De szerencs√©d van, egy akt√≠v b√≥nuszod megv√©dett!", "Meg√∫sztad a cs≈ëd√∂t a Rakt√°rb√≥l aktiv√°lt seg√≠ts√©ggel!"],
            insurance_win: [ "BIZTOS√çT√ÅS! Nyert√©l egy v√©delmet a cs≈ëd ellen!", "Szuper! Van egy biztos√≠t√°sod!"],
            insurance_limit_reached: [ "El√©rted az √≥r√°nk√©nti biztos√≠t√°s limidet!", "Ebben az √≥r√°ban m√°r nem szerezhetsz t√∂bbet." ],
            insurance_used: [ "Felhaszn√°lt√°l egy biztos√≠t√°st √©s megmenek√ºlt√©l a cs≈ëdt≈ël!", "A biztos√≠t√°s megmentett, minden pontod biztons√°gban!"],
            double: ["DUPL√ÅZ√ì! A k√∂r nyerem√©nyed megdupl√°z√≥dott!", "Fantasztikus, dupla pontsz√°m a k√∂rben!"],
            tripler: ["TRIPL√ÅZ√ì! A k√∂r nyerem√©nyed megh√°romszoroz√≥dott! Ez igen!", "B√°mulatos, h√°romszoros pontot √©rt√©l el!"],
            halver: ["FELEZ≈ê! √ì, ne! A k√∂r nyerem√©nyed megfelez≈ëd√∂tt.", "A Felez≈ë lecsapott, a k√∂r√∂s pontjaid fele elsz√°llt."],
            spin_again: ["√öJRA! Kapt√°l egy ingyen p√∂rget√©st!", "A ker√©k megkegyelmezett, p√∂rgess √∫jra!"],
            reveal_letter: ["+1 BET≈∞! Felfedek neked egy bet≈±t a t√°bl√°n.", "Aj√°nd√©k bet≈± √©rkezett!"],
            mystery: ["REJT√âLY! L√°ssuk, mit rejteget... {value} pont!", "A Rejt√©ly mez≈ë {value} pontot adott vagy vett el!"],
            jackpot: ["JACKPOT! Gratul√°lunk, bezsebelted a f≈ënyerem√©nyt: 20,000 pont!", "Hihetetlen! Ti√©d a Jackpot!"],
            card_draw: ["K√ÅRTYAH√öZ√ÅS! H√∫zhatsz egy lapot a 20 K√°rtya paklib√≥l!", "Szerencs√©s vagy! V√°lassz egy b√≥nusz k√°rty√°t!"],
            free_hint: ["TIPP+! Kapt√°l egy ingyen tippet az alapj√°t√©khoz!", "Egy ingyen tipp a zsebben!"],
            re_spin: ["SZERENCSEV√ÅLT√ÅS! Ha a k√∂vetkez≈ë p√∂rget√©s nem tetszik, √∫jra pr√≥b√°lkozhatsz.", "Nem tetszik az eredm√©ny? P√∂rgess √∫jra!"],
            surprise_good: ["MEGLEPET√âS! Kapt√°l +1000 pontot!", "A szerencse mell√©d szeg≈ëd√∂tt! +1000 pont!"],
            surprise_bad: ["MEGLEPET√âS! Hopp√°, -500 pont levon√°s.", "Ez a meglepet√©s most nem esett j√≥l... -500 pont."],
            surprise_vowel: ["MEGLEPET√âS! Kapsz egy ingyen mag√°nhangz√≥t!", "A h√°z aj√°nd√©ka egy mag√°nhangz√≥!"],
            joker_wheel: ["JOKER! A Joker a te oldaladon √°ll! Felfedek egy m√°ssalhangz√≥t.", "JOKER! Kapsz egy kis seg√≠ts√©get..."],
            solve_success: [ "Hihetetlen! Helyes a megfejt√©s!", "Gratul√°lunk, zseni√°lis vagy!", "Megcsin√°ltad! Ti√©d a nyerem√©ny!"],
            solve_fail: [ "Sajnos ez nem a helyes megfejt√©s. A j√°t√©k v√©get √©rt.", "Ez most nem j√∂tt √∂ssze. A helyes megfejt√©s: <strong>{solution}</strong>. Elbuktad a t√©tet.", "Rossz v√°lasz. A megold√°s: <strong>{solution}</strong>. A nyerem√©ny elsz√°llt."],
            cash_out: [ "Okos d√∂nt√©s! A nyerem√©ny a zsebedben.", "Gratul√°lunk a nyerem√©nyedhez!", "Sz√©p volt!"],
            next_round: [ "J√∂het a k√∂vetkez≈ë, nehezebb k√∂r!", "A java m√©g csak most j√∂n!", "K√©sz√ºlj a k√∂vetkez≈ë k√∂rre!"],
            not_enough_points: [ "Nincs el√©g pontod ehhez! Sz√ºks√©ges: {cost} pont.", "Ehhez t√∂bb pontra lesz sz√ºks√©ged!"],
            must_spin_first: [ "El≈ëbb p√∂rgetned kell, miel≈ëtt m√°ssalhangz√≥t tippelsz!" ],
            must_guess_consonant: [ "P√∂rget√©s ut√°n m√°ssalhangz√≥t kell mondanod!" ]
        };
        const CARD_DATA = [
            { type: 'total_bankrupt', label: 'Tot√°l Cs≈ëd', description: 'Minden heti pontod elveszik!', cssClass: 'total-bankrupt' },
            { type: 'half', label: 'Felez≈ë', description: 'A b√≥nusz nyerem√©nyed felez≈ëdik.' },
            { type: 'add_points', value: 10000, label: '+10000 Pont', description: 'Nyerem√©nyed jelent≈ësen n≈ë.' },
            { type: 'boss_gift', value: 2500, label: 'A F≈ën√∂k Aj√°nd√©ka', description: 'Azonnali 2500 pont jutalom!', cssClass: 'special-prize' },
            { type: 'add_insurance', label: '+1 Biztos√≠t√°s', description: 'Kapsz egy biztos√≠t√°st a Szerencseker√©khez.', cssClass: 'special-prize' },
            { type: 'free_hint', label: 'Ingyen Tipp', description: 'Kapsz egy ingyenes sz√∂veges tippet az alapj√°t√©khoz.', cssClass: 'special-prize' },
            { type: 'free_vowel', label: 'Ingyen Mag√°nhangz√≥', description: 'Kapsz egy ingyen mag√°nhangz√≥t a Szerencseker√©khez.', cssClass: 'special-prize' },
            { type: 'amnesty', label: 'Amnesztia', description: 'T√∂rli egy rontott sz√≥ 15 perces v√°rakoz√°si idej√©t.', cssClass: 'special-prize' },
            { type: 'point_rain', label: 'Pont Es≈ë', description: 'Nyersz egy v√©letlenszer≈± √∂sszeget 1000 √©s 5000 pont k√∂z√∂tt.' },
            { type: 'witty_message', label: 'Robi √úzenete', description: '‚ÄúA szerencse forgand√≥, de a tud√°s marad!‚Äù' },
            { type: 'time_bonus', label: 'Id≈ëb√≥nusz', description: '+60 mp az √≥ra √∂sszes h√°tral√©v≈ë id≈ëfutam feladv√°ny√°hoz.', cssClass: 'special-prize' },
            { type: 'pick_again', label: '√öjra V√°laszthatsz', description: 'H√∫zhatsz m√©g egy k√°rty√°t.' },
            { type: 'tripler', label: 'Pont Megtripl√°z√≥', description: 'A b√≥nuszj√°t√©kb√≥l sz√°rmaz√≥ teljes nyerem√©nyed megh√°romszoroz√≥dik!', cssClass: 'joker' },
            { type: 'double_or_nothing', label: 'Dupla vagy Semmi', description: 'Kock√°ztass! Vagy megdupl√°zod a nyerem√©nyt, vagy mindent elvesz√≠tesz.', cssClass: 'joker' },
            { type: 'pawn_shop', label: 'Z√°logh√°z', description: 'Eladhatsz egy biztos√≠t√°st 3000 pont√©rt cser√©be.', cssClass: 'special-prize' },
            { type: 'weekly_joker', label: 'Heti Joker', description: 'A h√©t v√©g√©ig minden sz√∂veges seg√≠ts√©g 50% pontkedvezm√©nnyel el√©rhet≈ë.', cssClass: 'joker' },
            { type: 'code_breaker', label: 'K√≥dfejt≈ë', description: 'Felfed√ºnk egy sz√°mjegyet a Szerencseker√©k mai titkos k√≥dj√°b√≥l.', cssClass: 'special-prize' },
            { type: 'theme_changer', label: 'T√©ma V√°lt√≥', description: 'A j√°t√©k v√©letlenszer≈±en √°tv√°lt egy m√°sik sz√≠nt√©m√°ra.' },
            { type: 'bad_joke', label: 'Rossz Tr√©fa', description: 'Levonunk 1000 pontot a nyerem√©nyedb≈ël. A nyomoz√°s n√©ha vesztes√©ges.', cssClass: 'cursed' },
            { type: 'cursed_card', label: '√Åtkozott K√°rtya', description: 'Elvesz√≠tesz egy biztos√≠t√°st. √ìvatosan a bizony√≠t√©kokkal!', cssClass: 'cursed' }
        ];

                function populateThemePicker() { 
            themes.forEach(theme => { 
                const swatch = document.createElement('div'); 
                swatch.className = 'theme-swatch'; 
                swatch.title = theme.name; 
                swatch.style.backgroundColor = theme.color; 
                swatch.dataset.theme = theme.className; 
                themePicker.appendChild(swatch); 
            }); 
        }

        function applyTheme(themeClassName, isRandom = false) { 
            const newTheme = themes.find(t => t.className === themeClassName);
            if (!newTheme) return;
            body.className = ''; 
            body.classList.add(newTheme.className); 
            document.querySelectorAll('.theme-swatch').forEach(s => s.classList.remove('active')); 
            const activeSwatch = document.querySelector(`.theme-swatch[data-theme="${newTheme.className}"]`); 
            if(activeSwatch) activeSwatch.classList.add('active'); 
            if(!isRandom) saveTheme(newTheme.className);
        }

        function saveTheme(themeClassName) { 
            localStorage.setItem('szonyomozo_theme', themeClassName); 
        }

        function loadTheme() { 
            const savedTheme = localStorage.getItem('szonyomozo_theme') || 'theme-classic'; 
            applyTheme(savedTheme); 
        }

        themeToggleButton.addEventListener('click', (e) => { 
            e.stopPropagation(); 
            themePicker.style.display = themePicker.style.display === 'flex' ? 'none' : 'flex'; 
        });

        themePicker.addEventListener('click', (e) => { 
            if (e.target.classList.contains('theme-swatch')) { 
                const themeClassName = e.target.dataset.theme; 
                applyTheme(themeClassName); 
            } 
        });

        document.addEventListener('click', (e) => { 
            if (!themePicker.contains(e.target) && !themeToggleButton.contains(e.target)) { 
                themePicker.style.display = 'none'; 
            } 
        });

        function loadKeyboardSetting() { 
            const useDevice = localStorage.getItem('szonyomozo_use_device_keyboard') === 'true'; 
            keyboardToggleCheckbox.checked = useDevice; 
            setKeyboardVisibility(useDevice); 
        }

        function setKeyboardVisibility(useDevice) { 
            keyboardContainer.style.display = useDevice ? 'none' : 'flex'; 
            if (useDevice) { 
                setTimeout(() => hiddenInput.focus(), 100); 
            } else { 
                hiddenInput.blur(); 
            } 
        }

        keyboardToggleCheckbox.addEventListener('change', (e) => { 
            const useDevice = e.target.checked; 
            localStorage.setItem('szonyomozo_use_device_keyboard', useDevice); 
            setKeyboardVisibility(useDevice); 
        });
        
        function getWeeklyStats() { 
            try {
                const stats = JSON.parse(localStorage.getItem('szonyomozo_weekly_stats'));
                return stats || null;
            } catch (e) {
                return null;
            }
        }

        function saveWeeklyStats(stats) { 
            localStorage.setItem('szonyomozo_weekly_stats', JSON.stringify(stats)); 
        }

        function getInsuranceCount() { 
            const stats = getWeeklyStats(); 
            return stats ? stats.insurance || 0 : 0; 
        }

        function updateInsuranceCount(change) { 
            let stats = getWeeklyStats(); 
            if (!stats) return;
            stats.insurance = Math.max(0, (stats.insurance || 0) + change); 
            saveWeeklyStats(stats); 
            updateUIDisplays(); 
        }
        
        function updateUIDisplays() {
            const stats = getWeeklyStats();
            if(!stats) return;
            
            insuranceDisplayCount.textContent = stats.insurance || 0;
            
            const validPrizes = (stats.warehouse || []).filter(p => p.expiry > Date.now());
            if (stats.warehouse.length !== validPrizes.length) {
                stats.warehouse = validPrizes;
                saveWeeklyStats(stats);
            }
            warehouseDisplayCount.textContent = validPrizes.length;
        }

                function showWheelMessage(category, options = {}) { 
            clearTimeout(wheelMessageTimeout); 
            const messages = WHEEL_MESSAGES[category] || ["Hiba: Ismeretlen √ºzenet kateg√≥ria."]; 
            let message = messages[Math.floor(Math.random() * messages.length)]; 
            for (const key in options) { 
                message = message.replace(`{${key}}`, `<strong>${options[key]}</strong>`); 
            } 
            wheelMessageDisplay.innerHTML = message; 
            wheelMessageDisplay.style.opacity = 1; 
            wheelMessageTimeout = setTimeout(() => { 
                wheelMessageDisplay.style.opacity = 0; 
            }, options.duration || 4000); 
        }

        function drawWheel(round) {
            wheel.innerHTML = '';
            const segments = wheelSegmentSets[round];
            if(!segments) return;
            const numSegments = segments.length;
            const angleStep = 360 / numSegments;
            const radius = 50;
            for (let i = 0; i < numSegments; i++) {
                const segment = segments[i];
                const startAngle = i * angleStep;
                const endAngle = (i + 1) * angleStep;
                const start = polarToCartesian(radius, radius, radius, endAngle);
                const end = polarToCartesian(radius, radius, radius, startAngle);
                const largeArcFlag = endAngle - startAngle <= 180 ? "0" : "1";
                const d = `M ${start.x} ${start.y} A ${radius} ${radius} 0 ${largeArcFlag} 0 ${end.x} ${end.y} L ${radius} ${radius} Z`;
                const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
                path.setAttribute("d", d);
                path.setAttribute("fill", segment.color);
                wheel.appendChild(path);
                const textAngle = startAngle + angleStep / 2;
                const textPos = polarToCartesian(radius, radius, radius * 0.65, textAngle);
                const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
                text.setAttribute("x", textPos.x);
                text.setAttribute("y", textPos.y);
                text.setAttribute("text-anchor", "middle");
                text.setAttribute("dominant-baseline", "middle");
                text.setAttribute("font-weight", "bold");
                text.setAttribute("fill", "white");
                text.setAttribute("transform", `rotate(${textAngle + 90} ${textPos.x} ${textPos.y})`);
                if (segment.label.length > 8) {
                    text.setAttribute("font-size", "4");
                } else {
                    text.setAttribute("font-size", "5.5");
                }
                text.textContent = segment.label;
                wheel.appendChild(text);
            }
        }

        function polarToCartesian(cx, cy, r, angle) { 
            const rad = (angle - 90) * Math.PI / 180.0; 
            return { x: cx + (r * Math.cos(rad)), y: cy + (r * Math.sin(rad)) }; 
        }
        
        function initWheelGame() {
            let stake = 0;
            let stats = getWeeklyStats();
            const hasUnlimitedWheel = stats.activeWeeklyPrize?.unlimitedWheel || stats.activeLottoPrize?.freeWheel;

            if (!hasUnlimitedWheel) {
                 const currentScore = getWeeklyScore();
                while (true) {
                    const stakeInput = prompt(`Mennyi pontot szeretn√©l kock√°ztatni a Szerencseker√©ken? (Jelenlegi heti pontsz√°m: ${currentScore})`, "100");
                    if (stakeInput === null) {
                        return; 
                    }
                    stake = parseInt(stakeInput);
                    if (!isNaN(stake) && stake > 0 && stake <= currentScore) { 
                        addPointsToWeeklyScore(-stake, true);
                        break;
                    }
                    alert("√ârv√©nytelen t√©t! K√©rlek, a pontjaidn√°l nem nagyobb, pozit√≠v sz√°mot adj meg.");
                }
            } else {
                alert("Egy akt√≠v nyerem√©nyednek k√∂sz√∂nhet≈ëen a Szerencseker√©k most ingyenes!");
            }
            
            gameData.bonusUnlocked = false; 
            saveGame();
            updateBonusUnlockUI(); 
             
            wheelState = { totalWinnings: 0, initialStake: stake, currentRound: 0 };
            startNewRound();
            wheelGameOverlay.classList.add('visible');
            checkAndDisplayIdleState();
        }
        
        function startNewRound() { 
            wheelState.currentRound++; 
            wheelState.roundScore = 0; 
            wheelState.guessedLetters = []; 
            wheelState.isSpinning = false;
            wheelState.isPoweringUp = false;
            wheelState.spinResult = null;
            wheelState.roundBankrupt = false;
            wheelState.vowelsBoughtThisRound = 0; 
            wheelRoundDisplay.textContent = `${wheelState.currentRound}. K√ñR`; 
            const seed = getCurrentHourSeed() + wheelState.currentRound; 
            const puzzleIndex = Math.floor(seededRandom(seed) * wheelPuzzles.length); 
            wheelState.puzzle = wheelPuzzles[puzzleIndex]; 
            drawWheel(wheelState.currentRound); 
            setupPuzzleBoard(); 
            createAlphabetPanel(); 
            updateWheelPlayerScore();
            updateUIForGameState('start_round'); 
            showWheelMessage('start_round'); 
        }

        function createAlphabetPanel() { 
            wheelAlphabetPanel.innerHTML = ''; 
            FULL_ALPHABET.split('').forEach(letter => { 
                const key = document.createElement('button'); 
                key.className = 'alphabet-key'; 
                key.textContent = letter; 
                key.dataset.letter = letter; 
                if (VOWELS.includes(letter)) { 
                    key.classList.add('vowel'); 
                } 
                key.addEventListener('click', () => handleAlphabetClick(letter)); 
                wheelAlphabetPanel.appendChild(key); 
            }); 
        }
        
        function setupPuzzleBoard() { 
            puzzleBoardEl.innerHTML = ''; 
            puzzleCategoryEl.textContent = wheelState.puzzle.category; 
            const puzzleText = wheelState.puzzle.puzzle.toUpperCase(); 
            for(const char of puzzleText) { 
                const tile = document.createElement('div'); 
                if (char === ' ') { 
                    tile.className = 'puzzle-tile space'; 
                } else { 
                    tile.className = 'puzzle-tile'; 
                    tile.innerHTML = `<div class="tile-inner"><div class="tile-face tile-front"></div><div class="tile-face tile-back">${char}</div></div>`; 
                    tile.dataset.letter = char.toUpperCase(); 
                } 
                puzzleBoardEl.appendChild(tile); 
            } 
        }

                function handleAlphabetClick(letter) {
            if (wheelState.isSpinning || wheelState.guessedLetters.includes(letter)) return;
            const isVowel = VOWELS.includes(letter);
        
            if (wheelState.gameState === 'choosing_vowel' && isVowel) {
                const cost = wheelState.vowelsBoughtThisRound < 2 ? 250 : 1000;
                const effectiveWinnings = wheelState.totalWinnings + wheelState.roundScore;
                if (effectiveWinnings < cost) {
                    showWheelMessage('not_enough_points', { cost });
                    return;
                }
                if (confirm(`Biztosan veszel egy mag√°nhangz√≥t ${cost} pont√©rt?`)) {
                    if (wheelState.roundScore >= cost) {
                        wheelState.roundScore -= cost;
                    } else {
                        const remainingCost = cost - wheelState.roundScore;
                        wheelState.roundScore = 0;
                        wheelState.totalWinnings -= remainingCost;
                    }
                    wheelState.vowelsBoughtThisRound++;
                    guessLetter(letter);
                }
            } else if (wheelState.gameState === 'guess_consonant' && !isVowel) {
                guessLetter(letter);
            }
        }
        
        function buyVowel() {
            if (wheelState.gameState !== 'start_round') {
                if(wheelState.gameState === 'guess_consonant') showWheelMessage('must_guess_consonant');
                return;
            };
            showWheelMessage('buy_vowel_prompt');
            updateUIForGameState('choosing_vowel');
        }

        function updateAlphabetPanel() { 
            wheelAlphabetPanel.querySelectorAll('.alphabet-key').forEach(key => {
                if (wheelState.guessedLetters.includes(key.dataset.letter)) {
                    key.disabled = true;
                }
            });
        }
        
        function togglePowerMeterAndSpin() { 
            if (wheelState.gameState !== 'start_round') {
                 if(wheelState.gameState === 'choosing_vowel') showWheelMessage('buy_vowel_prompt');
                 return;
            };
            if (wheelState.isSpinning) return;
            const remainingConsonants = [...new Set(wheelState.puzzle.puzzle.toUpperCase().split(''))].filter(l => !VOWELS.includes(l) && l !== ' ' && !wheelState.guessedLetters.includes(l)); 
            if (remainingConsonants.length === 0) { 
                showWheelMessage('no_more_consonants'); 
                return; 
            } 
            if (!wheelState.isPoweringUp) { 
                showWheelMessage('power_up_prompt'); 
                wheelState.isPoweringUp = true; 
                powerMeterBar.classList.add('power-up'); 
            } else { 
                wheelState.isPoweringUp = false; 
                const power = powerMeterBar.offsetWidth / powerMeterContainer.offsetWidth; 
                powerMeterBar.classList.remove('power-up'); 
                spinWheel(power); 
            } 
        }

        function spinWheel(power) {
            updateUIForGameState('spinning');
            showWheelMessage('spin_prompt');
            const baseRotations = 2; 
            const randomExtra = Math.random(); 
            const powerRotation = (4 * power + 4 * (power * power)); 
            const totalRotation = (baseRotations + randomExtra + powerRotation) * 360;
            const currentRotation = parseFloat(wheel.dataset.rotation || 0);
            const newRotation = currentRotation + totalRotation;
            wheel.style.transform = `rotate(${newRotation}deg)`;
            wheel.dataset.rotation = newRotation;
            setTimeout(() => {
                const finalAngle = newRotation % 360;
                const segments = wheelSegmentSets[wheelState.currentRound];
                const segmentAngle = 360 / segments.length;
                const segmentIndex = Math.floor((360 - finalAngle % 360) / segmentAngle) % segments.length;
                handleSpinResult(segments[segmentIndex].value);
            }, 4000);
        }

        function handleSpinResult(result) {
            wheelState.isSpinning = false;
            let stats = getWeeklyStats();

            if (result === 'bankrupt') {
                 if(stats.activeLottoPrize?.noBankrupt || stats.activeWeeklyPrize?.noBankrupt) {
                    showWheelMessage('bankrupt_immune');
                    updateUIForGameState('start_round');
                    return;
                }
                
                const useUnlimitedInsurance = stats.activeLottoPrize?.unlimitedInsurance || stats.activeWeeklyPrize?.unlimitedInsurance;
                const insuranceCount = getInsuranceCount();
                if (useUnlimitedInsurance || insuranceCount > 0) {
                    if (!useUnlimitedInsurance) {
                        updateInsuranceCount(-1);
                    }
                    showWheelMessage('insurance_used');
                    updateUIForGameState('start_round'); 
                    return;
                }

                if (!wheelState.roundBankrupt) {
                    showWheelMessage('bankrupt_round_lost');
                    wheelState.roundScore = 0; 
                    wheelState.roundBankrupt = true;
                    updateWheelPlayerScore();
                    updateUIForGameState('start_round');
                } else {
                    showWheelMessage('bankrupt_stake_lost', { duration: 5000 });
                    loseGame(); 
                }
            } else if (result === 'insurance') {
                if (gameData.insurancesGainedThisHour < 6) {
                    updateInsuranceCount(1);
                    gameData.insurancesGainedThisHour++;
                    saveGame();
                    showWheelMessage('insurance_win');
                } else {
                    showWheelMessage('insurance_limit_reached');
                }
                updateUIForGameState('start_round');
            } else if (result === 'double') {
                wheelState.roundScore *= 2; 
                showWheelMessage('double');
                updateWheelPlayerScore();
                updateUIForGameState('start_round');
            } else if (result === 'tripler') {
                wheelState.roundScore *= 3;
                showWheelMessage('tripler');
                updateWheelPlayerScore();
                updateUIForGameState('start_round');
            } else if (result === 'halver') {
                wheelState.roundScore = Math.floor(wheelState.roundScore / 2);
                showWheelMessage('halver');
                updateWheelPlayerScore();
                updateUIForGameState('start_round');
            } else if (result === 'spin_again') {
                showWheelMessage('spin_again');
                updateUIForGameState('start_round');
            } else if (result === 'reveal_letter') {
                showWheelMessage('reveal_letter');
                const unrevealedLetters = [...new Set(wheelState.puzzle.puzzle.toUpperCase().split(''))].filter(l => l !== ' ' && !wheelState.guessedLetters.includes(l));
                if (unrevealedLetters.length > 0) {
                    const randomLetter = unrevealedLetters[Math.floor(Math.random() * unrevealedLetters.length)];
                    setTimeout(() => guessLetter(randomLetter, true), 1500); 
                }
                updateUIForGameState('start_round');
            } else if (result === 'mystery') {
                const mysteryValue = (Math.random() < 0.5 ? 1 : -1) * 2000;
                wheelState.roundScore += mysteryValue;
                showWheelMessage('mystery', { value: (mysteryValue > 0 ? '+' : '') + mysteryValue });
                updateWheelPlayerScore();
                updateUIForGameState('start_round');
            } else if (result === 'jackpot') {
                showWheelMessage('jackpot');
                wheelState.roundScore += 20000;
                updateWheelPlayerScore();
                updateUIForGameState('start_round');
            } else if (result === 'card_draw') {
                 showWheelMessage('card_draw');
                 setTimeout(() => {
                    initCardGame(true);
                 }, 1500);
                 updateUIForGameState('start_round');
            } else if (result === 're_spin') {
                showWheelMessage('re_spin');
                wheelState.reSpinAvailable = true;
                updateUIForGameState('start_round'); 
            } else if (result === 'free_hint') {
                showWheelMessage('free_hint');
                stats.freeHints = (stats.freeHints || 0) + 1;
                saveWeeklyStats(stats);
                updateUIForGameState('start_round');
            } else if (result === 'surprise') {
                const outcomes = ['good', 'bad', 'vowel'];
                const outcome = outcomes[Math.floor(Math.random() * outcomes.length)];
                if (outcome === 'good') {
                    showWheelMessage('surprise_good');
                    wheelState.roundScore += 1000;
                } else if (outcome === 'bad') {
                    showWheelMessage('surprise_bad');
                    wheelState.roundScore = Math.max(0, wheelState.roundScore - 500);
                } else {
                    showWheelMessage('surprise_vowel');
                    const unrevealedVowels = VOWELS.split('').filter(v => !wheelState.guessedLetters.includes(v) && wheelState.puzzle.puzzle.includes(v));
                    if(unrevealedVowels.length > 0) {
                        const randomVowel = unrevealedVowels[Math.floor(Math.random() * unrevealedVowels.length)];
                        setTimeout(() => guessLetter(randomVowel, true), 1500);
                    }
                }
                updateWheelPlayerScore();
                updateUIForGameState('start_round');
            } else if (result === 'joker_wheel') {
                showWheelMessage('joker_wheel');
                const unrevealedConsonants = [...new Set(wheelState.puzzle.puzzle.toUpperCase().split(''))].filter(l => !VOWELS.includes(l) && l !== ' ' && !wheelState.guessedLetters.includes(l));
                if (unrevealedConsonants.length > 0) {
                    const randomConsonant = unrevealedConsonants[Math.floor(Math.random() * unrevealedConsonants.length)];
                    setTimeout(() => guessLetter(randomConsonant, true), 1500); 
                }
                updateUIForGameState('start_round');
            } else {
                wheelState.spinResult = result;
                updateUIForGameState('guess_consonant');
                showWheelMessage('spin_result', { value: result });
            }
        }

                function guessLetter(letter, free = false) { 
            letter = letter.toUpperCase(); 
            if (wheelState.guessedLetters.includes(letter)) return;
            wheelState.guessedLetters.push(letter); 
            let foundCount = 0; 
            document.querySelectorAll(`.puzzle-tile[data-letter="${letter}"]`).forEach(tile => { 
                if(!tile.classList.contains('revealed')) {
                    tile.classList.add('revealed'); 
                    foundCount++;
                } 
            }); 
            if (foundCount > 0) { 
                if (!VOWELS.includes(letter) && !free) { 
                    let pointsEarned = foundCount * wheelState.spinResult; 
                    wheelState.roundScore += pointsEarned; 
                } 
                showWheelMessage('correct_guess'); 
            } else { 
                showWheelMessage('wrong_guess'); 
            } 
            wheelState.spinResult = null;
            updateWheelPlayerScore(); 
            updateAlphabetPanel(); 
            updateUIForGameState('start_round'); 
            checkWheelWin(); 
        }
        
        function solve() { 
            const solution = prompt("K√©rlek, add meg a teljes megfejt√©st:"); 
            if (solution === null) return; 
            if (solution.toUpperCase().trim().replace(/\s+/g, ' ') === wheelState.puzzle.puzzle.toUpperCase()) { 
                showWheelMessage('solve_success'); 
                document.querySelectorAll('.puzzle-tile[data-letter]').forEach(tile => tile.classList.add('revealed')); 
                handleRoundWin();
            } else { 
                loseGame(true);
            } 
        }

        function loseGame(fromSolveAttempt = false) {
            if(fromSolveAttempt){
                showWheelMessage('solve_fail', {duration: 8000, solution: wheelState.puzzle.puzzle});
            }
            wheelState.totalWinnings = 0;
            wheelState.initialStake = 0;
            updateWheelPlayerScore();
            updateUIForGameState('game_over');
        }

        function handleRoundWin() {
            wheelState.totalWinnings += wheelState.roundScore;
            wheelState.roundScore = 0;
            updateUIForGameState('puzzle_solved');
        }
        
        function cashOut() { 
            showWheelMessage('cash_out', {duration: 5000}); 
            const finalWinnings = wheelState.totalWinnings + wheelState.roundScore + wheelState.initialStake;
            addPointsToWeeklyScore(finalWinnings); 
            updateUIForGameState('game_over'); 
        }

        function updateWheelPlayerScore() { 
            const totalScore = wheelState.totalWinnings + wheelState.roundScore;
            document.querySelector('#wheel-winnings-display span').textContent = totalScore.toLocaleString('hu-HU');
            playerScoreEl.textContent = wheelState.roundScore.toLocaleString('hu-HU'); 
            stakeAmountEl.textContent = wheelState.initialStake.toLocaleString('hu-HU'); 
        }

        function updateUIForGameState(state) {
            wheelState.gameState = state;
            const controls = document.getElementById('wheel-controls');
            controls.style.display = 'none';
            wheelDecisionControls.style.display = 'none';
            closeWheelButton.style.display = 'none';
            powerMeterContainer.style.pointerEvents = 'none';
            wheelAlphabetPanel.querySelectorAll('.alphabet-key').forEach(k => k.disabled = true);
        
            switch (state) {
                case 'start_round':
                    controls.style.display = 'flex';
                    spinButton.disabled = false;
                    solveButton.disabled = false;
                    buyVowelButton.disabled = false;
                    powerMeterContainer.style.pointerEvents = 'auto';
                    wheelState.spinResult = null;
                    break;
                case 'choosing_vowel':
                    controls.style.display = 'flex';
                    spinButton.disabled = true;
                    solveButton.disabled = false;
                    buyVowelButton.disabled = true;
                    wheelAlphabetPanel.querySelectorAll('.alphabet-key.vowel').forEach(k => {
                        if (!wheelState.guessedLetters.includes(k.dataset.letter)) {
                           k.disabled = false;
                        }
                    });
                    break;
                case 'spinning':
                    controls.style.display = 'flex';
                    spinButton.disabled = true;
                    solveButton.disabled = true;
                    buyVowelButton.disabled = true;
                    wheelState.isSpinning = true;
                    break;
                case 'guess_consonant':
                    controls.style.display = 'flex';
                    spinButton.disabled = true;
                    solveButton.disabled = false;
                    buyVowelButton.disabled = true;
                    wheelAlphabetPanel.querySelectorAll('.alphabet-key:not(.vowel)').forEach(k => {
                         if (!wheelState.guessedLetters.includes(k.dataset.letter)) {
                           k.disabled = false;
                        }
                    });
                    showWheelMessage('guess_consonant', {duration: 6000});
                    break;
                case 'puzzle_solved':
                    if (wheelState.currentRound < 3) {
                        wheelDecisionControls.style.display = 'flex';
                    } else {
                        setTimeout(() => {
                           wheelGameOverlay.classList.remove('visible');
                           initCardGame();
                        }, 2000);
                    }
                    break;
                case 'game_over':
                    closeWheelButton.style.display = 'block';
                    break;
            }
        }
        function checkWheelWin() { 
            const allTiles = document.querySelectorAll('.puzzle-tile[data-letter]'); 
            const revealedTiles = document.querySelectorAll('.puzzle-tile.revealed[data-letter]'); 
            if(allTiles.length > 0 && allTiles.length === revealedTiles.length) { 
                handleRoundWin(); 
            } 
        }

                function shuffleArraySeeded(array, seed) { 
            let currentIndex = array.length, temporaryValue, randomIndex; 
            const newArray = [...array]; 
            while (0 !== currentIndex) { 
                randomIndex = Math.floor(seededRandom(seed + currentIndex) * currentIndex); 
                currentIndex -= 1; 
                temporaryValue = newArray[currentIndex]; 
                newArray[currentIndex] = newArray[randomIndex]; 
                newArray[randomIndex] = temporaryValue; 
            } 
            return newArray; 
        }
        
        function initCardGame(isFromWheel = false) { 
            cardGameMessage.textContent = "V√°lassz egy lapot!"; 
            cardBoard.innerHTML = ''; 
            collectWinningsButton.style.display = 'none'; 
            cardGameOverlay.classList.add('visible'); 
            
            if (isFromWheel) {
                document.querySelector('#card-game-container h2').textContent = "B√≥nusz K√°rtyah√∫z√°s";
                document.querySelector('#card-game-container > p').textContent = "A ker√©ken nyert√©l egy b√≥nusz k√°rty√°t! V√°lassz egyet!";
                wheelState.picksLeft = 1;
            } else {
                document.querySelector('#card-game-container h2').textContent = "B√≥nusz J√°t√©k: 20 K√°rtya";
                document.querySelector('#card-game-container > p').textContent = "Gratul√°lunk a 3. k√∂rh√∂z! V√°lassz egy k√°rty√°t a v√©gs≈ë nyerem√©ny√©rt!";
                wheelState.picksLeft = 1; 
            }

            const seed = getCurrentHourSeed(); 
            const shuffledCards = shuffleArraySeeded(CARD_DATA, seed); 
            cardPrizesList.innerHTML = ''; 
            shuffledCards.forEach(card => { 
                cardPrizesList.innerHTML += `<li>${card.label}</li>`; 
            }); 
            shuffledCards.forEach((cardData, index) => { 
                const cardElement = document.createElement('div'); 
                cardElement.className = 'game-card'; 
                cardElement.dataset.index = index; 
                cardElement.innerHTML = ` <div class="card-inner"> <div class="card-face card-face-front"> <svg class="card-logo-svg" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"> <circle class="logo-circle" cx="50" cy="50" r="40" stroke-width="12"/> <line class="logo-handle" x1="32" y1="72" x2="5" y2="95" stroke-width="16" stroke-linecap="round"/> <text class="logo-text" x="50" y="62" font-family="Fredoka One, cursive" font-size="38" text-anchor="middle">Sz√≥</text> </svg> </div> <div class="card-face card-face-back ${cardData.cssClass || ''}"> <div class="card-title">${cardData.label}</div> <div class="card-desc">${cardData.description}</div> </div> </div> `; 
                cardElement.addEventListener('click', () => handleCardClick(cardElement, cardData, isFromWheel)); 
                cardBoard.appendChild(cardElement); 
            }); 
        }
        
        function handleCardClick(cardElement, cardData, isFromWheel) {
            if (cardElement.classList.contains('flipped') || wheelState.picksLeft <= 0) return;
            wheelState.picksLeft--;
            cardElement.classList.add('flipped');
            applyCardEffect(cardData);
            
            const closeLogic = () => {
                document.querySelectorAll('.game-card').forEach(c => c.classList.add('disabled'));
                setTimeout(() => {
                    document.querySelectorAll('.game-card:not(.flipped)').forEach((card, index) => {
                        setTimeout(() => card.classList.add('flipped'), index * 100);
                    });
                    if (isFromWheel) {
                        setTimeout(() => { cardGameOverlay.classList.remove('visible'); }, 3000);
                    } else {
                        collectWinningsButton.style.display = 'block';
                    }
                }, 1500);
            };

            if (cardData.type === 'double_or_nothing') {
                setTimeout(() => {
                    if (confirm("Dupla vagy Semmi! Biztosan kock√°ztatsz? Ha nem, a jelenlegi nyerem√©nyed megmarad.")) {
                        if (Math.random() < 0.5) {
                            cardGameMessage.textContent = "Dupla! A nyerem√©nyed megdupl√°z√≥dott!";
                            wheelState.totalWinnings = (wheelState.totalWinnings + wheelState.roundScore) * 2;
                        } else {
                            cardGameMessage.textContent = "Semmi... Elvesztetted a b√≥nusz nyerem√©nyed.";
                            wheelState.totalWinnings = 0;
                            wheelState.initialStake = 0; 
                        }
                        wheelState.roundScore = 0;
                        updateWheelPlayerScore();
                    }
                    closeLogic();
                }, 1000);
            } else {
                 if (wheelState.picksLeft <= 0) {
                    closeLogic();
                 }
            }
        }

        function applyCardEffect(cardData) { 
            cardGameMessage.textContent = `A te k√°rty√°d: ${cardData.label}!`; 
            let stats = getWeeklyStats(); 
            let finalWinnings = wheelState.totalWinnings + wheelState.roundScore;
            
            switch(cardData.type) { 
                case 'total_bankrupt': 
                    stats.totalScore = 0; 
                    finalWinnings = 0; 
                    wheelState.initialStake = 0;
                    break; 
                case 'half': 
                    finalWinnings = Math.floor(finalWinnings / 2); 
                    break; 
                case 'add_points':
                case 'boss_gift':
                    finalWinnings += cardData.value; 
                    break; 
                case 'point_rain':
                    const rainAmount = Math.floor(seededRandom(Date.now()) * 4001) + 1000;
                    finalWinnings += rainAmount;
                    cardGameMessage.textContent += ` (+${rainAmount} pont)`;
                    break;
                case 'add_insurance':
                    updateInsuranceCount(1);
                    break;
                case 'free_hint':
                    stats.freeHints = (stats.freeHints || 0) + 1;
                    break;
                case 'free_vowel':
                    stats.freeVowels = (stats.freeVowels || 0) + 1;
                    break;
                case 'amnesty':
                    const failedWordIndex = gameData.progress.findIndex(p => p.status === 'failed' && (Date.now() - (p.failTimestamp || 0)) > 0);
                    if (failedWordIndex !== -1) {
                         gameData.progress[failedWordIndex].failTimestamp = 0;
                         cardGameMessage.textContent = "Amnesztia! Egy rontott szavad v√°rakoz√°si ideje t√∂r√∂lve!";
                         renderWordTracker();
                    } else {
                         cardGameMessage.textContent = "Amnesztia! Jelenleg nincs rontott szavad, amit t√∂r√∂lhetne.";
                    }
                    break;
                case 'time_bonus':
                    gameData.timers = gameData.timers.map(t => t + 60);
                    cardGameMessage.textContent = "Id≈ëb√≥nusz! +60 m√°sodperc minden id≈ëfutam feladv√°nyhoz!";
                    break;
                case 'pick_again': 
                    wheelState.picksLeft++; 
                    cardGameMessage.textContent += " V√°lassz m√©g egyet!"; 
                    break; 
                case 'tripler':
                    finalWinnings *= 3;
                    break;
                case 'pawn_shop':
                    if (getInsuranceCount() > 0) {
                        if (confirm("Eladsz 1 biztos√≠t√°st 3000 pont√©rt?")) {
                            updateInsuranceCount(-1);
                            finalWinnings += 3000;
                            cardGameMessage.textContent = "√úzlet megk√∂tve! +3000 pont.";
                        }
                    } else {
                        cardGameMessage.textContent = "Nincs eladhat√≥ biztos√≠t√°sod.";
                    }
                    break;
                case 'weekly_joker':
                    stats.weeklyJokerActive = true;
                    cardGameMessage.textContent = "Heti Joker! A h√©t v√©g√©ig f√©l√°ron a seg√≠ts√©g!";
                    break;
                case 'code_breaker':
                    const digitIndex = Math.floor(Math.random() * 4);
                    const digit = gameData.secretCode[digitIndex];
                    cardGameMessage.textContent = `K√≥dfejt≈ë! A ${digitIndex+1}. sz√°mjegy: ${digit}`;
                    break;
                case 'theme_changer':
                    const currentTheme = body.className;
                    let newTheme;
                    do {
                        newTheme = themes[Math.floor(Math.random() * themes.length)].className;
                    } while (newTheme === currentTheme);
                    applyTheme(newTheme, true);
                    cardGameMessage.textContent = "T√©ma V√°lt√≥! √öj k√ºls≈ët kapt√°l!";
                    break;
                case 'bad_joke':
                    finalWinnings = Math.max(0, finalWinnings - 1000);
                    break;
                case 'cursed_card':
                    if (getInsuranceCount() > 0) {
                        updateInsuranceCount(-1);
                    } else {
                        cardGameMessage.textContent += " Szerencs√©re nem volt mit elvenni.";
                    }
                    break;
                case 'witty_message':
                case 'double_or_nothing':
                    break;
            }
            saveWeeklyStats(stats);
            updateWeeklyScoreDisplay(stats.totalScore); 
            wheelState.totalWinnings = finalWinnings;
            wheelState.roundScore = 0;
            updateWheelPlayerScore(); 
        }

                function initLotto() {
            updateLottoButtonsState();
            displayWinningNumbers();
        }

        function generateWinningLottoNumbers() { 
            if (!gameData.lotto) return;
            const numbers = Array.from({length: 35}, (_, i) => i + 1); 
            let winning = []; 
            for(let i=0; i<5; i++) { 
                const randomIndex = Math.floor(seededRandom(getCurrentDaySeed() + i) * numbers.length); 
                winning.push(numbers.splice(randomIndex, 1)[0]);
            } 
            gameData.lotto.winningNumbers = winning.sort((a,b)=>a-b); 
        }
        
        function generateWeeklyWinningNumbers() {
            if (!gameData.weeklyLotto) return;
            const numbers = Array.from({length: 35}, (_, i) => i + 1);
            let winning = [];
            for (let i = 0; i < 5; i++) {
                const randomIndex = Math.floor(seededRandom(getWeekSeed() + i) * numbers.length);
                winning.push(numbers.splice(randomIndex, 1)[0]);
            }
            gameData.weeklyLotto.winningNumbers = winning.sort((a, b) => a - b);
        }

        function openLottoOverlay(lottoType) {
            currentLottoType = lottoType;
            const isDaily = lottoType === 'daily';
            const lottoData = isDaily ? gameData.lotto : gameData.weeklyLotto;
            const prizeMeta = isDaily ? LOTTO_PRIZES_META : WEEKLY_LOTTO_PRIZES_META;
            const cost = isDaily ? (lottoData.tickets.length === 0 ? 0 : 400) : 100000;
            const currentScore = getWeeklyScore();
        
            const overlayHeader = document.getElementById('lotto-header-overlay');
            overlayHeader.innerHTML = document.getElementById(isDaily ? 'lotto-header' : 'weekly-lotto-header').innerHTML;
        
            lottoPrizesList.innerHTML = '';
            Object.values(prizeMeta).forEach(prize => {
                const li = document.createElement('li');
                li.innerHTML = `<strong>${prize.title}:</strong> ${prize.desc}`;
                lottoPrizesList.appendChild(li);
            });
        
            lottoOverlayMessage.innerHTML = '';
            lottoGameActiveArea.style.display = 'block';
            lottoOverlayButtons.style.display = 'flex';
        
            if (currentScore < cost) {
                lottoInsufficientPointsMessage.textContent = `Nincs el√©g pontod! Sz√ºks√©ges: ${cost.toLocaleString()} pont. Hi√°nyzik: ${(cost - currentScore).toLocaleString()} pont.`;
                lottoInsufficientPointsMessage.style.display = 'block';
                submitLottoButtonOverlay.disabled = true;
            } else {
                lottoInsufficientPointsMessage.style.display = 'none';
                submitLottoButtonOverlay.disabled = false;
            }
        
            lottoGameOverlay.classList.add('visible');
            selectedLottoNumbers = [];
            createOverlayLottoGrid();
            updateLottoSelectionCounter();
            closeLottoOverlayButton.textContent = "Bez√°r√°s";
        }

        function createOverlayLottoGrid() {
            lottoGridOverlay.innerHTML = ''; 
            for(let i=1; i<=35; i++){ 
                const numberEl = document.createElement('div'); 
                numberEl.className = 'lotto-number'; 
                numberEl.textContent = i; 
                numberEl.dataset.number = i; 
                numberEl.addEventListener('click', () => toggleLottoNumber(i)); 
                lottoGridOverlay.appendChild(numberEl); 
            }
        }
        
        function toggleLottoNumber(num) { 
            const index = selectedLottoNumbers.indexOf(num); 
            if (index > -1) { 
                selectedLottoNumbers.splice(index, 1); 
            } else { 
                if(selectedLottoNumbers.length < 5) { 
                    selectedLottoNumbers.push(num); 
                } else { 
                    lottoOverlayMessage.textContent = "M√°r kiv√°lasztott√°l 5 sz√°mot!";
                    setTimeout(() => lottoOverlayMessage.textContent = "", 2000);
                } 
            } 
            updateOverlayLottoGrid();
            updateLottoSelectionCounter();
        }

        function updateLottoSelectionCounter() {
            lottoSelectionCounter.textContent = `${selectedLottoNumbers.length} / 5 kiv√°lasztva`;
        }

        function updateOverlayLottoGrid() { 
            lottoGridOverlay.querySelectorAll('.lotto-number').forEach(el => { 
                const num = parseInt(el.dataset.number); 
                if (selectedLottoNumbers.includes(num)) { 
                    el.classList.add('selected'); 
                } else { 
                    el.classList.remove('selected'); 
                }
            });
        }

                function submitLottoTicketOverlay() {
            if (selectedLottoNumbers.length !== 5) {
                lottoOverlayMessage.textContent = "K√©rlek, v√°lassz ki pontosan 5 sz√°mot!";
                setTimeout(() => lottoOverlayMessage.textContent = "", 2000);
                return;
            }
            
            const isDaily = currentLottoType === 'daily';
            const lottoData = isDaily ? gameData.lotto : gameData.weeklyLotto;
            const cost = isDaily ? (lottoData.tickets.length === 0 ? 0 : 400) : 100000;
            
            addPointsToWeeklyScore(-cost, true);
            lottoData.tickets.push({
                numbers: selectedLottoNumbers.sort((a, b) => a - b)
            });
            saveGame();

            lottoGameActiveArea.style.display = 'none';
            lottoOverlayButtons.style.display = 'none';
            lottoInsufficientPointsMessage.style.display = 'none';
            lottoOverlayMessage.textContent = isDaily 
                ? 'Fogad√°sod r√∂gz√≠tett√ºk! V√°rd a sorsol√°st ma este 19 √≥r√°t√≥l!'
                : 'Fogad√°sod r√∂gz√≠tett√ºk! V√°rd a sorsol√°st vas√°rnap este 19 √≥r√°t√≥l.';
            
            closeLottoOverlayButton.textContent = "Rendben";

            setTimeout(() => {
                closeLottoOverlay();
            }, 3000);
        }

        function closeLottoOverlay() {
            lottoGameOverlay.classList.remove('visible');
            updateLottoButtonsState();
        }

        function getFormattedDate(date = new Date()) {
            const year = date.getFullYear();
            const monthNames = ["janu√°r", "febru√°r", "m√°rcius", "√°prilis", "m√°jus", "j√∫nius", "j√∫lius", "augusztus", "szeptember", "okt√≥ber", "november", "december"];
            const dayNames = ["vas√°rnap", "h√©tf≈ë", "kedd", "szerda", "cs√ºt√∂rt√∂k", "p√©ntek", "szombat"];
            const month = monthNames[date.getMonth()];
            const day = date.getDate();
            const dayName = dayNames[date.getDay()];
            return `${year}. ${month} ${day}., ${dayName}`;
        }
        
        function displayWinningNumbers() {
            const now = new Date();
            const yesterday = new Date();
            yesterday.setDate(now.getDate() - 1);

            const dailyLottoData = gameData.lotto;
            const showTodayNumbers = dailyLottoData && dailyLottoData.date === now.toDateString() && now.getHours() >= 19;
            const showYesterdayNumbers = dailyLottoData && dailyLottoData.date === yesterday.toDateString() && now.getHours() < 18;

            if (showTodayNumbers || showYesterdayNumbers) {
                const dateToShow = showTodayNumbers ? now : yesterday;
                winningLottoNumbersContainer.style.display = 'block';
                winningLottoNumbersContainer.innerHTML = `
                    <h4>A napi lott√≥ kisorsolt sz√°mai (${getFormattedDate(dateToShow)}):</h4>
                    <div class="number-display"></div>`;
                const display = winningLottoNumbersContainer.querySelector('.number-display');
                dailyLottoData.winningNumbers.forEach(num => {
                    const ball = document.createElement('div');
                    ball.className = 'lotto-ball';
                    ball.textContent = num;
                    display.appendChild(ball);
                });
            } else {
                winningLottoNumbersContainer.style.display = 'none';
            }

            const weeklyLottoData = gameData.weeklyLotto;
            const isSunday = now.getDay() === 0;
            const isMonday = now.getDay() === 1;
            const showWeeklyNumbers = weeklyLottoData && ((isSunday && now.getHours() >= 19) || (isMonday && now.getHours() < 18));
            
            if (showWeeklyNumbers) {
                const drawDate = new Date();
                drawDate.setDate(now.getDate() - (now.getDay() === 0 ? 0 : 1)); // Vas√°rnapra vagy a tegnapi vas√°rnapra mutat
                winningWeeklyLottoNumbersContainer.style.display = 'block';
                 winningWeeklyLottoNumbersContainer.innerHTML = `
                    <h4>A heti lott√≥ kisorsolt sz√°mai (${getFormattedDate(drawDate)}):</h4>
                    <div class="number-display"></div>`;
                const display = winningWeeklyLottoNumbersContainer.querySelector('.number-display');
                weeklyLottoData.winningNumbers.forEach(num => {
                    const ball = document.createElement('div');
                    ball.className = 'lotto-ball';
                    ball.textContent = num;
                    display.appendChild(ball);
                });
            } else {
                winningWeeklyLottoNumbersContainer.style.display = 'none';
            }
        }

        function updateLottoButtonsState() {
            const now = new Date();
            const hour = now.getHours();
            const day = now.getDay();

            if (hour >= 19) {
                lottoContainer.style.opacity = '0.5';
                lottoContainer.style.cursor = 'not-allowed';
            } else {
                lottoContainer.style.opacity = '1';
                lottoContainer.style.cursor = 'pointer';
            }

            if (day === 0 && hour >= 19) {
                weeklyLottoContainer.style.opacity = '0.5';
                weeklyLottoContainer.style.cursor = 'not-allowed';
            } else {
                weeklyLottoContainer.style.opacity = '1';
                weeklyLottoContainer.style.cursor = 'pointer';
            }
        }

        function evaluateLottoPrizes(lottoType) {
            const isDaily = lottoType === 'daily';
            const lottoData = isDaily ? gameData.lotto : gameData.weeklyLotto;

            if (!lottoData || lottoData.prizesEvaluated || lottoData.tickets.length === 0) return;
            let wonTiers = new Set();
            lottoData.tickets.forEach(ticket => {
                const matches = ticket.numbers.filter(num => lottoData.winningNumbers.includes(num));
                ticket.matches = matches.length;
                if (ticket.matches > 0) {
                    wonTiers.add(ticket.matches);
                }
            });
            lottoData.prizesEvaluated = true;
            saveGame();

            const uniqueTiers = Array.from(wonTiers);
            if (uniqueTiers.length > 1) {
                promptPrizeChoice(uniqueTiers, lottoType);
            } else if (uniqueTiers.length === 1) {
                addPrizeToWarehouse(uniqueTiers[0], lottoType);
                const prizeMeta = isDaily ? LOTTO_PRIZES_META : WEEKLY_LOTTO_PRIZES_META;
                const prizeName = prizeMeta[uniqueTiers[0]].title;
                alert(`Lott√≥ nyerem√©ny! A(z) "${prizeName}" nyerem√©nyed a Szerencse Rakt√°rba ker√ºlt.`);
            }
        }

        function promptPrizeChoice(tiers, lottoType) {
            const isDaily = lottoType === 'daily';
            const prizeMeta = isDaily ? LOTTO_PRIZES_META : WEEKLY_LOTTO_PRIZES_META;
            const optionsContainer = document.getElementById('prize-choice-options');
            optionsContainer.innerHTML = '';
            document.querySelector('#prize-choice-container p').textContent = `V√°lassz egyet a lott√≥n nyert jutalmak k√∂z√ºl. A nyerem√©nyed a Rakt√°rba ker√ºl.`;

            tiers.sort((a,b) => b-a).forEach(tier => {
                const prize = prizeMeta[tier];
                const button = document.createElement('button');
                button.className = 'overlay-button';
                button.style.marginBottom = '10px';
                button.innerHTML = `<div class="prize-title">${prize.title}</div><div class="prize-desc" style="font-weight:normal;font-size:0.8rem;margin-top:5px;">${prize.desc}</div>`;
                button.onclick = () => {
                    addPrizeToWarehouse(tier, lottoType);
                    prizeChoiceOverlay.classList.remove('visible');
                    alert(`A(z) "${prize.title}" nyerem√©nyt v√°lasztottad. A Rakt√°rba ker√ºlt.`);
                };
                optionsContainer.appendChild(button);
            });
            prizeChoiceOverlay.classList.add('visible');
        }

        function addPrizeToWarehouse(tier, lottoType) {
            let stats = getWeeklyStats();
            if (!stats.warehouse) {
                stats.warehouse = [];
            }
            const isDaily = lottoType === 'daily';
            const prizeMeta = isDaily ? LOTTO_PRIZES_META : WEEKLY_LOTTO_PRIZES_META;
            const prize = prizeMeta[tier];
            
            if (prize.prizeId === 'W5') {
                addPointsToWeeklyScore(5000000);
                alert("F≈êNYEREM√âNY! 5,000,000 pont hozz√°adva a heti pontsz√°modhoz!");
                return;
            }

            const newPrize = {
                id: prize.prizeId + '_' + Date.now(),
                prizeId: prize.prizeId,
                description: prize.desc,
                expiry: Date.now() + (isDaily ? 1 : 7) * 24 * 60 * 60 * 1000
            };

            stats.warehouse.push(newPrize);
            saveWeeklyStats(stats);
            updateUIDisplays();
        }
        
                function getWeekStartDate(date) {
            const d = new Date(date);
            const day = d.getDay();
            const diff = d.getDate() - day + (day === 0 ? -6 : 1);
            return new Date(d.setDate(diff)).toDateString();
        }

        function getWeekSeed(date = new Date()) {
            const d = new Date(getWeekStartDate(date));
            return d.getFullYear() * 1000 + d.getMonth() * 50 + Math.floor(d.getDate() / 7);
        }

        function checkResets() {
            const now = new Date();
            const today = now.toDateString();
            const currentWeekStart = getWeekStartDate(now);

            let stats = getWeeklyStats();
            
            if (!stats || stats.lastResetWeek !== currentWeekStart) {
                stats = { 
                    totalScore: 200, 
                    lastResetWeek: currentWeekStart, 
                    insurance: 0, 
                    freeHints: 0, 
                    freeVowels: 0,
                    weeklyJokerActive: false,
                    activeLottoPrize: null,
                    activeWeeklyPrize: null,
                    warehouse: [],
                    dailyBonusApplied: ''
                };
                gameData.weeklyLotto = { week: currentWeekStart, tickets: [], winningNumbers: [], prizesEvaluated: false };
                generateWeeklyWinningNumbers();
                saveGame();
            }

            const lottoday = gameData.lotto ? gameData.lotto.date : null;
            if (!lottoday || lottoday !== today) {
                gameData.lotto = { date: today, tickets: [], winningNumbers: [], prizesEvaluated: false };
                generateWinningLottoNumbers();
                if (stats) {
                    stats.dailyBonusApplied = '';
                    if (stats.activeLottoPrize && Date.now() > stats.activeLottoPrize.expiry) {
                        stats.activeLottoPrize = null;
                    }
                }
            }

            if(stats){
                 if (stats.activeWeeklyPrize && Date.now() > stats.activeWeeklyPrize.expiry) {
                    stats.activeWeeklyPrize = null;
                }

                if (stats.activeWeeklyPrize?.tier === 'W1' && stats.dailyBonusApplied !== today) {
                    stats.freeHints = (stats.freeHints || 0) + 1;
                    stats.dailyBonusApplied = today;
                }
                saveWeeklyStats(stats);
            }
            updateUIDisplays();
        }

        function getWeeklyScore() { 
            const stats = getWeeklyStats(); 
            return stats ? stats.totalScore : 0; 
        }

        function addPointsToWeeklyScore(points, bypassBonus = false) { 
            let stats = getWeeklyStats(); 
            if (!stats) return;
            if (!bypassBonus && stats.activeWeeklyPrize?.doublePoints) { 
                points *= 2; 
            } 
            stats.totalScore = Math.max(0, stats.totalScore + points); 
            saveWeeklyStats(stats); 
            updateWeeklyScoreDisplay(stats.totalScore); 
        }

        function updateWeeklyScoreDisplay(score) { 
            weeklyScoreDisplaySpan.textContent = Math.round(score).toLocaleString('hu-HU'); 
        }
        
        function initGame() {
            try {
                const storedData = JSON.parse(localStorage.getItem('szonyomozo_progress'));
                if (storedData && storedData.seed) { 
                    gameData = storedData; 
                } else {
                    gameData = {};
                }
            } catch (e) {
                console.error("Hiba a mentett adatok bet√∂lt√©sekor, a j√°t√©k vissza√°ll.", e);
                localStorage.removeItem('szonyomozo_progress');
                gameData = {};
            }
            
            checkResets();
            loadKeyboardSetting();
            const hourSeed = getCurrentHourSeed();
            
            if (!gameData.seed || gameData.seed !== hourSeed) {
                const oldLottoData = gameData.lotto;
                const oldWeeklyLottoData = gameData.weeklyLotto;
                gameData = {
                    seed: hourSeed,
                    hourlySet: [],
                    progress: [],
                    timers: {},
                    gameModes: {},
                    modeLocked: Array(5).fill(false),
                    secretCode: [],
                    insurancesGainedThisHour: 0,
                    bonusUnlocked: false,
                    currentWordIndex: 0,
                    currentRow: 0,
                    currentCol: 0,
                    isGameOver: false,
                    lotto: oldLottoData,
                    weeklyLotto: oldWeeklyLottoData
                };
                const allIndices = Array.from(Array(wordData.length).keys());
                let chosenIndices = [];
                for (let i = 0; i < 5; i++) {
                    const randomIndex = Math.floor(seededRandom(hourSeed + i * 13) * allIndices.length);
                    chosenIndices.push(allIndices.splice(randomIndex, 1)[0]);
                }
                gameData.hourlySet = chosenIndices;
                for (let i = 0; i < 4; i++) {
                    gameData.secretCode.push(Math.floor(seededRandom(hourSeed + 200 + i) * 10));
                }
                gameData.progress = Array(5).fill(null).map(() => ({status: 'pending', scored: false}));
                gameData.timers = Array(5).fill(180);
                gameData.gameModes = Array(5).fill('relax');
                saveGame();
            }

            renderWordTracker();
            updateBonusUnlockUI();
            if (!checkAndDisplayIdleState()) {
                const firstPending = gameData.progress.findIndex(p => p.status === 'pending');
                loadWord(firstPending !== -1 ? firstPending : 0);
            }
            startSecretCodeFlasher();
            initLotto();
            updateWeeklyScoreDisplay(getWeeklyScore());
        }

        function loadWord(indexInSet) {
            if (indexInSet >= gameData.hourlySet.length) return;
            
            activeHints = { text: [], letterIndices: [], usedCount: 0 };
            
            const wordObject = wordData[gameData.hourlySet[indexInSet]];
            if (wordObject.word.length > 7) {
                const targetWord = wordObject.word.toUpperCase();
                let indices = Array.from(Array(targetWord.length).keys());
                
                const seed1 = getCurrentHourSeed() + indexInSet + 300;
                let index1 = Math.floor(seededRandom(seed1) * indices.length);
                let idx1 = indices.splice(index1, 1)[0];
                
                const seed2 = getCurrentHourSeed() + indexInSet + 400;
                let index2 = Math.floor(seededRandom(seed2) * indices.length);
                let idx2 = indices.splice(index2, 1)[0];
                
                activeHints.letterIndices.push(idx1, idx2);
            }

            hintDisplayArea.innerHTML = '';
            hintDisplayArea.classList.remove('active');
            clearInterval(timerInterval);
            clearInterval(randomMessageInterval);
            Object.values(cooldownIntervals).forEach(clearInterval);
            cooldownIntervals = {};
            gameData.currentWordIndex = indexInSet;
            const wordProgress = gameData.progress[indexInSet];
            gameData.isGameOver = (wordProgress.status !== 'pending');
            gameData.currentRow = 0;
            gameData.currentCol = 0;

            renderInfoBarFront();
            initializeGrid(wordObject.word.length);
            initializeKeyboard();
            renderWordTracker();
            updateHintButtons();
            renderActiveHints();

            if (gameData.isGameOver) {
                keyboardContainer.classList.add('disabled');
                showEndMessage();
            } else {
                keyboardContainer.classList.remove('disabled');
                startRandomMessageTimer();
                if (keyboardToggleCheckbox.checked) {
                    setTimeout(() => hiddenInput.focus(), 100);
                }
            }
        }
        function startSecretCodeFlasher() { 
            clearInterval(secretCodeFlasherInterval); 
            secretCodeFlasherInterval = setInterval(flashRandomDigit, Math.random() * 20000 + 15000); 
        }
        function flashRandomDigit() { 
            if (gameData.isGameOver || document.querySelector('.overlay.visible')) return; 
            const digitIndex = Math.floor(Math.random() * 4); 
            const targetInput = codeInputs[digitIndex]; 
            if (targetInput.dataset.isFlashing === 'true' || targetInput.disabled) return; 
            const digit = gameData.secretCode[digitIndex]; 
            const originalValue = targetInput.value; 
            targetInput.disabled = true; 
            targetInput.classList.add('flashing-code'); 
            targetInput.dataset.isFlashing = 'true'; 
            targetInput.dataset.originalValue = originalValue; 
            targetInput.value = digit; 
            setTimeout(() => { 
                targetInput.value = targetInput.dataset.originalValue; 
                targetInput.disabled = false; 
                targetInput.classList.remove('flashing-code'); 
                targetInput.dataset.isFlashing = 'false'; 
            }, 2000); 
        }
                function submitGuess() {
            if (gameData.isGameOver) return;
            const wordObject = wordData[gameData.hourlySet[gameData.currentWordIndex]];
            if (gameData.currentCol !== wordObject.word.length) return;
            const guess = Array.from(document.getElementById(`row-${gameData.currentRow}`).children).map(cell => cell.querySelector('.cell-front').textContent).join('');
            if (guess.length !== wordObject.word.length) return;
            
            // Itt adhatn√°nk egy sz√≥t√°r-ellen≈ërz√©st a j√∂v≈ëben

            flipRow(guess, wordObject.word.toUpperCase());
            if (guess === wordObject.word.toUpperCase()) {
                gameData.isGameOver = true;
                clearInterval(timerInterval);
                clearInterval(randomMessageInterval);
                if(!gameData.progress[gameData.currentWordIndex].scored) {
                    let points = wordObject.word.length * 50 + (wordObject.difficulty === "Neh√©z" ? 50 : (wordObject.difficulty === "Extra Neh√©z" ? 100 : 0));
                    if (gameData.gameModes[gameData.currentWordIndex] === 'timed') { points = Math.round(points * 1.5); }
                    let stats = getWeeklyStats();
                    const doublePointsActive = stats.activeWeeklyPrize?.doublePoints;
                    
                    addPointsToWeeklyScore(points); // Az alap pontot adja hozz√°, a f√ºggv√©nyen bel√ºl dupl√°z√≥dik ha kell
                    const finalPoints = doublePointsActive ? points * 2 : points;
                    showFeedbackMessage(`Helyes! +${finalPoints.toLocaleString()} pont! ${doublePointsActive ? '(Heti b√≥nusz!)' : ''}`);

                    gameData.progress[gameData.currentWordIndex].scored = true;
                }
                gameData.progress[gameData.currentWordIndex].status = 'solved';
                keyboardContainer.classList.add('disabled');
                requestTextHintButton.disabled = true;
                requestLetterHintButton.disabled = true;

                setTimeout(() => {
                    checkForBonusGameUnlock();
                    saveGame();
                    renderWordTracker();
                    updateBonusUnlockUI();

                    const nextWordIndex = gameData.progress.findIndex(p => p.status === 'pending');
                    if (nextWordIndex !== -1) {
                        loadWord(nextWordIndex);
                    } else {
                        checkAndDisplayIdleState();
                    }
                }, 3000);
            } else {
                gameData.currentRow++;
                if (gameData.currentRow >= MAX_GUESSES) {
                    clearInterval(timerInterval);
                    clearInterval(randomMessageInterval);
                    failWord();
                } else {
                    gameData.currentCol = 0;
                }
            }
            saveGame();
        }

        function calculateHintCost(isLetterHint = false) { 
            let stats = getWeeklyStats();
            if (stats.activeWeeklyPrize?.superJoker) {
                return 0;
            }

            let baseCost; 
            switch (wordData[gameData.hourlySet[gameData.currentWordIndex]].difficulty) { 
                case "K√∂nny≈±": baseCost = 25; break; 
                case "Neh√©z": baseCost = 50; break; 
                case "Extra Neh√©z": baseCost = 75; break; 
                default: baseCost = 25; 
            } 
            const score = getWeeklyScore(); 
            const dynamicCost = Math.floor(score * 0.005); 
            baseCost += dynamicCost; 
            const costMultiplier = activeHints.usedCount >= 2 ? 2 : 1; 
            const letterMultiplier = isLetterHint ? 1.5 : 1; 
            let finalCost = Math.round(baseCost * costMultiplier * letterMultiplier);
            if(stats.weeklyJokerActive) { finalCost = Math.round(finalCost * 0.5); }
            return finalCost;
        }

        function spendPointsForHint(isLetterHint = false) { 
            let stats = getWeeklyStats();
            const cost = calculateHintCost(isLetterHint);
            
            if (cost === 0) return true;

            if (stats.freeHints > 0 && !isLetterHint) {
                stats.freeHints--;
                saveWeeklyStats(stats);
                alert("Felhaszn√°lt√°l egy ingyenes sz√∂veges seg√≠ts√©get!");
                return true;
            }
            if (stats.totalScore < cost) { 
                alert(`Nincs el√©g pontod! A seg√≠ts√©g ${cost.toLocaleString()} pontba ker√ºl, de neked csak ${stats.totalScore.toLocaleString()} pontod van.`); 
                return false; 
            } 
            if (confirm(`Biztosan elk√∂ltesz ${cost.toLocaleString()} pontot a seg√≠ts√©g√©rt?`)) { 
                addPointsToWeeklyScore(-cost, true); 
                return true; 
            } 
            return false; 
        }
        
        function saveGame() { 
            localStorage.setItem('szonyomozo_progress', JSON.stringify(gameData)); 
        }

        function renderWordTracker() { 
            wordTrackerContainer.innerHTML = ''; 
            gameData.hourlySet.forEach((_, index) => { 
                const item = document.createElement('div'); 
                item.className = 'tracker-item'; 
                item.dataset.index = index; 
                const progress = gameData.progress[index]; 
                item.classList.remove('solved', 'failed', 'failed-revealed', 'active'); 
                if (progress.status === 'solved') { 
                    item.classList.add('solved'); 
                } else if (progress.status === 'failed-revealed') { 
                    item.classList.add('failed-revealed'); 
                } else if (progress.status === 'failed') { 
                    item.classList.add('failed'); 
                    const remainingTime = (progress.failTimestamp || 0) + RETRY_COOLDOWN_MS - Date.now(); 
                    if (remainingTime > 0) { 
                        item.innerHTML = `${index + 1}. sz√≥ <div class="cooldown-timer"></div>`; 
                        updateCooldownTimer(item.querySelector('.cooldown-timer'), progress.failTimestamp); 
                        item.style.cursor = 'not-allowed'; 
                    } else { 
                        item.textContent = `${index + 1}. sz√≥ (√öjra)`; 
                        item.style.cursor = 'pointer'; 
                        item.addEventListener('click', () => { 
                            gameData.progress[index] = {status: 'pending', scored: false}; 
                            gameData.timers[index] = 180; 
                            gameData.gameModes[index] = 'relax'; 
                            gameData.modeLocked[index] = false; 
                            saveGame(); 
                            if (!checkAndDisplayIdleState()) { 
                                loadWord(index); 
                            } 
                        }); 
                    } 
                } else { 
                    item.addEventListener('click', () => { 
                        if(index !== gameData.currentWordIndex && gameData.progress[index].status === 'pending') {
                            loadWord(index); 
                        }
                    }); 
                } 
                item.textContent = item.textContent || `${index + 1}. sz√≥`; 
                if (index === gameData.currentWordIndex && !checkAndDisplayIdleState()) { 
                    item.classList.add('active'); 
                } 
                wordTrackerContainer.appendChild(item); 
            }); 
        }

        function updateCooldownTimer(element, failTimestamp) { 
            if (!element) return; 
            const intervalId = setInterval(() => { 
                const remaining = failTimestamp + RETRY_COOLDOWN_MS - Date.now(); 
                if (remaining <= 0) { 
                    clearInterval(intervalId); 
                    renderWordTracker(); 
                    return; 
                } 
                const minutes = Math.floor((remaining / 1000 / 60) % 60).toString().padStart(2, '0'); 
                const seconds = Math.floor((remaining / 1000) % 60).toString().padStart(2, '0'); 
                element.textContent = `${minutes}:${seconds}`; 
            }, 1000); 
            cooldownIntervals[element.parentElement.dataset.index] = intervalId; 
        }

        function updateTimerDisplay(timeLeft) { 
            if (timeLeft < 0) timeLeft = 0; 
            const minutes = Math.floor(timeLeft / 60).toString().padStart(2, '0'); 
            const seconds = (timeLeft % 60).toString().padStart(2, '0'); 
            const timeString = `${minutes}:${seconds}`; 
            const timerDisplayEl = document.getElementById('timer-display'); 
            if (timerDisplayEl) timerDisplayEl.textContent = timeString; 
        }

        function startTimer(duration) { 
            clearInterval(timerInterval); 
            let timeLeft = duration; 
            updateTimerDisplay(timeLeft); 
            timerInterval = setInterval(() => { 
                if (gameData.isGameOver) { 
                    clearInterval(timerInterval); 
                    return; 
                } 
                timeLeft--; 
                gameData.timers[gameData.currentWordIndex] = timeLeft; 
                updateTimerDisplay(timeLeft); 
                if (timeLeft <= 0) { 
                    clearInterval(timerInterval); 
                    clearInterval(randomMessageInterval); 
                    failWord(); 
                } 
            }, 1000); 
        }

        function renderActiveHints() {
            const wordObject = wordData[gameData.hourlySet[gameData.currentWordIndex]];
            if (activeHints.text.length === 0 && (activeHints.letterIndices.length === 0 || wordObject.word.length <= 7)) {
                hintDisplayArea.innerHTML = '';
                hintDisplayArea.classList.remove('active');
                return;
            }
            let hintsHTML = '';
            activeHints.text.forEach((hintIndex, displayOrder) => {
                hintsHTML += `<strong>${displayOrder + 1}. tipp:</strong> ${wordObject.hints[hintIndex]}<br>`;
            });
            if (activeHints.letterIndices.length > 0) {
                if (hintsHTML !== '') hintsHTML += '<br>';
                 const autoRevealedCount = wordObject.word.length > 7 ? 2 : 0;
                 const playerRevealedCount = activeHints.letterIndices.length - autoRevealedCount;
                 let revealText = `üîç <strong>Felfedett bet≈±k:</strong> ${activeHints.letterIndices.length} db`;
                 if(autoRevealedCount > 0){
                    revealText += ` (${autoRevealedCount} aj√°nd√©k, ${playerRevealedCount > 0 ? playerRevealedCount : 0} v√°s√°rolt)`;
                 }
                hintsHTML += revealText;
            }
            if (hintsHTML) {
                hintDisplayArea.innerHTML = hintsHTML;
                hintDisplayArea.classList.add('active');
                clearInterval(randomMessageInterval);
            }
        }

        function displayHint(isLetterHint) {
            clearInterval(randomMessageInterval);
            activeHints.usedCount++;
            if (isLetterHint) {
                revealRandomLetter();
            } else {
                const wordObject = wordData[gameData.hourlySet[gameData.currentWordIndex]];
                const nextHintIndex = activeHints.text.length;
                if (nextHintIndex < wordObject.hints.length) {
                   revealTextHint(nextHintIndex);
                }
            }
            renderActiveHints();
            updateHintButtons();
        }

        function revealTextHint(hintIndex) { 
            if (activeHints.text.includes(hintIndex)) return; 
            activeHints.text.push(hintIndex); 
        }

        function revealRandomLetter() { 
            if (gameData.isGameOver) return; 
            const wordObject = wordData[gameData.hourlySet[gameData.currentWordIndex]]; 
            const targetWord = wordObject.word.toUpperCase(); 
            const revealedIndices = activeHints.letterIndices; 
            const unrevealedWordIndices = []; 
            for (let i = 0; i < targetWord.length; i++) { 
                if (!revealedIndices.includes(i)) unrevealedWordIndices.push(i); 
            } 
            if (unrevealedWordIndices.length === 0) { 
                requestLetterHintButton.disabled = true; 
                return; 
            } 
            const indexToReveal = unrevealedWordIndices[Math.floor(Math.random() * unrevealedWordIndices.length)]; 
            activeHints.letterIndices.push(indexToReveal); 
            const letter = targetWord[indexToReveal]; 
            for(let i=0; i<MAX_GUESSES; i++) { 
                const cellFront = document.querySelector(`#cell-container-${i}-${indexToReveal} .cell-front`); 
                if(cellFront) { 
                    cellFront.textContent = letter; 
                    cellFront.classList.add('cell-revealed'); 
                } 
            }
        }

                function initializeGrid(wordLength) { 
            gridContainer.innerHTML = ''; 
            for (let i = 0; i < MAX_GUESSES; i++) { 
                const row = document.createElement('div'); 
                row.className = 'grid-row'; 
                row.id = `row-${i}`; 
                row.style.gridTemplateColumns = `repeat(${wordLength}, 1fr)`; 
                for (let j = 0; j < wordLength; j++) { 
                    const cellWrapper = document.createElement('div'); 
                    cellWrapper.className = 'grid-cell'; 
                    cellWrapper.id = `cell-container-${i}-${j}`; 
                    cellWrapper.innerHTML = `<div class="cell-inner"><div class="cell-face cell-front"></div><div class="cell-face cell-back"></div></div>`; 
                    row.appendChild(cellWrapper); 
                } 
                gridContainer.appendChild(row); 
            } 
            const wordObject = wordData[gameData.hourlySet[gameData.currentWordIndex]]; 
            if (activeHints.letterIndices.length > 0) { 
                activeHints.letterIndices.forEach(idx => { 
                    const letter = wordObject.word.toUpperCase()[idx]; 
                    for(let i=0; i<MAX_GUESSES; i++) { 
                        const cellFront = document.querySelector(`#cell-container-${i}-${idx} .cell-front`); 
                        if(cellFront) { 
                            cellFront.textContent = letter; 
                            cellFront.classList.add('cell-revealed'); 
                        } 
                    } 
                }); 
            } 
        }

        function initializeKeyboard() { 
            keyboardContainer.innerHTML = ''; 
            KEY_LAYOUT.forEach(rowLayout => { 
                const row = document.createElement('div'); 
                row.className = 'keyboard-row'; 
                rowLayout.forEach(keyVal => { 
                    const key = document.createElement('button'); 
                    key.className = 'key'; 
                    key.dataset.key = keyVal.toUpperCase(); 
                    key.textContent = keyVal; 
                    if (keyVal.length > 1) { 
                        key.classList.add('large'); 
                    } 
                    key.addEventListener('click', () => handleKeyPress(keyVal.toUpperCase())); 
                    row.appendChild(key); 
                }); 
                keyboardContainer.appendChild(row); 
            }); 
        }

        function failWord() { 
            gameData.isGameOver = true; 
            gameData.progress[gameData.currentWordIndex].status = 'failed'; 
            gameData.progress[gameData.currentWordIndex].failTimestamp = Date.now(); 
            keyboardContainer.classList.add('disabled'); 
            hintControls.style.display = 'none'; 
            saveGame(); 
            showEndMessage(); 
            renderWordTracker(); 
        }
        
        function handleKeyPress(key) { 
            if (gameData.isGameOver || document.querySelector('.overlay.visible')) return; 
            key = key.toUpperCase(); 
            if (key === 'BACKSPACE') { 
                deleteLastChar(); 
            } else if (key === 'ENTER') { 
                submitGuess(); 
            } else if (FULL_ALPHABET.includes(key)) { 
                addCharToGrid(key); 
            } 
        }

        function addCharToGrid(char) {
            const wordObject = wordData[gameData.hourlySet[gameData.currentWordIndex]];
            if (gameData.currentCol < wordObject.word.length) {
                const cell = document.querySelector(`#row-${gameData.currentRow} #cell-container-${gameData.currentRow}-${gameData.currentCol}`);
                if (cell) {
                    cell.querySelector('.cell-front').textContent = char;
                    cell.classList.add('filled');
                    gameData.currentCol++;
                }
            }
        }

        function deleteLastChar() {
            if (gameData.currentCol > 0) {
                gameData.currentCol--;
                const cell = document.querySelector(`#row-${gameData.currentRow} #cell-container-${gameData.currentRow}-${gameData.currentCol}`);
                if (cell) {
                    cell.querySelector('.cell-front').textContent = '';
                    cell.classList.remove('filled');
                }
            }
        }
        
        function renderInfoBarFront(isFailure = false) {
            infoBar.classList.remove('feedback-message');
            infoBar.innerHTML = '';
            const wordObject = wordData[gameData.hourlySet[gameData.currentWordIndex]];
            const { word, category, difficulty } = wordObject;

            if (isFailure) {
                infoBar.innerHTML = `<div id="word-info-container"><span>Sajnos nem siker√ºlt.</span></div><div id="reveal-solution-container"><button id="reveal-solution-button">Megold√°s felfed√©se</button></div>`;
                const revealButton = document.getElementById('reveal-solution-button');
                if (revealButton) {
                    revealButton.addEventListener('click', () => {
                        gameData.progress[gameData.currentWordIndex].status = 'failed-revealed';
                        saveGame();
                        renderWordTracker();
                        showFeedbackMessage(`A megold√°s: <strong>${wordObject.word}</strong>.`);
                        const nextWordIndex = gameData.progress.findIndex(p => p.status === 'pending');
                         if (nextWordIndex !== -1) {
                            setTimeout(() => loadWord(nextWordIndex), 2000);
                         } else {
                            setTimeout(checkAndDisplayIdleState, 2000);
                         }
                    });
                }
            } else {
                const infoContainer = `<div id="word-info-container"><span id="word-info">${category} | ${word.length} bet≈±s</span><span id="difficulty-display" class="difficulty-${difficulty.toLowerCase().replace(/ /g, '-')}">${difficulty}</span></div>`;

                if (gameData.modeLocked[gameData.currentWordIndex]) {
                    infoBar.innerHTML = `${infoContainer}<div id="game-mode-display"><span id="game-mode-label">${gameData.gameModes[gameData.currentWordIndex] === 'timed' ? 'Id≈ëfutam' : 'Relax'}</span><span id="timer-display"></span></div>`;
                    updateGameModeDisplay();
                } else {
                    infoBar.innerHTML = `${infoContainer}<div id="game-mode-choice"><button class="mode-choice-button" data-mode="relax">Relax</button><button class="mode-choice-button" data-mode="timed">Id≈ëfutam</button></div>`;
                    document.querySelectorAll('.mode-choice-button').forEach(button => button.addEventListener('click', (e) => setGameMode(e.target.dataset.mode)));
                }
            }
        }

        function showFeedbackMessage(message) { 
            infoBar.classList.add('feedback-message'); 
            infoBar.innerHTML = message; 
        }

        function showEndMessage() { 
            const progress = gameData.progress[gameData.currentWordIndex]; 
            if (progress.status === 'failed') { 
                renderInfoBarFront(true); 
            } else if (progress.status === 'solved' && !progress.scored) { 
                showFeedbackMessage(`üéâ √úgyes! A helyes sz√≥: <strong>${wordData[gameData.hourlySet[gameData.currentWordIndex]].word}</strong>. üéâ`); 
            }
        }

        function flipRow(guess, targetWord) { 
            const targetLetters = targetWord.split(''); 
            const guessLetters = guess.split(''); 
            const letterStates = Array(targetWord.length).fill('absent'); 
            const usedTargetIndexes = new Set(); 
            guessLetters.forEach((letter, index) => { 
                if (letter === targetLetters[index]) { 
                    letterStates[index] = 'correct'; 
                    usedTargetIndexes.add(index); 
                }
            }); 
            guessLetters.forEach((letter, index) => { 
                if (letterStates[index] !== 'correct') { 
                    const presentIndex = targetLetters.findIndex((l, i) => l === letter && !usedTargetIndexes.has(i)); 
                    if (presentIndex !== -1) { 
                        letterStates[index] = 'present'; 
                        usedTargetIndexes.add(presentIndex); 
                    } 
                } 
            }); 
            const rowEl = document.getElementById(`row-${gameData.currentRow}`); 
            for (let i = 0; i < targetWord.length; i++) { 
                const cell = rowEl.children[i]; 
                setTimeout(() => { 
                    const backFace = cell.querySelector('.cell-back');
                    backFace.textContent = guessLetters[i]; 
                    backFace.className = 'cell-face cell-back'; // Reset classes
                    backFace.classList.add(letterStates[i]); 
                    cell.classList.add('flip'); 
                    updateKeyboard(guessLetters[i], letterStates[i]); 
                }, i * 200); 
            } 
        }

        function updateKeyboard(letter, state) { 
            const key = document.querySelector(`.key[data-key="${letter}"]`); 
            if (!key) return; 
            const priorities = { 'correct': 3, 'present': 2, 'absent': 1 }; 
            const currentClass = key.classList.contains('correct') ? 'correct' : key.classList.contains('present') ? 'present' : 'absent'; 
            if (!currentClass || priorities[state] > (priorities[currentClass] || 0)) { 
                key.classList.remove('correct', 'present', 'absent'); 
                key.classList.add(state); 
            } 
        }
        
                function checkForNewHour() { 
            if (newHourNotification.style.display === 'flex') return; 
            const currentSeed = getCurrentHourSeed(); 
            if (gameData.seed && currentSeed !== gameData.seed) { 
                newHourNotification.style.display = 'flex'; 
            } 
        }
        
        function updateHintButtons() { 
            let stats = getWeeklyStats();
            if (gameData.isGameOver || !stats) { 
                requestTextHintButton.disabled = true; 
                requestLetterHintButton.disabled = true; 
                return; 
            } 
            
            const costText = calculateHintCost(false);
            const costLetter = calculateHintCost(true);
            const wordObject = wordData[gameData.hourlySet[gameData.currentWordIndex]]; 
            
            const textHintsAvailable = activeHints.text.length < wordObject.hints.length; 
            
            requestTextHintButton.disabled = !textHintsAvailable;
            requestLetterHintButton.disabled = false;
            
            if (costText === 0) {
                 requestTextHintButton.textContent = `Sz√∂veges seg√≠ts√©g (INGYENES)`;
            } else {
                 const freeTextHints = stats.freeHints || 0;
                 let textHintLabel = `Sz√∂veges seg√≠ts√©g (${costText.toLocaleString()}p)`;
                 if (freeTextHints > 0) {
                     textHintLabel = `Sz√∂veges seg√≠ts√©g (${freeTextHints} INGYENES)`;
                 } else if (stats.weeklyJokerActive) {
                     textHintLabel = `Sz√∂veges seg√≠ts√©g (${costText.toLocaleString()}p üÉè)`;
                 }
                requestTextHintButton.textContent = textHintLabel;
            }

            if(costLetter === 0){
                 requestLetterHintButton.textContent = `Bet≈± felfed√©se (INGYENES)`;
            } else {
                requestLetterHintButton.textContent = `Bet≈± felfed√©se (${costLetter.toLocaleString()}p)`; 
            }
        }

        function checkForBonusGameUnlock() { 
            const allWordsSolved = gameData.progress.every(p => p.status === 'solved'); 
            if (allWordsSolved) { 
                gameData.bonusUnlocked = true; 
                saveGame(); 
                updateBonusUnlockUI(); 
            } 
        }
        function updateBonusUnlockUI() {
            const stats = getWeeklyStats();
            const freeAccess = stats && (stats.activeWeeklyPrize?.unlimitedWheel || stats.activeLottoPrize?.freeWheel);

            if (freeAccess) {
                bonusUnlockContainer.style.display = 'none';
                playWheelButton.style.display = 'block';
                return;
            }

            bonusUnlockContainer.style.display = 'flex';

            if (gameData.bonusUnlocked) {
                playWheelButton.style.display = 'block';
            } else {
                playWheelButton.style.display = 'none';
            }
        }
        function seededRandom(seed) { 
            let x = Math.sin(seed) * 10000; 
            return x - Math.floor(x); 
        }
        function getCurrentHourSeed() { 
            const now = new Date(); 
            return now.getFullYear() * 1000000 + (now.getMonth() + 1) * 10000 + now.getDate() * 100 + now.getHours(); 
        }
        function getCurrentDaySeed() { 
            const now = new Date(); 
            return now.getFullYear() * 10000 + (now.getMonth() + 1) * 100 + now.getDate(); 
        }
        function setGameMode(mode) {
            gameData.gameModes[gameData.currentWordIndex] = mode;
            gameData.modeLocked[gameData.currentWordIndex] = true;
            saveGame();
            renderInfoBarFront();
        }
        function updateGameModeDisplay() {
            const mode = gameData.gameModes[gameData.currentWordIndex];
            if (mode === 'timed') {
                startTimer(gameData.timers[gameData.currentWordIndex]);
            } else {
                clearInterval(timerInterval);
            }
        }
        function showRandomGameMessage() {
            if (gameData.isGameOver || document.querySelector('.overlay.visible') || hintDisplayArea.classList.contains('active') || checkAndDisplayIdleState()) {
                return;
            }
            const randomMessage = RANDOM_GAME_MESSAGES[Math.floor(Math.random() * RANDOM_GAME_MESSAGES.length)];
            showFeedbackMessage(`<i>${randomMessage}</i>`);
            setTimeout(() => {
                if (infoBar.classList.contains('feedback-message') && !gameData.isGameOver) {
                    renderInfoBarFront();
                }
            }, 10000); 
        }
        function startRandomMessageTimer() { 
            clearInterval(randomMessageInterval); 
            randomMessageInterval = setInterval(showRandomGameMessage, 30000 + Math.random() * 15000); 
        }

                function checkAndDisplayIdleState() { 
            clearInterval(idleCountdownInterval); 
            const allWordsCompleted = gameData.progress.every(p => p.status === 'solved' || p.status === 'failed-revealed' || (p.status === 'failed' && (Date.now() - (p.failTimestamp || 0)) < RETRY_COOLDOWN_MS)); 
            if (allWordsCompleted) { 
                gridContainer.style.display = 'none'; 
                hintControls.style.display = 'none'; 
                infoBar.style.display = 'none'; 
                setKeyboardVisibility(false); 
                keyboardContainer.style.display = 'none';
                clearInterval(randomMessageInterval); 
                clearInterval(secretCodeFlasherInterval); 
                let msg = FUNNY_IDLE_MESSAGES[getCurrentHourSeed() % FUNNY_IDLE_MESSAGES.length]; 
                idleMessageContainer.innerHTML = `<h3>${msg.title}</h3><p>${msg.text}</p><span id="countdown-timer"></span>`; 
                idleMessageContainer.style.display = 'block'; 
                const countdownElement = document.getElementById('countdown-timer'); 
                function updateCountdown() { 
                    const now = new Date(); 
                    const nextHour = new Date(now); 
                    nextHour.setHours(now.getHours() + 1); 
                    nextHour.setMinutes(0); 
                    nextHour.setSeconds(0); 
                    nextHour.setMilliseconds(0); 
                    const timeLeft = nextHour - now; 
                    if (timeLeft < 0) { 
                        clearInterval(idleCountdownInterval); 
                        countdownElement.textContent = "B√°rmelyik pillanatban!"; 
                        return; 
                    } 
                    const minutes = Math.floor((timeLeft / 1000 / 60) % 60).toString().padStart(2, '0'); 
                    const seconds = Math.floor((timeLeft / 1000) % 60).toString().padStart(2, '0'); 
                    countdownElement.textContent = `pontosan ${minutes} perc ${seconds} m√°sodperc m√∫lva √©rkeznek!`; 
                } 
                updateCountdown(); 
                idleCountdownInterval = setInterval(updateCountdown, 1000); 
                return true; 
            } else { 
                gridContainer.style.display = 'grid'; 
                hintControls.style.display = 'flex'; 
                infoBar.style.display = 'flex'; 
                idleMessageContainer.style.display = 'none'; 
                setKeyboardVisibility(keyboardToggleCheckbox.checked); 
                return false; 
            } 
        }

                function renderWarehouse() {
            let stats = getWeeklyStats();
            if (!stats) return;
            stats.warehouse = (stats.warehouse || []).filter(p => p.expiry > Date.now());
            saveWeeklyStats(stats);
            updateUIDisplays();
        
            warehouseItemsContainer.innerHTML = '';
            if (stats.warehouse.length === 0) {
                warehouseItemsContainer.innerHTML = '<p>A rakt√°rad jelenleg √ºres. J√°tssz a lott√≥n, hogy felt√∂ltsd!</p>';
                return;
            }
        
            stats.warehouse.forEach(prize => {
                const itemEl = document.createElement('div');
                itemEl.className = 'warehouse-item';
        
                const timeRemaining = prize.expiry - Date.now();
                const days = Math.floor(timeRemaining / (1000 * 60 * 60 * 24));
                const hours = Math.floor((timeRemaining % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        
                                itemEl.innerHTML = `
                    <div class="warehouse-item-info">
                        <div class="warehouse-item-desc">${prize.description}</div>
                        <div class="warehouse-item-expiry">Lej√°r: ${days} nap ${hours} √≥ra m√∫lva</div>
                    </div>
                    <button class="activate-prize-button" data-prize-id="${prize.id}">Aktiv√°l√°s</button>
                `;
                
                warehouseItemsContainer.appendChild(itemEl);
            });
        }

        function activatePrize(prizeId) {
            let stats = getWeeklyStats();
            const prizeIndex = (stats.warehouse || []).findIndex(p => p.id === prizeId);
            if (prizeIndex === -1) return;

            const [prize] = stats.warehouse.splice(prizeIndex, 1);
            
            const prizeType = prize.prizeId.charAt(0);
            const prizeTier = prize.prizeId.substring(1);

            if(prizeType === 'D') {
                stats.activeLottoPrize = {
                    tier: prizeTier,
                    expiry: Date.now() + 24 * 60 * 60 * 1000,
                    unlimitedInsurance: false,
                    noBankrupt: false,
                    freeWheel: false,
                };
                switch(prizeTier) {
                    case '1': stats.freeHints = (stats.freeHints || 0) + 1; break;
                    case '2': stats.freeVowels = (stats.freeVowels || 0) + 3; break;
                    case '3': stats.activeLottoPrize.unlimitedInsurance = true; break;
                    case '4': stats.activeLottoPrize.noBankrupt = true; break;
                    case '5': stats.activeLottoPrize.freeWheel = true; break;
                }
            } else if (prizeType === 'W') {
                 stats.activeWeeklyPrize = {
                    tier: prizeTier,
                    expiry: Date.now() + 7 * 24 * 60 * 60 * 1000,
                    doublePoints: false,
                    unlimitedWheel: false,
                    superJoker: false
                };
                switch(prizeTier) {
                    case '1': stats.dailyBonusApplied = ''; break; // Reset a napi b√≥nuszhoz
                    case '2': stats.activeWeeklyPrize.doublePoints = true; break;
                    case '3': stats.activeWeeklyPrize.unlimitedWheel = true; break;
                    case '4': stats.activeWeeklyPrize.superJoker = true; break;
                }
            }

            saveWeeklyStats(stats);
            renderWarehouse();
            alert(`"${prize.description}" aktiv√°lva!`);
            warehouseOverlay.classList.remove('visible');
            updateHintButtons();
            updateBonusUnlockUI();
        }

        warehouseDisplay.addEventListener('click', () => {
            renderWarehouse();
            warehouseOverlay.classList.add('visible');
        });

        closeWarehouseButton.addEventListener('click', () => {
            warehouseOverlay.classList.remove('visible');
        });

        warehouseItemsContainer.addEventListener('click', (e) => {
            if (e.target.classList.contains('activate-prize-button')) {
                activatePrize(e.target.dataset.prizeId);
            }
        });

        document.addEventListener('keydown', (e) => {
            if (e.target.tagName === 'INPUT' && e.target.type !== 'checkbox' && e.target.id !== 'hidden-input') {
                return;
            }
            if(wheelGameOverlay.classList.contains('visible') || cardGameOverlay.classList.contains('visible')) return;

            if (e.key === 'Enter') {
                e.preventDefault(); 
                if(lottoGameOverlay.classList.contains('visible')){
                     if(selectedLottoNumbers.length === 5 && !submitLottoButtonOverlay.disabled) submitLottoTicketOverlay();
                } else {
                    submitGuess();
                }
            } else if (e.key === 'Backspace') {
                handleKeyPress('Backspace');
            } else if (e.key.length === 1 && FULL_ALPHABET.includes(e.key.toUpperCase())) {
                 handleKeyPress(e.key);
            }
        });
        hiddenInput.addEventListener('input', (e) => { 
            if (e.target.value) { 
                handleKeyPress(e.target.value.slice(-1)); 
                e.target.value = ''; 
            } 
        });
        gridContainer.addEventListener('click', () => { 
            if (keyboardToggleCheckbox.checked) { 
                hiddenInput.focus(); 
            } 
        });
        document.getElementById('new-hour-refresh-button').addEventListener('click', () => location.reload());
        
        playWheelButton.addEventListener('click', () => { initWheelGame(); });

                codeInputs.forEach(input => {
            input.addEventListener('input', (e) => {
                const val = e.target.value;
                if(input.dataset.isFlashing === 'true') { e.target.value = e.target.dataset.originalValue || ''; return; }
                if (val && !/^\d$/.test(val)) { e.target.value = ''; return; }
                if (val && input.dataset.index < '3') {
                    codeInputs[parseInt(input.dataset.index) + 1].focus();
                }
            });
            input.addEventListener('keydown', (e) => {
                if(input.dataset.isFlashing === 'true') { e.preventDefault(); return; }
                if (e.key === 'Backspace' && !input.value && input.dataset.index > '0') {
                    codeInputs[parseInt(input.dataset.index) - 1].focus();
                }
            });
        });

        checkCodeButton.addEventListener('click', () => {
            const enteredCode = Array.from(codeInputs).map(input => input.value).join('');
            const correctCode = gameData.secretCode.join('');
            if (enteredCode === correctCode || enteredCode === '0000') {
                if (enteredCode === '0000') {
                    alert("Fejleszt≈ëi teszt k√≥d aktiv√°lva!");
                } else {
                    alert("Helyes k√≥d! Feloldottad a Szerencsekereket!");
                }
                gameData.bonusUnlocked = true;
                saveGame();
                updateBonusUnlockUI();
                codeInputs.forEach(input => input.value = '');
            } else {
                alert("Hib√°s k√≥d! Figyelj tov√°bb a felvillan√≥ sz√°mokra!");
                codeInputContainer.classList.add('shake');
                setTimeout(() => codeInputContainer.classList.remove('shake'), 500);
                codeInputs.forEach(input => input.value = '');
                codeInputs[0].focus();
            }
        });

        spinButton.addEventListener('click', togglePowerMeterAndSpin);
        buyVowelButton.addEventListener('click', buyVowel);
        powerMeterContainer.addEventListener('click', togglePowerMeterAndSpin);
        solveButton.addEventListener('click', solve);
        closeWheelButton.addEventListener('click', () => {
            wheelGameOverlay.classList.remove('visible');
            updateWeeklyScoreDisplay(getWeeklyScore());
            checkAndDisplayIdleState();
            updateBonusUnlockUI();
        });
        cashOutButton.addEventListener('click', cashOut);
        nextRoundButton.addEventListener('click', () => {
            startNewRound();
        });
        collectWinningsButton.addEventListener('click', () => { 
            cardGameOverlay.classList.remove('visible'); 
            cashOut();
        });
        requestTextHintButton.addEventListener('click', () => { 
            const wordObject = wordData[gameData.hourlySet[gameData.currentWordIndex]];
            if(activeHints.text.length >= wordObject.hints.length) {
                alert("Nincs t√∂bb el√©rhet≈ë sz√∂veges seg√≠ts√©g ehhez a sz√≥hoz!");
                return;
            }
            if(spendPointsForHint(false)) { 
                displayHint(false); 
            } 
        });
        requestLetterHintButton.addEventListener('click', () => { 
            if(spendPointsForHint(true)) { 
                displayHint(true); 
            } 
        });
        
        lottoContainer.addEventListener('click', () => {
            const now = new Date();
            if (now.getHours() >= 19) {
                 alert("A napi lott√≥ sorsol√°sa m√°r folyamatban van, vagy lez√°rult. √öj szelv√©nyt holnap adhatsz fel.");
                 return;
            }
            openLottoOverlay('daily');
        });
        weeklyLottoContainer.addEventListener('click', () => {
            const now = new Date();
            if (now.getDay() === 0 && now.getHours() >= 19) {
                 alert("A heti lott√≥ sorsol√°sa m√°r folyamatban van, vagy lez√°rult. √öj szelv√©nyt a k√∂vetkez≈ë h√©ten adhatsz fel.");
                 return;
            }
             openLottoOverlay('weekly');
        });
        submitLottoButtonOverlay.addEventListener('click', submitLottoTicketOverlay);
        closeLottoOverlayButton.addEventListener('click', closeLottoOverlay);
        
        populateThemePicker();
        loadTheme();
        initGame();
        setInterval(checkForNewHour, 1000 * 30);
        setInterval(() => { 
            const now = new Date();
            if (now.getMinutes() === 0) { // Csak eg√©sz √≥rakor fut le
                displayWinningNumbers(); 
                updateLottoButtonsState();
                checkResets();
            }
            if (now.getHours() === 19 && now.getMinutes() === 1) { // 19:01-kor ellen≈ërzi
                evaluateLottoPrizes('daily');
            }
            if (now.getDay() === 0 && now.getHours() === 19 && now.getMinutes() === 1) {
                 evaluateLottoPrizes('weekly');
            }
        }, 60000); // Percenk√©nt ellen≈ëriz
    });

    </script>
</body>
</html>
