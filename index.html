<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Sz√≥Mester Pro</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Roboto+Mono:wght@500&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --font-title: 'Fredoka One', cursive;
            --font-main: 'Roboto Mono', monospace;
            --default-bg-start: #f4f7f9;
            --default-bg-end: #dce4e8;
            --default-container-bg: #ffffff;
            --default-text-color: #34495e;
            --default-title-color: #2980b9;
            --default-info-bg: #ecf0f1;
            --default-key-bg: #d1d5db;
            --default-key-text: #111827;
            --default-key-shadow: 0 3px 0 #a8adb3;
        }

        /* T√©ma defin√≠ci√≥k */
        .theme-day {
            --bg-start: #f4f7f9; --bg-end: #dce4e8; --container-bg: #fff; --text-color: #34495e;
            --title-color: #2980b9; --info-bg: #ecf0f1; --key-bg: #d1d5db; --key-text: #111827; --key-shadow: 0 3px 0 #a8adb3;
        }
        .theme-dusk {
            --bg-start: #2c3e50; --bg-end: #4ca1af; --container-bg: #34495e; --text-color: #ecf0f1;
            --title-color: #ffffff; --info-bg: rgba(0,0,0,0.2); --key-bg: #95a5a6; --key-text: #ffffff; --key-shadow: 0 3px 0 #7f8c8d;
        }
        .theme-sunset {
            --bg-start: #ff7e5f; --bg-end: #feb47b; --container-bg: #fff8f5; --text-color: #5d4037;
            --title-color: #e65100; --info-bg: #ffccbc; --key-bg: #ffab91; --key-text: #5d4037; --key-shadow: 0 3px 0 #e64a19;
        }
        .theme-forest {
            --bg-start: #134e5e; --bg-end: #71b280; --container-bg: #e8f5e9; --text-color: #1b5e20;
            --title-color: #2e7d32; --info-bg: #c8e6c9; --key-bg: #a5d6a7; --key-text: #1b5e20; --key-shadow: 0 3px 0 #66bb6a;
        }
         .theme-royal {
            --bg-start: #480048; --bg-end: #C04848; --container-bg: #2d182d; --text-color: #f3e5f5;
            --title-color: #ce93d8; --info-bg: rgba(0,0,0,0.3); --key-bg: #7b1fa2; --key-text: #ffffff; --key-shadow: 0 3px 0 #4a0072;
        }

        html { height: 100%; }
        body {
            background: linear-gradient(135deg, var(--bg-start, var(--default-bg-start)), var(--bg-end, var(--default-bg-end)));
            color: var(--text-color, var(--default-text-color));
            font-family: var(--font-main);
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding: 15px;
            box-sizing: border-box;
            -webkit-user-select: none; user-select: none;
            touch-action: manipulation;
            transition: background 0.5s ease;
        }

        #game-container {
            background-color: var(--container-bg, var(--default-container-bg));
            border-radius: 20px;
            box-shadow: 0 10px 35px rgba(0, 0, 0, 0.15);
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            max-width: 720px; /* Sz√©lesebb lett */
            padding: clamp(20px, 4vw, 40px);
            box-sizing: border-box;
            margin-top: 2vh;
            transition: background-color 0.5s ease, color 0.5s ease;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            text-align: center;
            width: 100%;
            margin-bottom: 20px;
            position: relative;
        }
        header h1 {
            font-family: var(--font-title);
            color: var(--title-color, var(--default-title-color));
            font-size: clamp(2.2rem, 8vw, 3.2rem);
            margin: 0;
            flex-grow: 1;
        }

        .header-buttons { display: flex; gap: 10px; }
        .icon-button {
            background: var(--info-bg, var(--default-info-bg));
            border: none; border-radius: 50%; width: 44px; height: 44px;
            cursor: pointer; font-size: 22px;
            display: flex; justify-content: center; align-items: center;
            color: var(--text-color, var(--default-text-color));
            transition: all 0.2s ease;
        }
        .icon-button:hover { transform: scale(1.1); }
        
        #theme-panel {
            position: absolute; top: 60px; right: 0;
            background-color: var(--container-bg, var(--default-container-bg));
            padding: 10px; border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            display: flex; gap: 10px;
            opacity: 0; transform: translateY(-10px);
            pointer-events: none; transition: all 0.3s ease;
            z-index: 100;
        }
        #theme-panel.visible { opacity: 1; transform: translateY(0); pointer-events: auto; }
        .theme-button {
            width: 30px; height: 30px; border-radius: 50%;
            border: 2px solid white; cursor: pointer; box-shadow: 0 0 5px rgba(0,0,0,0.2);
        }

        #info-bar {
            width: 100%; padding: 12px;
            background: var(--info-bg, var(--default-info-bg));
            border-radius: 10px; text-align: center;
            font-size: clamp(0.9rem, 2.5vw, 1.1rem); font-weight: 500;
        }

        #grid-container {
            display: grid; grid-template-rows: repeat(10, 1fr);
            gap: 8px; width: 100%; max-width: 580px;
            margin: 25px 0; height: 480px;
        }
        .grid-row { display: grid; gap: 8px; }

        .grid-cell { perspective: 1000px; }
        .cell-inner {
            position: relative; width: 100%; height: 100%;
            transition: transform 0.6s; transform-style: preserve-3d;
        }
        .grid-cell.flip .cell-inner { transform: rotateX(180deg); }
        .cell-face {
            position: absolute; width: 100%; height: 100%;
            backface-visibility: hidden; -webkit-backface-visibility: hidden;
            display: flex; justify-content: center; align-items: center;
            font-size: clamp(1.5rem, 5vw, 2.2rem); font-weight: bold;
            text-transform: uppercase; box-sizing: border-box; border-radius: 8px;
        }
        .cell-front { border: 3px solid #dce4e8; }
        .grid-cell.filled .cell-front { border-color: #bdc3c7; animation: pop 0.2s; }
        .cell-back {
            color: white; transform: rotateX(180deg);
            border: 3px solid transparent;
        }
        .cell-back.correct { background-color: #27ae60; border-color: #27ae60;}
        .cell-back.present { background-color: #f1c40f; border-color: #f1c40f;}
        .cell-back.absent  { background-color: #95a5a6; border-color: #95a5a6;}

        @keyframes pop { 50% { transform: scale(1.1); } }

        #hint-container {
            background-color: var(--info-bg, var(--default-info-bg));
            border-radius: 10px; padding: 15px; margin: 20px 0;
            text-align: center; width: 100%; min-height: 40px;
            font-style: italic; color: #7f8c8d; font-weight: 500;
        }
        #hint-text strong { color: var(--text-color, var(--default-text-color)); }

        #keyboard-container {
            display: flex; flex-direction: column; gap: 10px;
            width: 100%; padding-top: 10px;
        }
        .keyboard-row { display: flex; justify-content: center; gap: 6px; width: 100%; }
        .key {
            font-family: var(--font-main); font-weight: 500;
            background-color: var(--key-bg, var(--default-key-bg));
            color: var(--key-text, var(--default-key-text));
            border: none; border-radius: 8px; height: 55px;
            flex: 1; cursor: pointer; text-transform: uppercase;
            font-size: clamp(0.8rem, 2.5vw, 1.2rem);
            display: flex; justify-content: center; align-items: center;
            transition: all 0.1s ease-in-out;
            box-shadow: var(--key-shadow, var(--default-key-shadow));
        }
        .key:active { transform: translateY(2px); box-shadow: none; }
        .key.large { flex: 1.5; font-size: 0.9rem; }
        .key.correct { background-color: #27ae60; color: white; box-shadow: 0 3px 0 #1e8449; }
        .key.present { background-color: #f1c40f; color: white; box-shadow: 0 3px 0 #c0392b; }
        .key.absent  { background-color: #95a5a6; color: white; box-shadow: 0 3px 0 #7f8c8d; }

        #message-container {
            position: fixed; top: 10%; left: 50%; transform: translateX(-50%);
            background-color: #34495e; color: white;
            padding: 15px 25px; border-radius: 8px;
            font-weight: bold; z-index: 1000;
            opacity: 0; transition: all 0.5s; pointer-events: none;
            text-align: center; box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        #message-container.show { opacity: 1; transform: translateX(-50%) translateY(20px); }
        .row-shake { animation: shake 0.5s; }
        @keyframes shake {
            10%, 90% { transform: translateX(-2px); } 20%, 80% { transform: translateX(4px); }
            30%, 50%, 70% { transform: translateX(-6px); } 40%, 60% { transform: translateX(6px); }
        }
    </style>
</head>
<body>
    <div id="game-container">
        <header>
            <h1>Sz√≥Mester</h1>
            <div class="header-buttons">
                <button id="theme-button" class="icon-button" title="T√©ma v√°laszt√°s">üé®</button>
                <button id="next-word-button" class="icon-button" title="K√∂vetkez≈ë sz√≥">üîÑ</button>
            </div>
            <div id="theme-panel"></div>
        </header>

        <div id="info-bar">
            <span id="word-info">Kateg√≥ria: ... | ... bet≈±s</span>
        </div>

        <div id="message-container"></div>
        <main id="grid-container"></main>

        <div id="hint-container">
            <p id="hint-text">Tippelj, hogy megkapd az els≈ë seg√≠ts√©get!</p>
        </div>

        <div id="keyboard-container"></div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const wordData = [
            // R√∂vid szavak (3-4 bet≈±)
            { word: "H√ÅZ", category: "√âp√ºlet", hints: ["Lak√≥hely.", "Lehet kertes vagy t√°rsas.", "Teteje √©s falai vannak."] },
            { word: "NAP", category: "Fogalom", hints: ["√âgitest.", "Meleget √©s f√©nyt ad.", "K√∂r√ºl√∂tte kering a F√∂ld."] },
            { word: "AUT√ì", category: "J√°rm≈±", hints: ["N√©gy kereke van.", "Motor hajtja.", "Utakon k√∂zlekedik."] },
            { word: "FILM", category: "M≈±v√©szet", hints: ["Mozg√≥k√©pek sorozata.", "Moziban vagy TV-ben n√©zz√ºk.", "Lehet dr√°ma vagy v√≠gj√°t√©k."] },
            { word: "V√çZ", category: "Term√©szet", hints: ["Folyad√©k.", "Az √©let alapja.", "K√©plete: H2O."] },
            { word: "LABDA", category: "Sporteszk√∂z", hints: ["G√∂mb√∂ly≈± t√°rgy.", "Sportokban haszn√°lj√°k.", "Lehet r√∫gni, dobni, √ºtni."] },
            { word: "FA", category: "√âl≈ël√©ny", hints: ["N√∂v√©ny.", "T√∂rzse, √°gai √©s levelei vannak.", "Erd≈ëkben n≈ë."] },
            { word: "√âG", category: "Term√©szet", hints: ["Felett√ºnk van.", "Nappal k√©k, √©jjel fekete.", "Felh≈ëk, nap, hold l√°that√≥ rajta."] },

            // K√∂zepes szavak (5-7 bet≈±)
            { word: "ASZTAL", category: "T√°rgy", hints: ["B√∫tor.", "√Åltal√°ban n√©gy l√°ba van.", "Enni vagy dolgozni szoktunk rajta."] },
            { word: "ISKOLA", category: "√âp√ºlet", hints: ["Oktat√°si int√©zm√©ny.", "Gyerekek j√°rnak ide.", "Tant√°rgyakat tan√≠tanak benne."] },
            { word: "BARACK", category: "N√∂v√©ny", hints: ["Gy√ºm√∂lcs.", "Lehet s√°rga vagy ≈ëszibarack.", "Sz≈ër√∂s a h√©ja."] },
            { word: "KALAND", category: "Fogalom", hints: ["√âlm√©ny.", "Izgalmas √©s szokatlan.", "A h≈ës√∂k gyakran √°t√©lik."] },
            { word: "REP√úL≈ê", category: "J√°rm≈±", hints: ["A leveg≈ëben k√∂zlekedik.", "Sz√°rnyai vannak.", "Pil√≥ta vezeti."] },
            { word: "T√ÅNY√âR", category: "T√°rgy", hints: ["Ebb≈ël esz√ºnk.", "Lehet lapos vagy m√©ly.", "√Åltal√°ban porcel√°nb√≥l k√©sz√ºl."] },
            { word: "FEST≈ê", category: "Foglalkoz√°s", hints: ["M≈±v√©sz.", "Ecsetet √©s v√°sznat haszn√°l.", "K√©peket alkot."] },
            { word: "KERT√âSZ", category: "Foglalkoz√°s", hints: ["N√∂v√©nyekkel foglalkozik.", "Gondozza a kerteket.", "Metsz≈ëoll√≥t haszn√°l."] },
            { word: "POH√ÅR", category: "T√°rgy", hints: ["Ebb≈ël iszunk.", "√Åltal√°ban √ºvegb≈ël k√©sz√ºl.", "Lehet talpas vagy sima."] },
            { word: "TAVASZ", category: "Fogalom", hints: ["√âvszak.", "A t√©l ut√°n k√∂vetkezik.", "R√ºgyeznek a f√°k."] },
            { word: "SZ√çNH√ÅZ", category: "√âp√ºlet", hints: ["El≈ëad√°sokat tartanak benne.", "Vannak sz√≠n√©szek √©s n√©z≈ët√©r.", "F√ºgg√∂ny jelzi az el≈ëad√°s kezdet√©t."] },
            { word: "K√ìRH√ÅZ", category: "√âp√ºlet", hints: ["Int√©zm√©ny.", "Betegeket gy√≥gy√≠tanak itt.", "Orvosok √©s √°pol√≥k dolgoznak benne."] },
            { word: "K√ñNYVT√ÅR", category: "Hely", hints: ["K√∂nyveket lehet innen k√∂lcs√∂n√∂zni.", "Csendben kell lenni.", "Olvas√≥terme is van."] },
            { word: "SPORTOL", category: "Cselekv√©s", hints: ["Testmozg√°st v√©gez.", "Lehet egy√©ni vagy csapatsport.", "Jav√≠tja az √°ll√≥k√©pess√©get."] },
            { word: "SZEM√úVEG", category: "T√°rgy", hints: ["Seg√≠ti a l√°t√°st.", "K√©t lencs√©b≈ël √©s egy keretb≈ël √°ll.", "Optikusn√°l kaphat√≥."] },
            { word: "CSAVAR", category: "Eszk√∂z", hints: ["R√∂gz√≠t≈ë elem.", "Menetes a sz√°ra.", "Csavarh√∫z√≥val lehet behajtani."] },
            { word: "VILL√ÅM", category: "Term√©szet", hints: ["Id≈ëj√°r√°si jelens√©g.", "F√©nyjelens√©g viharban.", "Hangja a d√∂rg√©s."] },
            { word: "CSAL√ÅD", category: "Fogalom", hints: ["Emberek k√∂z√∂ss√©ge.", "Rokoni sz√°lak k√∂tik √∂ssze ≈ëket.", "A t√°rsadalom alapja."] },
            { word: "UTAZ√ÅS", category: "Cselekv√©s", hints: ["Helyv√°ltoztat√°s.", "Lehet nyaral√°s vagy √ºzleti.", "√öj helyeket ismerhet√ºnk meg."] },
            { word: "F≈êZEL√âK", category: "√âtel", hints: ["S≈±r≈±, z√∂lds√©ges √©tel.", "Gyakran felt√©ttel eszik.", "Tipikus magyar eb√©d."] },

            // Hossz√∫ szavak (8+)
            { word: "KER√âKP√ÅR", category: "J√°rm≈±", hints: ["K√©t kereke van.", "Ped√°llal kell hajtani.", "K√∂rnyezetbar√°t k√∂zleked√©si eszk√∂z."] },
            { word: "FAGYLALT", category: "√âtel", hints: ["Hideg √©dess√©g.", "Ny√°ron n√©pszer≈±.", "T√∂lcs√©rben vagy kehelyben adj√°k."] },
            { word: "BONYOLULT", category: "Tulajdons√°g", hints: ["Nem egyszer≈±.", "Sok r√©szb≈ël √°ll, nehezen √°tl√°that√≥.", "A rejtv√©nyek gyakran ilyenek."] },
            { word: "CSOKOL√ÅD√â", category: "√âtel", hints: ["√âdess√©g.", "Kaka√≥babb√≥l k√©sz√ºl.", "Lehet tej-, √©t- vagy feh√©r."] },
            { word: "SZ√ÅM√çT√ìG√âP", category: "T√°rgy", hints: ["Elektronikus eszk√∂z.", "Adatok feldolgoz√°s√°ra haszn√°lj√°k.", "Van monitorja √©s billenty≈±zete."] },
            { word: "F√ñLDG√ñMB", category: "T√°rgy", hints: ["A F√∂ld kicsiny√≠tett m√°sa.", "Tengely k√∂r√ºl forog.", "Rajta vannak a kontinensek √©s √≥ce√°nok."] },
            { word: "IRODALOM", category: "M≈±v√©szet", hints: ["Sz√∂veges m≈±alkot√°sok √∂sszess√©ge.", "Lehet vers vagy pr√≥za.", "Tant√°rgy az iskol√°ban."] },
            { word: "TELEFON", category: "T√°rgy", hints: ["Kommunik√°ci√≥s eszk√∂z.", "Lehet vezet√©kes vagy mobil.", "H√≠v√°sokat lehet vele ind√≠tani."] },
            { word: "GIT√ÅR", category: "Hangszer", hints: ["Penget≈ës hangszer.", "√Åltal√°ban 6 h√∫rja van.", "Lehet akusztikus vagy elektromos."] },
            { word: "GY≈êZELEM", category: "Fogalom", hints: ["Siker egy versenyben.", "A veres√©g ellent√©te.", "D√≠j vagy √©rem j√°r √©rte."] },
            { word: "KALAP√ÅCS", category: "Eszk√∂z", hints: ["Szersz√°m.", "Szegek bever√©s√©re haszn√°lj√°k.", "Feje √©s nyele van."] },
            { word: "KUKORICA", category: "N√∂v√©ny", hints: ["Gabonaf√©le.", "S√°rga szemei vannak.", "Pattogatva is finom."] },
            { word: "MOZDONY", category: "J√°rm≈±", hints: ["A vonat eleje.", "Ez h√∫zza a vagonokat.", "Lehet g≈ëz-, d√≠zel- vagy villany-."] },
            { word: "KAR√ÅCSONY", category: "√únnep", hints: ["Decemberben van.", "Aj√°nd√©koz√°s √©s csal√°di egy√ºttl√©t jellemzi.", "J√©zus sz√ºlet√©s√©nek √ºnnepe."] },
            { word: "PILLANG√ì", category: "√Ållat", hints: ["Rep√ºl≈ë rovar.", "Sz√≠nes, pikkelyes sz√°rnyai vannak.", "Herny√≥b√≥l fejl≈ëdik ki."] },
            { word: "ZONGORA", category: "Hangszer", hints: ["Billenty≈±s hangszer.", "Fekete √©s feh√©r billenty≈±i vannak.", "Hangversenyeken gyakori."] },
            { word: "VILL√ÅMCSAP√ÅS", category: "Term√©szet", hints: ["Id≈ëj√°r√°si jelens√©g.", "Viharban fordul el≈ë.", "Hatalmas elektromos kis√ºl√©s."] },
            { word: "ALAP√çTV√ÅNY", category: "Szervezet", hints: ["J√≥t√©kony c√©l√∫ szervezet.", "Adom√°nyokb√≥l m≈±k√∂dik.", "C√©lja a t√°rsadalom seg√≠t√©se."] },
            { word: "F√âNYK√âPEZ≈êG√âP", category: "Eszk√∂z", hints: ["K√©pek k√©sz√≠t√©s√©re val√≥.", "Objekt√≠vje √©s gombjai vannak.", "Meg√∂r√∂k√≠ti a pillanatot."] },
            { word: "MINISZTERELN√ñK", category: "Foglalkoz√°s", hints: ["Politikai vezet≈ë.", "A korm√°ny feje.", "Az orsz√°g ir√°ny√≠t√°s√°√©rt felel≈ës."] },
            { word: "PARADICSOM", category: "N√∂v√©ny", hints: ["Piros sz√≠n≈± z√∂lds√©g (botanikailag gy√ºm√∂lcs).", "Sal√°t√°kba, sz√≥szokba teszik.", "A lecs√≥ egyik f≈ë alapanyaga."] },
            { word: "GOMBFOCO", category: "Sport", hints: ["Asztali j√°t√©k.", "P√∂ck√∂l√©ssel kell g√≥lt l≈ëni.", "Kis m≈±anyag figur√°kkal j√°tssz√°k."] },
            { word: "T≈∞ZIJ√ÅT√âK", category: "L√°tv√°nyoss√°g", hints: ["√únnepekkor l√°that√≥.", "F√©nyes, sz√≠nes robban√°sok az √©gen.", "Augusztus 20-√°n is van."] },
            { word: "RENDSZERV√ÅLT√ÅS", category: "T√∂rt√©nelem", hints: ["Nagy politikai √°talakul√°s.", "Magyarorsz√°gon 1989-90-ben t√∂rt√©nt.", "A szocializmus v√©g√©t jelentette."] },
            { word: "HELIKOPTER", category: "J√°rm≈±", hints: ["L√©gi j√°rm≈±.", "Nincs sz√°rnya, rotorja van.", "Egy helyben is tud lebegni."] }
        ];
        
        const MAX_GUESSES = 10;
        let currentRow, currentCol, isGameOver, targetWord, targetHints, targetCategory, wordLength;
        let lastWordIndex = -1;

        const gridContainer = document.getElementById('grid-container');
        const keyboardContainer = document.getElementById('keyboard-container');
        const messageContainer = document.getElementById('message-container');
        const hintText = document.getElementById('hint-text');
        const wordInfoDisplay = document.getElementById('word-info');
        const nextWordButton = document.getElementById('next-word-button');
        const themeButton = document.getElementById('theme-button');
        const themePanel = document.getElementById('theme-panel');
        
        const themes = [
            { name: 'Nappali', class: 'theme-day', gradient: 'linear-gradient(135deg, #f4f7f9, #dce4e8)' },
            { name: 'Alkonyat', class: 'theme-dusk', gradient: 'linear-gradient(135deg, #2c3e50, #4ca1af)' },
            { name: 'Naplemente', class: 'theme-sunset', gradient: 'linear-gradient(135deg, #ff7e5f, #feb47b)' },
            { name: 'Erd≈ë', class: 'theme-forest', gradient: 'linear-gradient(135deg, #134e5e, #71b280)' },
            { name: 'Kir√°lyi', class: 'theme-royal', gradient: 'linear-gradient(135deg, #480048, #C04848)' },
        ];

        function startNewGame() {
            // Reset game state
            currentRow = 0;
            currentCol = 0;
            isGameOver = false;

            // Pick a new, random word that wasn't the last one
            let newWordIndex;
            do {
                newWordIndex = Math.floor(Math.random() * wordData.length);
            } while (wordData.length > 1 && newWordIndex === lastWordIndex);
            lastWordIndex = newWordIndex;
            
            const wordObject = wordData[newWordIndex];
            targetWord = wordObject.word.toUpperCase();
            targetHints = wordObject.hints;
            targetCategory = wordObject.category;
            wordLength = targetWord.length;

            wordInfoDisplay.textContent = `Kateg√≥ria: ${targetCategory} | ${wordLength} bet≈±s`;
            hintText.innerHTML = "Tippelj, hogy megkapd az els≈ë seg√≠ts√©get!";
            messageContainer.classList.remove('show');
            
            initializeGrid();
            initializeKeyboard();
        }

        function initializeGrid() {
            gridContainer.innerHTML = '';
            gridContainer.style.height = `${MAX_GUESSES * 56}px`; // Adjust height for better layout
            for (let i = 0; i < MAX_GUESSES; i++) {
                const row = document.createElement('div');
                row.className = 'grid-row';
                row.id = `row-${i}`;
                row.style.gridTemplateColumns = `repeat(${wordLength}, 1fr)`;
                for (let j = 0; j < wordLength; j++) {
                    row.innerHTML += `<div class="grid-cell" id="cell-container-${i}-${j}"><div class="cell-inner"><div class="cell-face cell-front"></div><div class="cell-face cell-back"></div></div></div>`;
                }
                gridContainer.appendChild(row);
            }
        }

        function initializeKeyboard() {
            keyboardContainer.querySelectorAll('.key').forEach(key => {
                key.classList.remove('correct', 'present', 'absent');
            });
        }
        
        function setupUI() {
            // Static Keyboard setup
             const keyLayout = [
                ['Q', 'W', 'E', 'R', 'T', 'Z', 'U', 'I', 'O', 'P', '√ñ', '√ú', '√ì'],
                ['A', 'S', 'D', 'F', 'G', 'H', 'J', 'K', 'L', '√â', '√Å', '≈∞', '≈ê', '√ö'],
                ['Enter', 'Y', 'X', 'C', 'V', 'B', 'N', 'M', '√ç', 'Backspace']
            ];
            keyLayout.forEach(rowKeys => {
                const row = document.createElement('div');
                row.className = 'keyboard-row';
                rowKeys.forEach(key => {
                    const button = document.createElement('button');
                    button.textContent = key;
                    button.className = 'key';
                    button.dataset.key = key.toUpperCase();
                    if (key === 'Enter' || key === 'Backspace') button.classList.add('large');
                    button.addEventListener('click', () => handleKeyPress(key));
                    row.appendChild(button);
                });
                keyboardContainer.appendChild(row);
            });
            
            // Theme switcher setup
            themes.forEach(theme => {
                const btn = document.createElement('button');
                btn.className = 'theme-button';
                btn.title = theme.name;
                btn.style.background = theme.gradient;
                btn.addEventListener('click', () => applyTheme(theme.class));
                themePanel.appendChild(btn);
            });

            themeButton.addEventListener('click', (e) => {
                e.stopPropagation();
                themePanel.classList.toggle('visible');
            });
            document.addEventListener('click', () => themePanel.classList.remove('visible'));
            themePanel.addEventListener('click', e => e.stopPropagation());

            const savedTheme = localStorage.getItem('szokereto_theme') || 'theme-day';
            applyTheme(savedTheme);

            nextWordButton.addEventListener('click', startNewGame);
        }

        function applyTheme(themeClass) {
            document.body.className = themeClass;
            localStorage.setItem('szokereto_theme', themeClass);
            themePanel.classList.remove('visible');
        }

        function handleKeyPress(key) {
            if (isGameOver) return;
            const upperKey = key.toUpperCase();
            if (upperKey === 'ENTER') submitGuess();
            else if (upperKey === 'BACKSPACE') deleteLetter();
            else if (upperKey.length === 1 && upperKey.match(/^[A-Z√Å√â√ç√ì√ñ≈ê√ö√ú≈∞]$/)) addLetter(upperKey);
        }

        function addLetter(letter) {
            if (currentCol < wordLength) {
                const cell = document.querySelector(`#row-${currentRow} #cell-container-${currentRow}-${currentCol}`);
                cell.querySelector('.cell-front').textContent = letter;
                cell.classList.add('filled');
                currentCol++;
            }
        }

        function deleteLetter() {
            if (currentCol > 0) {
                currentCol--;
                const cell = document.querySelector(`#row-${currentRow} #cell-container-${currentRow}-${currentCol}`);
                cell.querySelector('.cell-front').textContent = '';
                cell.classList.remove('filled');
            }
        }
        
        function updateHints() {
             let hintsToShow = [];
             if (currentRow >= 1) hintsToShow.push(`<strong>1. seg√≠ts√©g:</strong> ${targetHints[0]}`);
             if (currentRow >= 3) hintsToShow.push(`<strong>2. seg√≠ts√©g:</strong> ${targetHints[1]}`);
             if (currentRow >= 6) hintsToShow.push(`<strong>3. seg√≠ts√©g:</strong> ${targetHints[2]}`);
             if (hintsToShow.length > 0) hintText.innerHTML = hintsToShow.join('<br><br>');
        }

        function submitGuess() {
            if (currentCol !== wordLength) {
                showMessage(`A sz√≥nak ${wordLength} bet≈±b≈ël kell √°llnia!`);
                shakeRow();
                return;
            }
            const guess = Array.from({ length: wordLength }, (_, i) => document.querySelector(`#row-${currentRow} #cell-container-${currentRow}-${i} .cell-front`).textContent).join('');
            flipRow(guess);
            if (guess === targetWord) {
                setTimeout(() => {
                    showMessage("Sikeres megfejt√©s!", 5000);
                    isGameOver = true;
                    hintText.innerHTML = `üéâ √úgyes! A helyes sz√≥: <strong>${targetWord}</strong>. üéâ`;
                }, wordLength * 200);
                return;
            }
            currentRow++;
            if (currentRow >= MAX_GUESSES) {
                setTimeout(() => {
                    isGameOver = true;
                    showMessage(`Sajnos nem siker√ºlt!`, 10000);
                    hintText.innerHTML = `A helyes sz√≥ ez lett volna: <strong>${targetWord}</strong>.`;
                }, wordLength * 200);
            } else {
                currentCol = 0;
                updateHints();
            }
        }

        function flipRow(guess) {
            const targetLetters = targetWord.split('');
            const guessLetters = guess.split('');
            const letterStates = Array(wordLength).fill('absent');
            const usedTargetIndexes = new Set();
            guessLetters.forEach((letter, index) => {
                if (letter === targetLetters[index]) {
                    letterStates[index] = 'correct';
                    usedTargetIndexes.add(index);
                }
            });
            guessLetters.forEach((letter, index) => {
                if (letterStates[index] !== 'correct') {
                    const presentIndex = targetLetters.findIndex((targetLetter, targetIndex) => 
                        targetLetter === letter && !usedTargetIndexes.has(targetIndex));
                    if (presentIndex !== -1) {
                        letterStates[index] = 'present';
                        usedTargetIndexes.add(presentIndex);
                    }
                }
            });
            for (let i = 0; i < wordLength; i++) {
                const cellContainer = document.querySelector(`#row-${currentRow} #cell-container-${currentRow}-${i}`);
                const cellBack = cellContainer.querySelector('.cell-back');
                setTimeout(() => {
                    cellBack.textContent = guessLetters[i];
                    cellBack.classList.add(letterStates[i]);
                    cellContainer.classList.add('flip');
                    updateKeyboard(guessLetters[i], letterStates[i]);
                }, i * 150);
            }
        }

        function updateKeyboard(letter, state) {
            const key = document.querySelector(`.key[data-key="${letter.toUpperCase()}"]`);
            if (!key) return;
            const priorities = { 'correct': 3, 'present': 2, 'absent': 1 };
            const currentClass = key.classList.contains('correct') ? 'correct' : key.classList.contains('present') ? 'present' : 'absent';
            if (!currentClass || priorities[state] > (priorities[currentClass] || 0)) {
                key.classList.remove('correct', 'present', 'absent');
                key.classList.add(state);
            }
        }
        
        function showMessage(message, duration = 3000) {
            messageContainer.innerHTML = message;
            messageContainer.classList.add('show');
            setTimeout(() => messageContainer.classList.remove('show'), duration);
        }

        function shakeRow() {
            const row = document.getElementById(`row-${currentRow}`);
            row.classList.add('row-shake');
            setTimeout(() => row.classList.remove('row-shake'), 500);
        }
        
        document.addEventListener('keydown', (e) => handleKeyPress(e.key));
        
        setupUI();
        startNewGame();
    });
    </script>
</body>
</html>
